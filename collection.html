<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ó–±—ñ—Ä–∫–∞ ‚Äî KinoSite</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<div id="header-placeholder"></div>
<script>
  fetch("header.html")
    .then(r => r.text())
    .then(t => document.getElementById("header-placeholder").innerHTML = t);
</script>

<main class="container">
  <h1 id="collectionTitle">üé¨ –ó–±—ñ—Ä–∫–∞</h1>
  <div id="filmsList" class="film-grid"></div>
</main>

<footer>¬© 2025 KinoSite</footer>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  const supabaseUrl = "https://zerlqvbmqszomlondlte.supabase.co";
  const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InplcmxxdmJtcXN6b21sb25kbHRlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUzMzg3NzQsImV4cCI6MjA3MDkxNDc3NH0.8wUBYIeQRC6KVp6vdzv0oqofIf4PeZyzbV5GcD0vxTE";
  const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);


  async function loadCollection() {
    const params = new URLSearchParams(window.location.search);
    const name = params.get("name");
    const title = document.getElementById("collectionTitle");
    const container = document.getElementById("filmsList");

    title.textContent = name;

    const { data, error } = await supabase
      .from("films_site")
      .select("*")
      .ilike("collection", `%${name}%`);

    if (error) {
      container.innerHTML = "<p style='color:white;'>–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è.</p>";
      return;
    }

    if (!data.length) {
      container.innerHTML = "<p style='color:white;'>–ü–æ–∫–∏ —â–æ –Ω–µ–º–∞—î —Ñ—ñ–ª—å–º—ñ–≤ —É —Ü—ñ–π –∑–±—ñ—Ä—Ü—ñ.</p>";
      return;
    }

    container.innerHTML = "";
    data.forEach(film => {
      const card = document.createElement("div");
      card.className = "film";
      card.innerHTML = `
        <div class="poster">
          <img src="${film.poster}" alt="${film.title}">
          ${String(film.pro_access || '').toUpperCase() === 'PRO' ? '<span class="badge plus">PRO</span>' : ''}
        </div>
        <div class="title">${film.title}</div>
        <div class="meta">${film.genre} ‚Ä¢ ${film.year}</div>
      `;
      card.onclick = () => window.location.href = "film.html?id=" + film.id;
      container.appendChild(card);
    });
  }

  document.addEventListener("DOMContentLoaded", loadCollection);
</script>

</body>
</html>
