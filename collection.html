<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- ‚úÖ –Ü–∫–æ–Ω–∫–∏ —Å–∞–π—Ç—É –¥–ª—è –≤—Å—ñ—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤ -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#00fff2">

  <!-- Android favicon / PWA icons -->
  <link rel="icon" type="image/png" sizes="192x192" href="/icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/icon-512.png">

  <!-- iOS –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="/icon-512.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icon-512.png">

  <title>–ó–±—ñ—Ä–∫–∞ ‚Äî KinoSite</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
<div id="header-placeholder"></div>
<script src="header.js"></script>

<div id="header-placeholder"></div>
<script>
  // üü¢ –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó –ø–æ—à—É–∫—É –ø—ñ—Å–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ö–µ–¥–µ—Ä–∞
  function bindHeaderSearch() {
    const input = document.getElementById("search-input");
    if (!input) return;

    input.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        const query = input.value.trim();
        if (query.length > 1) {
          localStorage.setItem("searchQuery", query);
          window.location.href = "/search.html";
        }
      }
    });
  }

  // üü¢ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ö–µ–¥–µ—Ä–∞ + –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –ø–æ—à—É–∫—É
  fetch("header.html")
    .then(r => r.text())
    .then(t => {
      document.getElementById("header-placeholder").innerHTML = t;
      bindHeaderSearch(); // –∞–∫—Ç–∏–≤—É—î–º–æ –ø–æ—à—É–∫ –ø—ñ—Å–ª—è –≤—Å—Ç–∞–≤–∫–∏
    })
    .catch(err => console.error("–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ö–µ–¥–µ—Ä–∞:", err));
</script>


<main class="container">
  <h1 id="collectionTitle">üé¨ –ó–±—ñ—Ä–∫–∞</h1>
  <div id="filmsList" class="film-grid"></div>
</main>

<footer>¬© 2025 KinoSite</footer>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  const supabaseUrl = "https://zerlqvbmqszomlondlte.supabase.co";
  const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InplcmxxdmJtcXN6b21sb25kbHRlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUzMzg3NzQsImV4cCI6MjA3MDkxNDc3NH0.8wUBYIeQRC6KVp6vdzv0oqofIf4PeZyzbV5GcD0vxTE";
  const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);


// === üß† –†–æ–∑—É–º–Ω–∏–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –ø—ñ–¥–±—ñ—Ä —Ñ—ñ–ª—å–º—ñ–≤ –ø–æ –∑–±—ñ—Ä—Ü—ñ ===
// –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –∂–∞–Ω—Ä + –∫–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞ –æ–ø–∏—Å—É (–≤–∞—Ä—ñ–∞–Ω—Ç C)
// –ü–æ–∫–∞–∑—É—î –¥–æ 30 —Ñ—ñ–ª—å–º—ñ–≤
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –ø—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ –Ω–æ–≤–∏—Ö —Ñ—ñ–ª—å–º—ñ–≤ —É Supabase

// === üß† –†–æ–∑—É–º–Ω–∏–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –ø—ñ–¥–±—ñ—Ä —Ñ—ñ–ª—å–º—ñ–≤ –ø–æ –∑–±—ñ—Ä—Ü—ñ ===
// –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –∂–∞–Ω—Ä + –∫–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞ –æ–ø–∏—Å—É (–≤–∞—Ä—ñ–∞–Ω—Ç C)
// –ü–æ–∫–∞–∑—É—î –¥–æ 30 —Ñ—ñ–ª—å–º—ñ–≤
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –ø—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ –Ω–æ–≤–∏—Ö —Ñ—ñ–ª—å–º—ñ–≤ —É Supabase

async function loadCollectionSmart() {
  const params = new URLSearchParams(window.location.search);
  const name = params.get("name")?.trim();
  const container = document.getElementById("filmsList");
  const title = document.getElementById("collectionTitle");

  title.textContent = name;

  // 1Ô∏è‚É£ –¢—è–≥–∞—î–º–æ –í–°–Ü —Ñ—ñ–ª—å–º–∏ –∑ Supabase
  const { data: films, error } = await supabase
    .from("films_site")
    .select("*")
    .order("id", { ascending: false });

  if (error || !films?.length) {
    container.innerHTML = "<p style='color:white;'>–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è.</p>";
    return;
  }

  // === 2Ô∏è‚É£ –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è –∫–æ–∂–Ω–æ—ó –∑–±—ñ—Ä–∫–∏ ===
  const rules = {
    "–§–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞, —â–æ –≤—Ä–∞–∂–∞—î —É—è–≤—É": {
      genre: ["—Ñ–∞–Ω—Ç–∞—Å—Ç", "sci-fi"],
      keywords: ["—Ä–æ–±–æ—Ç", "—à—Ç—É—á", "–º–∞–π–±—É—Ç", "–∫–æ—Å–º–æ—Å", "–ø–∞—Ä–∞–Ω–æ—Ä–º"],
    },
    "–ù–∞–π—Å—Ç—Ä–∞—à–Ω—ñ—à—ñ —Ñ—ñ–ª—å–º–∏ –∂–∞—Ö—ñ–≤": {
      genre: ["–∂–∞—Ö"],
      keywords: ["–º–∞–Ω—ñ—è–∫", "–≤–±–∏–≤", "—Å—Ç—Ä–∞—à", "–∫—Ä–æ–≤", "–¥–µ–º–æ–Ω"],
    },
    "–û–±–æ–≤‚Äô—è–∑–∫–æ–≤—ñ –¥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É —Ñ—ñ–ª—å–º–∏": {
      genre: ["–¥—Ä–∞–º–∞", "–±—ñ–æ–≥—Ä–∞—Ñ", "–∫—Ä–∏–º—ñ–Ω–∞–ª"],
      keywords: ["—Ä–µ–∞–ª—å–Ω", "—ñ—Å—Ç–æ—Ä"],
    },
    "–ö–æ–º–µ–¥—ñ—ó, —â–æ –ø—ñ–¥–Ω—ñ–º—É—Ç—å –Ω–∞—Å—Ç—Ä—ñ–π": {
      genre: ["–∫–æ–º–µ–¥—ñ"],
      keywords: ["—Å–º—ñ—Ö", "–≤–µ—Å–µ–ª", "–∫—É–º–µ–¥"],
    },
    "–ê–¥—Ä–µ–Ω–∞–ª—ñ–Ω —ñ —à–≤–∏–¥–∫—ñ—Å—Ç—å ‚Äî –ø—Ä–æ –≥–æ–Ω–∫–∏": {
      keywords: ["–≥–æ–Ω–∫", "–ø–µ—Ä–µ–≥–æ", "–¥—Ä–∞–π–≤", "—à–≤–∏–¥–∫"],
    },
    "–§—ñ–ª—å–º–∏ –ø—Ä–æ —Ç–∞–Ω—Ü—ñ —Ç–∞ –º—É–∑–∏–∫—É": {
      keywords: ["—Ç–∞–Ω—Ü", "–º—É–∑–∏–∫", "—Å–ø—ñ–≤", "—Ä–∏—Ç–º"],
    },
    "–ù–æ–≤–æ—Ä—ñ—á–Ω–∏–π —ñ —Ä—ñ–∑–¥–≤—è–Ω–∏–π –Ω–∞—Å—Ç—Ä—ñ–π": {
      keywords: ["—Ä—ñ–∑–¥–≤", "–Ω–æ–≤–æ—Ä", "—Å–≤—è—Ç"],
    },
    "–§—ñ–ª—å–º–∏ –ø—Ä–æ –≤–∏–∂–∏–≤–∞–Ω–Ω—è": {
      keywords: ["–≤–∏–∂–∏–≤–∞–Ω", "–±–æ—Ä–æ—Ç—å–±", "–≤—Ç–µ—á", "–µ–∫—Å—Ç—Ä–∏–º"],
    },
    "–Ü—Å—Ç–æ—Ä—ñ—ó, –∑–∞—Å–Ω–æ–≤–∞–Ω—ñ –Ω–∞ —Ä–µ–∞–ª—å–Ω–∏—Ö –ø–æ–¥—ñ—è—Ö": {
      keywords: ["—ñ—Å—Ç–æ—Ä", "—Ä–µ–∞–ª—å–Ω", "–±—ñ–æ–≥—Ä–∞—Ñ"],
    },
    "–ö—ñ–Ω–æ –ø—Ä–æ —Å–æ–±–∞–∫ üêæ": {
      keywords: ["–ø–µ—Å", "—Å–æ–±–∞–∫", "dog"],
    },
    "–ú–∞—Ñ—ñ—è, –≥–∞–Ω–≥—Å—Ç–µ—Ä–∏ —Ç–∞ –±–∞–Ω–¥–∏—Ç–∏": {
      genre: ["–∫—Ä–∏–º—ñ–Ω–∞–ª"],
      keywords: ["–º–∞—Ñ", "–≥–∞–Ω–≥", "–±–∞–Ω–¥"],
    },
    "–®–ø–∏–≥—É–Ω–∏, –∞–≥–µ–Ω—Ç–∏ –π —Å–ø–µ—Ü–æ–ø–µ—Ä–∞—Ü—ñ—ó": {
      keywords: ["–∞–≥–µ–Ω—Ç", "—à–ø–∏–≥", "—Ä–æ–∑–≤—ñ–¥", "—Å–ø–µ—Ü"],
    },
    "–ú–∞–Ω—ñ—è–∫–∏, –ø—Å–∏—Ö–æ–ø–∞—Ç–∏ —Ç–∞ —Ç—Ä–∏–ª–µ—Ä–∏": {
      genre: ["—Ç—Ä–∏–ª–µ—Ä"],
      keywords: ["–º–∞–Ω—ñ—è–∫", "–≤–±–∏–≤", "–ø—Å–∏—Ö", "—Å—Ç—Ä–∞—Ö"],
    },
    "–®—Ç—É—á–Ω–∏–π —ñ–Ω—Ç–µ–ª–µ–∫—Ç —ñ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó –º–∞–π–±—É—Ç–Ω—å–æ–≥–æ": {
      keywords: ["—Ä–æ–±–æ—Ç", "ai", "—à—Ç—É—á", "—Ç–µ—Ö–Ω–æ–ª–æ–≥"],
    },
    "–ñ–∏—Ç—Ç—è –∑–∞ “ë—Ä–∞—Ç–∞–º–∏ ‚Äî —Ñ—ñ–ª—å–º–∏ –ø—Ä–æ —Ç—é—Ä–º—É": {
      keywords: ["—Ç—é—Ä–º", "–≤‚Äô—è–∑–Ω", "—É–≤‚Äô—è–∑–Ω"],
    },
    "–ü–æ–≥—Ä–∞–±—É–≤–∞–Ω–Ω—è, –∞—Ñ–µ—Ä–∏ —Ç–∞ —Ç—Ä—é–∫–∏": {
      keywords: ["–ø–æ–≥—Ä–∞–±", "–∞—Ñ–µ—Ä", "–∫—Ä–∞–¥—ñ–∂"],
    },
    "–ê–ø–æ–∫–∞–ª—ñ–ø—Å–∏—Å —ñ –∫—ñ–Ω–µ—Ü—å —Å–≤—ñ—Ç—É": {
      keywords: ["–∞–ø–æ–∫–∞–ª", "–∫—ñ–Ω–µ—Ü—å", "–∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ"],
    },
    "–§—ñ–ª—å–º–∏ –ø—Ä–æ –∫–æ—Ö–∞–Ω–Ω—è üíû": {
      genre: ["—Ä–æ–º–∞–Ω", "–º–µ–ª–æ–¥—Ä–∞–º"],
      keywords: ["–∫–æ—Ö–∞–Ω", "—Ä–æ–º–∞–Ω—Å"],
    },
    "–§—ñ–ª—å–º–∏ –ø—Ä–æ –∫–æ—Å–º–æ—Å": {
      keywords: ["–∫–æ—Å–º–æ—Å", "–≥–∞–ª–∞–∫—Ç–∏–∫", "–æ—Ä–±—ñ—Ç–∞"],
    },
    "–£–ª—é–±–ª–µ–Ω—ñ —Ñ—ñ–ª—å–º–∏ Disney": {
      keywords: ["—Å—ñ–º–µ–π–Ω", "–¥–∏—Ç—è—á", "–º—É–ª—å—Ç", "–ø—Ä–∏–≥–æ–¥"],
    },
  };

  const rule = rules[name];
  if (!rule) {
    container.innerHTML = "<p style='color:white;'>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∞.</p>";
    return;
  }

  // === 3Ô∏è‚É£ –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è ===
  const normalize = (str) =>
    (str || "").toLowerCase().replace(/[^\p{L}\p{N} ]/gu, "");

  // === 4Ô∏è‚É£ –§—ñ–ª—å—Ç—Ä —Ñ—ñ–ª—å–º—ñ–≤ –∑–∞ –∂–∞–Ω—Ä–æ–º + –∫–ª—é—á–æ–≤–∏–º–∏ —Å–ª–æ–≤–∞–º–∏
  let result = films.filter((film) => {
    const g = normalize(film.genre);
    const d = normalize(film.description);

    let score = 0;

    rule.genre?.forEach((word) => {
      if (g.includes(word)) score += 3;
    });

    rule.keywords?.forEach((word) => {
      if (d.includes(word)) score += 2;
      if (g.includes(word)) score += 1;
    });

    return score > 0;
  });

  // === üßπ 5Ô∏è‚É£ –£–ù–Ü–ö–ê–õ–Ü–ó–ê–¶–Ü–Ø ‚Äî –ø—Ä–∏–±–∏—Ä–∞—î–º–æ –¥—É–±–ª—ñ–∫–∞—Ç–∏ —Ñ—ñ–ª—å–º—ñ–≤
  const uniqueMap = new Map();

  result.forEach((film) => {
    const key = film.id || film.title.toLowerCase();
    if (!uniqueMap.has(key)) {
      uniqueMap.set(key, film);
    }
  });

  result = Array.from(uniqueMap.values());

  // === 6Ô∏è‚É£ –ü–µ—Ä–µ–º—ñ—à—É—î–º–æ —ñ –±–µ—Ä–µ–º–æ –¥–æ 30 —Ñ—ñ–ª—å–º—ñ–≤
  result = result.sort(() => Math.random() - 0.5).slice(0, 30);

  // === 7Ô∏è‚É£ –í–∏–≤—ñ–¥ —Ñ—ñ–ª—å–º—ñ–≤
  container.innerHTML = "";
  result.forEach((film) => {
    const card = document.createElement("div");
    card.className = "film";
    card.innerHTML = `
      <div class='poster'>
        <img src="${film.poster}" onerror="this.onerror=null; this.src=this.src + '?dl=1';">
      </div>
      <div class='title'>${film.title}</div>
      <div class='meta'>${film.genre} ‚Ä¢ ${film.year}</div>
    `;
    card.onclick = () =>
      (window.location.href = "film.html?id=" + film.id);

    container.appendChild(card);
  });
}

// üöÄ –ó–∞–ø—É—Å–∫–∞—î–º–æ —Ä–æ–∑—É–º–Ω–∏–π –ø—ñ–¥–±—ñ—Ä
document.addEventListener("DOMContentLoaded", loadCollectionSmart);


</script>
<style>
/* === –°–Ü–¢–ö–ê –§–Ü–õ–¨–ú–Ü–í === */
.film-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 20px;
  padding: 30px 20px;
  justify-items: center;
}

/* === –ö–ê–†–¢–ö–ê –§–Ü–õ–¨–ú–£ === */
.film {
  position: relative;
  background: rgba(10,10,10,0.8);
  border-radius: 16px;
  overflow: hidden;
  cursor: pointer;
  border: 1px solid rgba(0,255,255,0.1);
  width: 160px;
  transition: all 0.25s ease;
  box-shadow: 0 0 15px rgba(0,255,255,0.05);
}

.film:hover {
  transform: scale(1.08);
  box-shadow: 0 0 20px rgba(0,255,255,0.3);
}

/* === –ü–û–°–¢–ï–† === */
.film .poster img {
  width: 100%;
  height: 220px;
  object-fit: cover;
  border-radius: 14px;
  filter: brightness(0.9);
  transition: 0.3s;
}

.film:hover .poster img {
  filter: brightness(1);
}

/* === –ù–ê–ó–í–ê === */
.film .title {
  color: #fff;
  font-size: 14px;
  font-weight: 600;
  text-align: center;
  margin: 8px 6px 4px;
  text-shadow: 0 0 6px rgba(0,255,255,0.25);
}

/* === –ñ–ê–ù–† / –†–Ü–ö === */
.film .meta {
  color: #aaa;
  font-size: 12px;
  text-align: center;
  margin-bottom: 10px;
}

/* === –ë–ï–ô–î–ñ PRO === */
.badge.plus {
  position: absolute;
  top: 8px;
  left: 8px;
  background: linear-gradient(90deg, #ff00cc, #3333ff);
  padding: 2px 6px;
  font-size: 10px;
  border-radius: 6px;
  color: #fff;
  box-shadow: 0 0 6px rgba(255,0,200,0.6);
}

/* === –ì–†–ê–î–Ü–Ñ–ù–¢ –ü–Ü–î –§–û–ù–û–ú === */
body {
  background: radial-gradient(circle at top, #0a0a0a, #000);
}
</style>
<script src="auth.js"></script>
<div id="footer-placeholder"></div>
<script>
  fetch("footer.html")
    .then(res => res.text())
    .then(html => {
      document.getElementById("footer-placeholder").innerHTML = html;
      // –ø—ñ—Å–ª—è —Ç–æ–≥–æ —è–∫ —Ñ—É—Ç–µ—Ä –∑‚Äô—è–≤–∏–≤—Å—è —É DOM ‚Äî –ø—ñ–¥–∫–ª—é—á–∞—î–º–æ –ª–æ–≥—ñ–∫—É
      const s = document.createElement("script");
      s.src = "footer.js";
      document.body.appendChild(s);
    });
</script> <!-- üü¢ –æ—Å—å —Ü—å–æ–≥–æ –∑–∞–∫—Ä–∏–≤–∞—é—á–æ–≥–æ —Ç–µ–≥—É –Ω–µ –≤–∏—Å—Ç–∞—á–∞–ª–æ! -->

<script src="/sw-register.js"></script> <!-- ‚úÖ Service Worker -->
<script src="seo.js"></script>
<script src="/pull-refresh.js"></script>
</body>

</body>
</html>
