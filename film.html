<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- ‚úÖ –Ü–∫–æ–Ω–∫–∏ —Å–∞–π—Ç—É –¥–ª—è –≤—Å—ñ—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤ -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#00fff2">

  <!-- Android favicon / PWA icons -->
  <link rel="icon" type="image/png" sizes="192x192" href="/icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/icon-512.png">

  <!-- iOS –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="/icon-512.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icon-512.png">

  <title>–§—ñ–ª—å–º ‚Äî Relax Kino</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">


  <style>
    /* === üîπ –ë–ª–æ–∫ –¥—ñ–π –ø—Ä–∞–≤–æ—Ä—É—á –Ω–∞–¥ –ø–ª–µ—î—Ä–æ–º === */
    .film-actions {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 6px;
    }
    
    /* ‚ö† –õ—ñ–Ω–∫-–ø–æ—Å–∏–ª–∞–Ω–Ω—è */
    .report-link {
      font-size: 13px;
      color: #ffae42;
      cursor: pointer;
      text-decoration: underline;
      transition: color 0.2s;
    }
    .report-link:hover {
      color: #ffc374;
    }

  .report-btn{
      background:transparent; border:1px solid rgba(255,140,0,.6);
      color:#ffa500; font-size:14px; font-weight:700;
      padding:6px 10px; border-radius:8px; cursor:pointer; transition:.2s; margin-left:8px;
    }
    .report-btn:hover{ box-shadow:0 0 12px rgba(255,140,0,.35); transform:scale(1.03); }
    .modal-backdrop{ position:fixed; inset:0; background:rgba(0,0,0,.55); display:none; align-items:center; justify-content:center; z-index:9999; }
    .modal{ width:min(520px,92vw); background:#121317; border:1px solid #2a2d33; border-radius:14px; padding:14px; }
    .modal h3{margin:0 0 8px; color:#ffa500}
    .modal textarea{ width:100%; min-height:120px; resize:vertical; border-radius:10px; border:1px solid #333; background:#0f1014; color:#eee; padding:10px; }
    .modal .row{ display:flex; gap:8px; margin-top:10px; justify-content:flex-end; }
    .btn-ghost{ background:transparent; border:1px solid #444; color:#ddd; padding:8px 12px; border-radius:8px; cursor:pointer }
    .btn-send{ background:#ffa500; color:#111; font-weight:700; border:none; padding:8px 14px; border-radius:8px; cursor:pointer }

    .film-container { display: flex; flex-wrap: wrap; gap: 40px; margin-top: 40px; align-items: flex-start; }
    .film-left {
      flex: 1;
      min-width: 300px;
      max-width: 380px;
      width: 100%;
      background: #0b0b0b;
      border-radius: 12px;
      padding: 14px 16px;
      box-shadow: 0 0 18px rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.06);
      text-align: center;
    }
    .film-left img { width: 95%; max-width: 275px; border-radius: 10px; margin: 0 auto; display: block;
      box-shadow: 0 0 20px rgba(0, 255, 255, 0.25); border: 1px solid rgba(0, 255, 255, 0.25); transition: transform 0.3s ease; }
    .film-left img:hover { transform: scale(1.05); }
    /* --- –Ω–æ–≤–∏–π —Å—É—á–∞—Å–Ω–∏–π —á–æ—Ä–Ω–∏–π –±–ª–æ–∫ --- */
/* --- —á–æ—Ä–Ω–∏–π –∫–æ–º–ø–∞–∫—Ç–Ω–∏–π —Å—Ç–∏–ª—å –±–µ–∑ –∞–Ω—ñ–º–∞—Ü—ñ–π --- */
.film-meta {
  background: #0e0e0e;
  border-radius: 10px;
  padding: 12px 14px;
  margin-top: 14px;
  border: 1px solid rgba(255,255,255,0.06);
  display: flex;
  flex-direction: column;
  gap: 5px;
  box-shadow: inset 0 0 10px rgba(0,0,0,0.3);
}

.film-meta span {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: #131313;
  padding: 6px 10px;
  border-radius: 6px;
  color: #d8d8d8;
  font-size: 14px;
  font-weight: 500;
}

.film-meta span b {
  color: #888;
  font-weight: 600;
}

.film-meta span span {
  color: #eaeaea;
  font-weight: 600;
}

/* –±–µ–∑ –µ—Ñ–µ–∫—Ç—ñ–≤ –Ω–∞–≤–µ–¥–µ–Ω–Ω—è */
.film-meta span:hover,
.film-meta span:active {
  background: #131313;
  transform: none;
}


    .film-right { flex: 2; min-width: 400px; }
    .film-title { font-size: 28px; color: #00fff2; text-shadow: 0 0 18px #00fff2a0; margin-bottom: 15px; font-weight: 700; }

    /* –ü–µ—Ä–µ–º–∏–∫–∞—á –¥–∂–µ—Ä–µ–ª–∞ */
    .source-switch { display: flex; gap: 10px; margin: 0 0 10px 2px; }
    .source-switch button {
      padding: 10px 14px; border-radius: 10px; border: 1px solid rgba(0,255,242,0.35);
      background: #0f0f0f; color: #e9fefe; cursor: pointer; font-weight: 600;
      box-shadow: 0 0 18px rgba(0,255,242,0.1);
      transition: transform .12s ease, box-shadow .12s ease, background .12s ease, color .12s ease;
    }
    .source-switch button:hover { transform: translateY(-1px); box-shadow: 0 0 22px rgba(0,255,242,0.18); }
    .source-switch button.active {
      background: #0f0f0f;   /* —á–æ—Ä–Ω–∏–π */
      color: #e9fefe;        /* —Å–≤—ñ—Ç–ª–∏–π —Ç–µ–∫—Å—Ç */
      border: 1px solid rgba(0,255,242,0.35);
    }
    .source-switch button:disabled { opacity: .45; cursor: not-allowed; }

    .player-box { position: relative; background: #000; border-radius: 12px; border: 1px solid rgba(0,255,242,0.3); overflow: hidden; box-shadow: 0 0 30px rgba(0,255,242,0.15); }
    video { width: 100%; height: auto; display: block; border-radius: 12px; aspect-ratio: 16/9; }
    .film-description { margin-top: 25px; background: #1a1a1a; border-radius: 12px; border: 1px solid rgba(0,255,242,0.2);
      box-shadow: 0 0 30px rgba(0,255,242,0.1); padding: 20px 24px; color: #ddd; font-size: 16px; line-height: 1.7; }
    footer { margin-top: 80px; }
    /* –µ—Ñ–µ–∫—Ç –Ω–∞–≤–µ–¥–µ–Ω–Ω—è –Ω–∞ –≤–µ–ª–∏–∫—É –∫–Ω–æ–ø–∫—É Play */
    #bigPlayBtn:hover svg {
      transform: scale(1.1);
      filter: drop-shadow(0 0 8px #00fff2);
      transition: transform 0.25s ease, filter 0.25s ease;
    }

    .film-title{
  font-family: "Bebas Neue", system-ui, sans-serif;
  font-size: 42px;
  line-height: 1.05;
  letter-spacing: .5px;
  font-weight: 600;
  color: #00fff2;
  text-align: center;
  text-shadow: 0 0 12px rgba(0,255,255,.35);
  margin: 0 0 14px 0;
}
.film-left { text-align: center; } /* —â–æ–± –Ω–∞–∑–≤–∞ —ñ –ø–æ—Å—Ç–µ—Ä –±—É–ª–∏ –ø–æ —Ü–µ–Ω—Ç—Ä—É –ª—ñ–≤–æ—ó –∫–æ–ª–æ–Ω–∫–∏ */
.imdb-badge {
  display: inline-block;
  background: #f5c518;
  color: #000;
  font-weight: 700;
  font-size: 11px;
  border-radius: 3px;
  padding: 1px 4px;
  margin-right: 6px;
  font-family: Arial, sans-serif;
  letter-spacing: 0.5px;
  vertical-align: middle;
}
  .film-meta .imdb-badge {
  background: #f5c518 !important;
  color: #000 !important;
}
.tg-banner {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  gap: 8px;
  width: 95%;
  background: #0d0d0d;
  border: 1px solid rgba(255, 255, 255, 0.08);
  border-radius: 10px;
  padding: 10px 14px;
  color: #00fff2;
  text-decoration: none;
  font-weight: 500;
  font-size: 13.5px;
  margin: 0 auto 12px auto; /* –ø–æ —Ü–µ–Ω—Ç—Ä—É —ñ –∑ –≤—ñ–¥—Å—Ç—É–ø–æ–º */
  box-shadow: none;
  transition: none;
}

.tg-banner:hover {
  background: #0d0d0d; /* –±–µ–∑ –∑–º—ñ–Ω –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–Ω—ñ */
  transform: none;
  box-shadow: none;
}

.tg-icon {
  width: 18px;
  height: 18px;
  filter: invert(58%) sepia(82%) saturate(610%) hue-rotate(138deg) brightness(97%) contrast(97%);
}

.report-btn {
  background: transparent;
  border: none;
  color: #ff6b2b;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  float: right;
  margin-top: -34px; /* –ø—ñ–¥–Ω—ñ–º–∞—î –∫–Ω–æ–ø–∫—É –Ω–∞ —Ä—ñ–≤–µ–Ω—å —ñ–∑ –§—ñ–ª—å–º / –¢—Ä–µ–π–ª–µ—Ä */
  transition: color 0.2s ease;
}

.report-btn:hover {
  color: #ffa066;
  text-decoration: underline;
}
/* --- –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ --- */
.modal {
  display: none;
  position: fixed;
  z-index: 9999;
  left: 0; top: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.75);
}

.modal-content {
  background: #121212;
  color: #e0e0e0;
  margin: 10% auto;
  padding: 20px;
  border-radius: 10px;
  width: 90%;
  max-width: 400px;
  box-shadow: 0 0 15px rgba(0,0,0,0.5);
}

.modal-content h3 {
  margin-top: 0;
  color: #ff6b2b;
}

.modal-content textarea {
  width: 100%;
  background: #1b1b1b;
  border: 1px solid #444;
  color: #fff;
  border-radius: 6px;
  padding: 8px;
  resize: none;
}

.modal-buttons {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
  margin-top: 12px;
}

.modal-buttons button {
  padding: 6px 12px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  font-weight: 600;
}

.modal-buttons .cancel {
  background: #333;
  color: #ccc;
}

.modal-buttons .send {
  background: #ff6b2b;
  color: #fff;
}

.close-modal {
  float: right;
  font-size: 22px;
  cursor: pointer;
  color: #777;
}
.close-modal:hover { color: #fff; }
/* ===== üí¨ –°–ï–ö–¶–Ü–Ø –ö–û–ú–ï–ù–¢–ê–†–Ü–í ===== */
.comments-section {
  margin-top: 22px;
  background: #0d0d0d;
  border: 1px solid rgba(255,255,255,0.06);
  border-radius: 12px;
  padding: 16px;
  
  /* üîπ —Ä–æ–∑—Ç–∞—à—É–≤–∞–Ω–Ω—è –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –ø—Ä–∞–≤–æ—ó –∫–æ–ª–æ–Ω–∫–∏ */
  width: 100%;
  max-width: 100%;
  box-sizing: border-box;

  /* üîπ –ø—Ä–∏–±–∏—Ä–∞—î–º–æ –±—É–¥—å-—è–∫–µ —Ü–µ–Ω—Ç—Ä—É–≤–∞–Ω–Ω—è */
  margin-left: 0;
  margin-right: 0;
}



.comments-section h3 {
  color: #00fff2;
  font-size: 18px;
  margin: 0 0 12px 0;
}

/* –°–ø–∏—Å–æ–∫ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤ */
#commentsList {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin-bottom: 14px;
}

.comment {
  background: #121212;
  border-radius: 8px;
  padding: 10px;
  color: #ddd;
  font-size: 14px;
  border: 1px solid rgba(255,255,255,0.05);
}

.comment strong { color: #eaeaea; }

.comment small {
  display: block;
  color: #777;
  margin-top: 4px;
  font-size: 12px;
}

/* –§–æ—Ä–º–∞ –¥–ª—è –Ω–∞–ø–∏—Å–∞–Ω–Ω—è */
.comment-form {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.comment-form input,
.comment-form textarea {
  background: #131313;
  color: #fff;
  border: 1px solid #333;
  border-radius: 6px;
  padding: 8px;
  resize: vertical;
}

.comment-form button {
  align-self: flex-end;
  background: #00fff2;
  color: #001c1a;
  border: none;
  border-radius: 6px;
  font-weight: 700;
  padding: 7px 14px;
  cursor: pointer;
}

.comment-form button:disabled {
  opacity: .65;
  cursor: not-allowed;
}

/* ===== üé¨ –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω—ñ —Ñ—ñ–ª—å–º–∏ ===== */
.recommended-section {
  margin-top: 25px;
  margin-bottom: 25px;
  background: #0d0d0d;
  border: 1px solid rgba(255,255,255,0.06);
  border-radius: 12px;
  padding: 16px;
}

.recommended-section h3 {
  color: #00fff2;
  font-size: 18px;
  margin-bottom: 12px;
}

.recommended-list {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
}

.recommended-item {
  width: 100px;
  text-align: center;
  cursor: pointer;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.recommended-item:hover {
  transform: translateY(-4px);
}

.recommended-item img {
  width: 100%;
  height: 145px;
  object-fit: cover;
  border-radius: 8px;
}

.recommended-item p {
  margin-top: 6px;
  font-size: 13px;
  color: #ccc;
  line-height: 1.3;
}
  /* === ‚≠ê –ö–ù–û–ü–ö–ê –ó–ê–ö–õ–ê–î–û–ö === */
/* === ‚≠ê –ö–ù–û–ü–ö–ê –ó–ê–ö–õ–ê–î–û–ö === */
.bookmark-btn {
  background: transparent;
  border: 1px solid rgba(0,255,255,0.4);
  color: #00fff2;
  font-size: 15px;
  font-weight: 700;
  cursor: pointer;
  border-radius: 8px;
  padding: 6px 14px;
  margin-left: 10px;
  transition: all 0.25s ease;
  text-shadow: 0 0 8px rgba(0,255,255,0.6);
}
.bookmark-btn:hover {
  transform: scale(1.08);
  box-shadow: 0 0 14px rgba(0,255,255,0.45);
}

/* üî∏ –ö–æ–ª–∏ —Ñ—ñ–ª—å–º —É–∂–µ –≤ –∑–∞–∫–ª–∞–¥–∫–∞—Ö */
.bookmark-btn.active {
  border-color: gold;
  color: gold;
  text-shadow: 0 0 10px gold, 0 0 20px rgba(255,215,0,0.6);
  box-shadow: 0 0 15px rgba(255,215,0,0.3);
}
.bookmark-btn.active:hover {
  transform: scale(1.1);
  box-shadow: 0 0 25px rgba(255,215,0,0.5);
}

 /* === üé¨ –†—è–¥–æ–∫ —ñ–∑ –∫–Ω–æ–ø–∫–∞–º–∏ –§—ñ–ª—å–º / –¢—Ä–µ–π–ª–µ—Ä + –ó–∞–∫–ª–∞–¥–∫–∞ === */
.source-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  margin: 10px 0 14px 0;
}

/* –©–æ–± –∫–Ω–æ–ø–∫–∏ –§—ñ–ª—å–º / –¢—Ä–µ–π–ª–µ—Ä –Ω–µ –∑–ª–∏–ø–∞–ª–∏—Å—è */
.source-switch {
  display: flex;
  gap: 10px;
}



  </style>
</head>

<body>
<div id="header-placeholder"></div>
<script src="header.js"></script>




  <!-- === MAIN === -->
  <main>
    <div class="container film-container">
      <div class="film-left">
        <h1 class="film-title" id="filmTitle" data-enc=""></h1>
        <img id="filmPoster" src="" alt="–ü–æ—Å—Ç–µ—Ä">
        <div class="film-meta">
          <span><b>–†—ñ–∫:</b> <span id="filmYear"></span></span>
          <span><b>–ñ–∞–Ω—Ä:</b> <span id="filmGenre"></span></span>
          <span><b>–ö—Ä–∞—ó–Ω–∞:</b> <span id="filmCountry"></span></span>
          <span><b>–†–µ–∂–∏—Å–µ—Ä:</b> <span id="filmDirector"></span></span>
          <span><b>–í —Ä–æ–ª—è—Ö:</b> <span id="filmCast"></span></span>
          <span><b>–ó–≤—É–∫:</b> <span id="filmSound"></span></span>
          <span><b>–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å:</b> <span id="filmDuration"></span></span>
          <span><b>–í—ñ–∫:</b> <span id="filmAge"></span></span>
          <span>
            <span class="imdb-badge">IMDb</span>
            <span id="filmImdb"></span>
          </span>
        </div>
      </div>

      <div class="film-right">

        <!-- üîπ –¢–µ–ª–µ–≥—Ä–∞–º-–±–∞–Ω–µ—Ä -->
        <a href="https://t.me/RelaxBoxUA_bot?start=films_1234" target="_blank" class="tg-banner">
          <img src="https://upload.wikimedia.org/wikipedia/commons/8/82/Telegram_logo.svg" alt="Telegram" class="tg-icon">
          <span>üî• –ù–æ–≤–∏–Ω–∫–∏ –≤ –∫–∞–Ω–∞–ª—ñ, –ø–µ—Ä–µ–≥–ª—è–¥ —É –±–æ—Ç—ñ ‚Äî —É—Å–µ –≤ –æ–¥–Ω–æ–º—É –º—ñ—Å—Ü—ñ!</span>
        </a>
    

        <!-- –ü–µ—Ä–µ–º–∏–∫–∞—á –§—ñ–ª—å–º / –¢—Ä–µ–π–ª–µ—Ä -->
            <div class="source-row">
          <div class="source-switch">
            <button id="btnMovie" class="active">üé¨ –§—ñ–ª—å–º</button>
            <button id="btnTrailer">üéûÔ∏è –¢—Ä–µ–π–ª–µ—Ä</button>
          </div>
        
          <!-- üîπ –ë–ª–æ–∫ –¥—ñ–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ -->
          <div class="film-actions">
            <button id="bookmarkBtn" class="bookmark-btn">‚≠ê –î–æ–¥–∞—Ç–∏ –≤ –∑–∞–∫–ª–∞–¥–∫–∏</button>
            <div id="reportIssueBtn" class="report-link">‚ö† –ü–æ–≤—ñ–¥–æ–º–∏—Ç–∏ –ø—Ä–æ –ø—Ä–æ–±–ª–µ–º—É</div>
          </div>
        </div>



<div class="player-box">
  <div class="player-wrapper">
    <video id="filmPlayer" controls playsinline muted crossorigin="anonymous" preload="metadata"
      style="border-radius:12px;width:100%;height:auto;display:block;max-width:100vw;"></video>


    <!-- üîπ –í–µ–ª–∏–∫–∞ –∫–Ω–æ–ø–∫–∞ Play –ø–æ–≤–µ—Ä—Ö –≤—ñ–¥–µ–æ -->
    <div id="bigPlayBtn"
         style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;
                background:rgba(0,0,0,0.45);cursor:pointer;border-radius:12px;
                transition:opacity 0.3s ease;">
      <div style="width:100px;height:100px;border-radius:50%;background:rgba(0,0,0,0.6);
                  display:flex;align-items:center;justify-content:center;
                  box-shadow:0 0 25px rgba(0,255,255,0.5);">
        <svg width="58" height="58" viewBox="0 0 24 24" fill="#00fff2">
          <path d="M8 5v14l11-7z"/>
        </svg>
      </div>
    </div>
  </div>
</div>


       <div class="film-description">
        <h3>–ü—Ä–æ —â–æ —Ñ—ñ–ª—å–º:</h3>
        <p id="filmDesc">–û–ø–∏—Å —Ñ—ñ–ª—å–º—É...</p>
      </div>
      <!-- üé¨ –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω—ñ —Ñ—ñ–ª—å–º–∏ -->
      <div class="recommended-section">
        <h3>üéûÔ∏è –†–µ–∫–æ–º–µ–Ω–¥—É—î–º–æ –ø–æ–¥–∏–≤–∏—Ç–∏—Å—å</h3>
        <div id="recommendedList" class="recommended-list"></div>
      </div>


      <!-- üí¨ –ö–æ–º–µ–Ω—Ç–∞—Ä—ñ -->
      <div class="comments-section">
        <h3>üí¨ –ö–æ–º–µ–Ω—Ç–∞—Ä—ñ</h3>

        <div id="commentsList"></div>

        <div class="comment-form">
          <input type="text" id="username" placeholder="–í–∞—à–µ —ñ–º‚Äô—è (–Ω–µ–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ)">
          <textarea id="commentText" placeholder="–ù–∞–ø–∏—à—ñ—Ç—å —Å–≤—ñ–π –∫–æ–º–µ–Ω—Ç–∞—Ä..." rows="3"></textarea>
          <button id="sendComment">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏</button>
        </div>
      </div>
    </div>
  </div>
</main>

  <footer>¬© 2025 KinoSite ‚Ä¢ –£—Å—ñ –ø—Ä–∞–≤–∞ –∑–∞—Ö–∏—â–µ–Ω—ñ</footer>

  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const supabaseUrl = "https://zerlqvbmqszomlondlte.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InplcmxxdmJtcXN6b21sb25kbHRlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUzMzg3NzQsImV4cCI6MjA3MDkxNDc3NH0.8wUBYIeQRC6KVp6vdzv0oqofIf4PeZyzbV5GcD0vxTE";
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

    let hls = null;                   // –ø–æ—Ç–æ—á–Ω–∏–π Hls-—ñ–Ω—Å—Ç–∞–Ω—Å (—â–æ–± –∫–æ—Ä–µ–∫—Ç–Ω–æ —Ä—É–π–Ω—É–≤–∞—Ç–∏)
    let currentSource = "movie";      // 'movie' –∞–±–æ 'trailer'
    let movieUrl = "";                // –≥–æ–ª–æ–≤–Ω–∏–π –ø–æ—Ç—ñ–∫
    let trailerUrl = "";              // —Ç—Ä–µ–π–ª–µ—Ä

    // === üîß –•–µ–ª–ø–µ—Ä–∏ –¥–ª—è PWA-–≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è —ñ PiP ===

// –ü–æ—Ç–æ—á–Ω–∏–π id —Ñ—ñ–ª—å–º—É
function getFilmId() {
  const params = new URLSearchParams(window.location.search);
  return params.get("id") || "unknown";
}

// –ë—É–¥—É—î–º–æ <video> –∑ —É—Å—ñ–º–∞ –ø–æ—Ç—Ä—ñ–±–Ω–∏–º–∏ –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏
function buildVideoTag() {
  return `
    <video id="filmPlayer"
      controls
      playsinline
      webkit-playsinline
      crossorigin="anonymous"
      preload="metadata"
      style="border-radius:12px;width:100%;height:auto;display:block;max-width:100vw;">
    </video>`;
}


// –ü—Ä–∏–≤'—è–∑—É—î–º–æ UX: –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è, –∞–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è, PiP
function bindPlayerUX(player) {
  const filmId = getFilmId();
  const keyPos = `playback_${filmId}`;
  const keyState = `playstate_${filmId}`;

  // üîπ –í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ–∑–∏—Ü—ñ—ó —Ç–∞ —Å—Ç–∞–Ω—É
  player.addEventListener("loadedmetadata", () => {
    const saved = parseFloat(localStorage.getItem(keyPos) || "0");
    if (saved && saved > 1) player.currentTime = saved;


      // –Ø–∫—â–æ —î –≥–ª–æ–±–∞–ª—å–Ω–∏–π –∑–∞–ø–∏—Å –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É ‚Äî —Ç–µ–∂ –≤—ñ–¥–Ω–æ–≤–ª—é—î–º–æ
      const last = JSON.parse(localStorage.getItem("lastWatched") || "null");
      if (last && last.id === filmId && last.time && last.time > 1) {
        player.currentTime = last.time;
      }


    const wasPlaying = localStorage.getItem(keyState) === "playing";
    if (wasPlaying && document.visibilityState === "visible") {
      player.play().catch(() => {});
    }
  });

  // üîπ –ó–∞–ø–∏—Å—É—î–º–æ –ø–æ–∑–∏—Ü—ñ—é –ø—ñ–¥ —á–∞—Å –ø–µ—Ä–µ–≥–ª—è–¥—É
  player.addEventListener("timeupdate", () => {
    if (!player.seeking && !player.paused) {
      localStorage.setItem(keyPos, player.currentTime);
    }
  });

  // üîπ –§—ñ–∫—Å—É—î–º–æ —Å—Ç–∞–Ω (–≥—Ä–∞–≤ / –ø–∞—É–∑–∞)
  player.addEventListener("play", () => localStorage.setItem(keyState, "playing"));
  player.addEventListener("pause", () => localStorage.setItem(keyState, "paused"));

  // üîπ –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä–∏—Ç—Ç—è–º —Å—Ç–æ—Ä—ñ–Ω–∫–∏
  window.addEventListener("pagehide", () => {
    localStorage.setItem(keyPos, player.currentTime);
  });

  document.addEventListener("visibilitychange", () => {
    if (document.visibilityState === "hidden") {
      localStorage.setItem(keyPos, player.currentTime);
    }
  });
    // üîπ –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –æ—Å—Ç–∞–Ω–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏–π —Ñ—ñ–ª—å–º
  player.addEventListener("timeupdate", () => {
    if (player.currentTime > 30) { // –ø—ñ—Å–ª—è 30 —Å–µ–∫—É–Ω–¥
      const filmTitle = document.getElementById("filmTitle")?.textContent.trim() || "–ë–µ–∑ –Ω–∞–∑–≤–∏";
      const filmPoster = document.getElementById("filmPoster")?.src || "";
      const filmId = getFilmId();
      const data = {
        id: filmId,
        title: filmTitle,
        poster: filmPoster,
        type: "–§—ñ–ª—å–º",
        time: player.currentTime
      };
      localStorage.setItem("lastWatched", JSON.stringify(data));
    }
  });

}




    function destroyHls() {
      if (hls) {
        try { hls.destroy(); } catch(e) {}
        hls = null;
      }
    }
// YouTube helpers
function isYouTube(url) {
  return /youtube\.com|youtu\.be|googlevideo\.com/.test(url || "");
}

// –°–ø—Ä–æ–±—É–≤–∞—Ç–∏ –≤–∏—Ç—è–≥–Ω—É—Ç–∏ YouTube ID –∑ —Ä—ñ–∑–Ω–∏—Ö —Ñ–æ—Ä–º–∞—Ç—ñ–≤ (watch?v=, youtu.be/, embed/)
function getYouTubeId(url) {
  if (!url) return "";
  // –∫–ª–∞—Å–∏—á–Ω—ñ —Ñ–æ—Ä–º–∞—Ç–∏
  const m1 = url.match(/(?:v=|\/)([0-9A-Za-z_-]{11})(?:[?&]|$)/);
  if (m1) return m1[1];
  // —è–∫—â–æ –∫–∏–Ω—É–ª–∏ —á–∏—Å—Ç–∏–π ID - 11 —Å–∏–º–≤–æ–ª—ñ–≤
  const m2 = url.match(/^[0-9A-Za-z_-]{11}$/);
  if (m2) return m2[0];
  return ""; // –¥–ª—è googlevideo –∫—Ä–∞—â–µ –≤–Ω–æ—Å–∏—Ç–∏ –Ω–æ—Ä–º–∞–ª—å–Ω–∏–π YouTube-URL —É —Ç–∞–±–ª–∏—Ü—é
}

 function setupPlayer(url) {
  const player = document.getElementById("filmPlayer");

  destroyHls();

  try { player.pause(); } catch(e) {}
  player.removeAttribute("src");
  player.load();

  if (!url) {
    console.warn("–ü–æ—Ä–æ–∂–Ω—ñ–π URL");
    return;
  }

  // === Google Drive ===
  if (url.includes("drive.google.com") || url.includes("uc?export=download")) {
    const fileId = url.match(/\/d\/([^/]+)/)?.[1];
    player.src = fileId
      ? `https://drive.google.com/uc?export=download&id=${fileId}`
      : url;

    bindPlayerUX(player);
    return;
  }

  // === YouTube ‚Üí iframe ===
  if (
    url.includes("youtube.com") ||
    url.includes("youtu.be") ||
    url.includes("googlevideo.com")
  ) {
    player.outerHTML = `
      <iframe width="100%" height="480"
        src="${url}"
        frameborder="0"
        allow="autoplay; encrypted-media; picture-in-picture"
        allowfullscreen
        style="border-radius:12px;width:100%;aspect-ratio:16/9;">
      </iframe>`;
    return;
  }

  // === HLS (.m3u8) ===
  if (url.includes(".m3u8")) {
    if (window.Hls && Hls.isSupported()) {

      hls = new Hls({
        maxBufferLength: 30,
        enableWorker: true,
        lowLatencyMode: true,
        xhrSetup: function (xhr, url) {
          xhr.withCredentials = false;
        }
      });

      hls.loadSource(url);
      hls.attachMedia(player);
      bindPlayerUX(player);

    } else if (player.canPlayType("application/vnd.apple.mpegurl")) {
      player.src = url;
      bindPlayerUX(player);
    }
    return;
  }

  // === MP4 —ñ–Ω—à—ñ —Ñ–æ—Ä–º–∞—Ç–∏ ===
  player.src = url;
  bindPlayerUX(player);
}

   async function loadFilm() {
  const params = new URLSearchParams(window.location.search);
  const idParam = params.get("id");

  console.log("üîé URL id =", idParam); // –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

  let data = null, error = null;

  try {
    if (idParam) {
      // –Ø–∫—â–æ id —î –≤ URL ‚Äî –±–µ—Ä–µ–º–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π –∑–∞–ø–∏—Å
      const idNum = isNaN(Number(idParam)) ? idParam : Number(idParam);
      ({ data, error } = await supabase
        .from("films_site")
        .select("*")
        .eq("id", idNum)
        .single());
    } else {
      // Fallback: —è–∫—â–æ id –ù–ï –ø–µ—Ä–µ–¥–∞–ª–∏ ‚Äî –±–µ—Ä–µ–º–æ –æ—Å—Ç–∞–Ω–Ω—ñ–π –∑–∞–ø–∏—Å (–¥–µ —î title)
      ({ data, error } = await supabase
        .from("films_site")
        .select("*")
        .order("id", { ascending: false })
        .limit(1)
        .maybeSingle());
    }
  } catch (e) {
    console.error("‚ùå –í–∏–Ω—è—Ç–æ–∫ Supabase:", e);
  }

  if (error || !data) {
    console.error("‚ùå –ü–æ–º–∏–ª–∫–∞ Supabase:", error?.message || "–ø–æ—Ä–æ–∂–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥—å");
    document.getElementById("filmTitle").textContent = "–§—ñ–ª—å–º –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ";
    return;
  }
// üß© –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ PRO-–¥–æ—Å—Ç—É–ø—É
let hasPro = true; // –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –≤–º–∏–∫–∞—î–º–æ (–¥–ª—è –∑–≤–∏—á–∞–π–Ω–∏—Ö —Ñ—ñ–ª—å–º—ñ–≤)

if (String(data.pro_access || '').toUpperCase() === 'PRO') {
  hasPro = false;

  const tgUser = localStorage.getItem('telegram_user');
  const emailUser = localStorage.getItem('email_user');
  const webId = localStorage.getItem('web_id');
  let url = window.APPS_SCRIPT_URL;

  try {
    // üü¢ 1Ô∏è‚É£ Telegram-–≤—Ö—ñ–¥ (id –∑–∞–≤–∂–¥–∏ —á–∏—Å–ª–æ–≤–∏–π)
    if (tgUser) {
      const parsed = JSON.parse(tgUser);
      if (parsed?.id) {
        url += `?user_id=${encodeURIComponent(parsed.id)}`;
      }

    // üü£ 2Ô∏è‚É£ Email-–≤—Ö—ñ–¥ (WEB-ID)
    } else if (webId) {
      url += `?user_id=${encodeURIComponent(webId)}`;

    // üî∏ 3Ô∏è‚É£ fallback ‚Äî —è–∫—â–æ id –∑–±–µ—Ä—ñ–≥—Å—è –≤ emailUser
    } else if (emailUser) {
      const parsed = JSON.parse(emailUser);
      if (parsed?.id) {
        url += `?user_id=${encodeURIComponent(parsed.id)}`;
      }
    }

    console.log("üì° URL –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ PRO:", url);
    const res = await fetch(url);
    const json = await res.json();
    hasPro = json?.isPro === true;
    console.log("üîé –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ PRO:", json);

  } catch (err) {
    console.warn("‚ùå –ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ PRO:", err);
  }

  // üíé –Ø–∫—â–æ PRO –Ω–µ–∞–∫—Ç–∏–≤–Ω–∏–π ‚Äî –±–ª–æ–∫—É—î–º–æ –≤—ñ–¥–µ–æ
  if (!hasPro) {
    const playerBox = document.querySelector(".player-box");
    playerBox.innerHTML = `
      <div style="
        background:#000;
        color:#00fff2;
        text-align:center;
        padding:40px;
        border-radius:12px;
        border:1px solid rgba(0,255,255,0.3);
        box-shadow:0 0 30px rgba(0,255,255,0.15);
      ">
        üíé –¶–µ–π —Ñ—ñ–ª—å–º –¥–æ—Å—Ç—É–ø–Ω–∏–π –ª–∏—à–µ –¥–ª—è PRO –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤.<br><br>
        <a href="profile.html" style="color:#fff;text-decoration:underline;">–û—Ç—Ä–∏–º–∞—Ç–∏ PRO</a>
      </div>
    `;
  }
}


  // üü¢ –ó–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö
  document.getElementById("filmPoster").src = data.poster || "";
  // üß© –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ –±–æ—Ç—ñ–≤ –∑ "—Å—ñ–ª–ª—é" (salt)
  const titleEl = document.getElementById("filmTitle");
  if (titleEl && data.title) {
    const salt = "relaxbox2025"; // –º–æ–∂–µ—à –∑–º—ñ–Ω–∏—Ç–∏
    // –ö–æ–¥—É—î–º–æ —Ç–µ–∫—Å—Ç –±–µ–∑ –≤—Ç—Ä–∞—Ç–∏ —É–∫—Ä–∞—ó–Ω—Å—å–∫–∏—Ö —Å–∏–º–≤–æ–ª—ñ–≤
    const encoded = btoa(encodeURIComponent(data.title + "||" + salt));
    titleEl.dataset.enc = encoded;
    
    // –†–æ–∑—à–∏—Ñ—Ä–æ–≤—É—î–º–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ
    try {
      const decoded = decodeURIComponent(atob(encoded)).split("||")[0];
      titleEl.textContent = decoded;
    } catch (e) {
      console.warn("–ü–æ–º–∏–ª–∫–∞ –¥–µ–∫–æ–¥—É–≤–∞–Ω–Ω—è –Ω–∞–∑–≤–∏:", e);
      titleEl.textContent = data.title; // –∑–∞–ø–∞—Å–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç
    }
 } 

  document.getElementById("filmDesc").textContent = data.description || "–û–ø–∏—Å –≤—ñ–¥—Å—É—Ç–Ω—ñ–π";
  document.getElementById("filmYear").textContent = data.year || "";
  document.getElementById("filmGenre").textContent = data.genre || "";
  document.getElementById("filmCountry").textContent = data.country || "";
  document.getElementById("filmDirector").textContent = data.director || "";
  document.getElementById("filmCast").textContent = data.cast || "";
  document.getElementById("filmSound").textContent = data.sound || "";
  document.getElementById("filmDuration").textContent = data.duration || "";
  document.getElementById("filmAge").textContent = data.age || "";
  document.getElementById("filmImdb").textContent = data.imdb || "‚Äî";
  // üü¢ –ó–∞–ø—É—Å–∫–∞—î–º–æ –ø—ñ–¥–±—ñ—Ä–∫—É —Å—Ö–æ–∂–∏—Ö —Ñ—ñ–ª—å–º—ñ–≤
  loadRecommendedFilms(data.title, data.genre);


     




     


  // üîó –î–∂–µ—Ä–µ–ª–∞
  movieUrl   = data.stream_url   || "";
  trailerUrl = data.trailer_url  || "";

  // üõ°Ô∏è –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ –º–∞—Å–∫–æ–≤–∞–Ω–∏–π Worker
 const WORKER_URL = "https://kino-hls-stealth.lyuda14070702.workers.dev";
  
  // filmId —É —Ç–µ–±–µ —î –≤ –∫–æ–¥—ñ loadFilm()
  movieUrl = WORKER_URL + "/proxy?src=" + encodeURIComponent(data.stream_url);





  // üéõÔ∏è –ö–Ω–æ–ø–∫–∏
  const btnMovie   = document.getElementById("btnMovie");
  const btnTrailer = document.getElementById("btnTrailer");

  btnMovie.classList.add("active");
  btnTrailer.classList.remove("active");
btnTrailer.disabled = !trailerUrl;

// ‚ñ∂Ô∏è –ü–æ—á–∞—Ç–∫–æ–≤–æ –ø–æ–∫–∞–∑—É—î–º–æ –§–Ü–õ–¨–ú —É –∑–≤–∏—á–∞–π–Ω–æ–º—É –≤—ñ–¥–µ–æ-–ø–ª–µ—î—Ä—ñ (–±–µ–∑ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫—É)
currentSource = "movie";

// —è–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–∞—î PRO ‚Äî –ø–æ–∫–∞–∑—É—î–º–æ –≤—ñ–¥–µ–æ
if (hasPro) {
  document.querySelector(".player-box").innerHTML = buildVideoTag();
  setupPlayer(movieUrl);

}
// —è–∫—â–æ –ù–ï –º–∞—î PRO ‚Äî –ø–æ–∫–∞–∑—É—î–º–æ –±–∞–Ω–µ—Ä
else {
  document.querySelector(".player-box").innerHTML = `
    <div style="
      background:#000;
      color:#00fff2;
      text-align:center;
      padding:45px 20px;
      border-radius:12px;
      border:1px solid rgba(0,255,255,0.3);
      box-shadow:0 0 30px rgba(0,255,255,0.15);
      font-size:18px;
      line-height:1.6;
    ">
      üíé –¶–µ–π —Ñ—ñ–ª—å–º –¥–æ—Å—Ç—É–ø–Ω–∏–π –ª–∏—à–µ –¥–ª—è <b>PRO –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</b>.<br><br>
      <a href="profile.html" 
         style="color:#fff;text-decoration:underline;font-weight:600;">
         –û—Ç—Ä–∏–º–∞—Ç–∏ PRO –¥–æ—Å—Ç—É–ø
      </a>
    </div>
  `;
}


// üñ±Ô∏è –û–±—Ä–æ–±–Ω–∏–∫–∏ –∫–ª—ñ–∫—ñ–≤
btnMovie.addEventListener("click", () => {
  if (currentSource === "movie") return;
  currentSource = "movie";
  btnMovie.classList.add("active");
  btnTrailer.classList.remove("active");

  const box = document.querySelector(".player-box");
  box.innerHTML = buildVideoTag();
  if (hasPro) {
    setupPlayer(movieUrl);
  }
});

  btnTrailer.addEventListener("click", () => {
    if (!trailerUrl) return;
    if (currentSource === "trailer") return;
    currentSource = "trailer";
    btnTrailer.classList.add("active");
    btnMovie.classList.remove("active");

    const box = document.querySelector(".player-box");

    // –Ø–∫—â–æ —Ç—Ä–µ–π–ª–µ—Ä –∑ YouTube/GoogleVideo ‚Äî –ø–æ–∫–∞–∑—É—î–º–æ iframe
    if (
      trailerUrl.includes("youtube.com") ||
      trailerUrl.includes("youtu.be") ||
      trailerUrl.includes("googlevideo.com")
    ) {
      // –°–ø—Ä–æ–±–∞ –≤–∏—Ç—è–≥–Ω—É—Ç–∏ YouTube ID
      const m = trailerUrl.match(/(?:v=|\/)([0-9A-Za-z_-]{11})/);
      const ytId = m ? m[1] : "";
      const src = ytId ? `https://www.youtube.com/embed/${ytId}` : trailerUrl;

      box.innerHTML = `
        <iframe
          width="100%" height="480"
          src="${src}"
          frameborder="0"
          allow="autoplay; encrypted-media; picture-in-picture"
          allowfullscreen
          style="border-radius:12px;width:100%;aspect-ratio:16/9;">
        </iframe>`;

    } else {
      // –Ü–Ω–∞–∫—à–µ ‚Äî –∑–≤–∏—á–∞–π–Ω–∏–π –≤—ñ–¥–µ–æ-–ø–ª–µ—î—Ä
      box.innerHTML = buildVideoTag();
      setupPlayer(trailerUrl);

    }
  });
  
}


    function scrollSlider(direction) {
      const slider = document.getElementById("sliderRow");
      const scrollAmount = 300;
      slider.scrollBy({ left: scrollAmount * direction, behavior: "smooth" });
    }

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏
    loadFilm();
    // === ‚≠ê –ó–ê–ö–õ–ê–î–ö–ò ===
function getBookmarks() {
  try { return JSON.parse(localStorage.getItem("bookmarks") || "[]"); }
  catch { return []; }
}
function setBookmarks(arr) {
  localStorage.setItem("bookmarks", JSON.stringify(arr));
}
function isBookmarked(id) {
  const list = getBookmarks();
  return list.some(x => String(x.id) === String(id) && x.type === "–§—ñ–ª—å–º");
}
function updateBookmarkBtn(id) {
  const btn = document.getElementById("bookmarkBtn");
  if (!btn) return;
  const active = isBookmarked(id);
  btn.textContent = active ? "‚≠ê –£ –∑–∞–∫–ª–∞–¥–∫–∞—Ö" : "‚≠ê –î–æ–¥–∞—Ç–∏ –≤ –∑–∞–∫–ª–∞–¥–∫–∏";
  btn.classList.toggle("active", active);
}


document.getElementById("bookmarkBtn")?.addEventListener("click", () => {
  const params = new URLSearchParams(window.location.search);
  const idParam = params.get("id"); // ‚ö†Ô∏è –æ—Ç—Ä–∏–º–∞—î–º–æ id=3 –∑ URL

  const title = document.getElementById("filmTitle")?.textContent.trim();
  const poster = document.getElementById("filmPoster")?.src;
  const year = document.getElementById("filmYear")?.textContent.trim();
  const genre = document.getElementById("filmGenre")?.textContent.trim();
  const imdb = document.getElementById("filmImdb")?.textContent.trim();

  let list = getBookmarks();
  const exists = isBookmarked(idParam);

  if (exists) {
    list = list.filter(x => !(String(x.id) === String(idParam) && x.type === "–§—ñ–ª—å–º"));
    setBookmarks(list);
    updateBookmarkBtn(idParam);
    alert("‚ùå –í–∏–¥–∞–ª–µ–Ω–æ —ñ–∑ –∑–∞–∫–ª–∞–¥–æ–∫");
  } else {
    list.push({
      id: idParam, // ‚ö†Ô∏è –æ—Å—å –≥–æ–ª–æ–≤–Ω–µ ‚Äî –∑–±–µ—Ä—ñ–≥–∞—î–º–æ ID —Ñ—ñ–ª—å–º—É
      title,
      poster,
      year,
      genre,
      imdb,
      type: "–§—ñ–ª—å–º"
    });
    setBookmarks(list);
    updateBookmarkBtn(idParam);
    alert("‚úÖ –î–æ–¥–∞–Ω–æ —É –∑–∞–∫–ª–∞–¥–∫–∏");
  }
});


// –ü—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ ‚Äî –æ–Ω–æ–≤–ª—é—î–º–æ —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
window.addEventListener("DOMContentLoaded", () => {
  const params = new URLSearchParams(window.location.search);
  const id = params.get("id");
  if (id) updateBookmarkBtn(id);
});

    // ===== üé¨ –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω—ñ —Ñ—ñ–ª—å–º–∏ =====
// === üé¨ –†–æ–∑—É–º–Ω–∏–π –ø–æ—à—É–∫ —ñ–∑ fallback (—É–∫—Ä–∞—ó–Ω—Å—å–∫–∞ + –∞–Ω–≥–ª—ñ–π—Å—å–∫–∞ + –∂–∞–Ω—Ä) ===
async function loadRecommendedFilms(title, genre) {
  const list = document.getElementById("recommendedList");
  if (!list) return;
  list.innerHTML = "<p style='color:#777'>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</p>";

  const cleanTitle = (title || "").trim().toLowerCase();

  // üî§ –¢—Ä–∞–Ω—Å–ª—ñ—Ç
  const translitMap = {
    –∞:"a",–±:"b",–≤:"v",–≥:"h",“ë:"g",–¥:"d",–µ:"e",—î:"ye",–∂:"zh",–∑:"z",–∏:"y",—ñ:"i",—ó:"yi",–π:"y",
    –∫:"k",–ª:"l",–º:"m",–Ω:"n",–æ:"o",–ø:"p",—Ä:"r",—Å:"s",—Ç:"t",—É:"u",—Ñ:"f",—Ö:"kh",—Ü:"ts",—á:"ch",
    —à:"sh",—â:"shch",—é:"yu",—è:"ya"
  };
  const transliterate = text => text.split("").map(ch => translitMap[ch] || ch).join("");

  const baseWord = cleanTitle
    .replace(/[:\-‚Äì]/g, " ")
    .replace(/\b\d+\b/g, "")
    .split(" ")
    .filter(w => w.length > 2)[0] || "";

  const translitWord = transliterate(baseWord);
  const cleanGenre = (genre || "").trim().toLowerCase();

  if (!baseWord) {
    list.innerHTML = "<p style='color:#888'>–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è –ø–æ—à—É–∫—É</p>";
    return;
  }

  // üîé 1Ô∏è‚É£ –û—Å–Ω–æ–≤–Ω–∏–π –ø–æ—à—É–∫ –ø–æ –Ω–∞–∑–≤—ñ
  let { data, error } = await supabase
    .from("films_site")
    .select("id,title,poster,genre")
    .or(`title.ilike.%${baseWord}%,title.ilike.%${translitWord}%`)
    .limit(50);

  // üîÑ 2Ô∏è‚É£ –Ø–∫—â–æ –ø–æ—Ä–æ–∂–Ω—å–æ ‚Äî —à—É–∫–∞—î–º–æ –∑–∞ –∂–∞–Ω—Ä–æ–º
  if ((!data || data.length === 0) && cleanGenre) {
    ({ data, error } = await supabase
      .from("films_site")
      .select("id,title,poster,genre")
      .ilike("genre", `%${cleanGenre}%`)
      .limit(30));
  }

  if (error) {
    console.error("‚ùå –ü–æ–º–∏–ª–∫–∞ Supabase:", error);
    list.innerHTML = "<p style='color:#888'>–ü–æ–º–∏–ª–∫–∞ –∑–∞–ø–∏—Ç—É</p>";
    return;
  }

  if (!data || data.length === 0) {
    list.innerHTML = "<p style='color:#888'>–°—Ö–æ–∂–∏—Ö —Ñ—ñ–ª—å–º—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</p>";
    return;
  }

  // üßπ –ü—Ä–∏–±–∏—Ä–∞—î–º–æ –¥—É–±–ª—ñ–∫–∞—Ç–∏ —ñ —Å–∞–º –ø–æ—Ç–æ—á–Ω–∏–π —Ñ—ñ–ª—å–º
  const seen = new Set();
  const current = cleanTitle.toLowerCase();
  const unique = data.filter(f => {
    const name = (f.title || "").trim().toLowerCase();
    if (!name || seen.has(name) || name === current) return false;
    seen.add(name);
    return (
      name.includes(baseWord) ||
      name.includes(translitWord) ||
      (f.genre && f.genre.toLowerCase().includes(cleanGenre))
    );
  });

  // üì¶ –Ø–∫—â–æ –º–∞–ª–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ ‚Äî –¥–æ–∑–∞–ø–æ–≤–Ω–∏–º–æ –≤–∏–ø–∞–¥–∫–æ–≤–∏–º–∏ —Ç–æ–≥–æ –∂ –∂–∞–Ω—Ä—É
  let selected = unique.slice(0, 6);
  if (selected.length < 3 && cleanGenre) {
    const { data: extra } = await supabase
      .from("films_site")
      .select("id,title,poster,genre")
      .ilike("genre", `%${cleanGenre}%`)
      .limit(10);
    if (extra) {
      const more = extra.filter(f => !seen.has(f.title?.toLowerCase()));
      selected = [...selected, ...more].slice(0, 6);
    }
  }

  // üñºÔ∏è –í–∏–≤—ñ–¥
  list.innerHTML = "";
  if (selected.length === 0) {
    list.innerHTML = "<p style='color:#888'>–°—Ö–æ–∂–∏—Ö —Ñ—ñ–ª—å–º—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</p>";
    return;
  }

  selected.forEach(film => {
    const item = document.createElement("div");
    item.className = "recommended-item";
    item.innerHTML = `
      <img src="${film.poster || 'https://via.placeholder.com/200x300?text=No+Poster'}" alt="${film.title}">
      <p>${film.title}</p>
    `;
    // ‚ùó –ë–ï–ó –∑–≤–æ—Ä–æ—Ç–Ω–∏—Ö —Å–ª–µ—à—ñ–≤
    item.addEventListener("click", () => {
      window.location.href = 'film.html?id=' + film.id;
    });
    list.appendChild(item);
  });
}





  </script>
<!-- üßæ –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ -->
<div id="reportModal" class="modal">
  <div class="modal-content">
    <span class="close-modal">&times;</span>
    <h3>‚ö† –ü–æ–≤—ñ–¥–æ–º–∏—Ç–∏ –ø—Ä–æ –ø—Ä–æ–±–ª–µ–º—É</h3>
    <p>–û–ø–∏—à—ñ—Ç—å –∫–æ—Ä–æ—Ç–∫–æ, —â–æ –Ω–µ –ø—Ä–∞—Ü—é—î (–ø–æ—Å–∏–ª–∞–Ω–Ω—è, –ø–ª–µ—î—Ä —Ç–æ—â–æ):</p>
    <textarea id="reportText" rows="4" placeholder="–ö–æ—Ä–æ—Ç–∫–æ –æ–ø–∏—à—ñ—Ç—å –ø—Ä–æ–±–ª–µ–º—É..."></textarea>
    <div class="modal-buttons">
      <button id="reportCancel" class="cancel">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
      <button id="reportSend" class="send">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏</button>
    </div>
  </div>
</div>

<script>
(function(){
  const modal = document.getElementById("reportModal");
  const txt = document.getElementById("reportText");
  const btnOpen = document.getElementById("reportIssueBtn");
  const btnSend = document.getElementById("reportSend");
  const btnCancel = document.getElementById("reportCancel");
  const btnClose = document.querySelector(".close-modal");

  if (!btnOpen || !modal) return;

  // –í—ñ–¥–∫—Ä–∏—Ç–∏
  btnOpen.addEventListener("click", () => {
    modal.style.display = "block";
    txt.focus();
  });

  // –ó–∞–∫—Ä–∏—Ç–∏ –∫–Ω–æ–ø–∫–∞–º–∏
  [btnCancel, btnClose].forEach(btn =>
    btn?.addEventListener("click", () => {
      modal.style.display = "none";
      txt.value = "";
    })
  );

  // –ó–∞–∫—Ä–∏—Ç–∏ –∫–ª—ñ–∫–æ–º –ø–æ–∑–∞ –≤—ñ–∫–Ω–æ–º
  modal.addEventListener("click", (e) => {
    if (e.target === modal) modal.style.display = "none";
  });

  // –ù–∞–¥—ñ—Å–ª–∞—Ç–∏
  async function sendReport(item_type, titleElId) {
    const message = (txt.value || "").trim();
    if (message.length < 5) return alert("–û–ø–∏—à—ñ—Ç—å –ø—Ä–æ–±–ª–µ–º—É –¥–µ—Ç–∞–ª—å–Ω—ñ—à–µ (–º—ñ–Ω—ñ–º—É–º 5 —Å–∏–º–≤–æ–ª—ñ–≤).");

    const title = (document.getElementById(titleElId)?.textContent || "").trim();
    let user = null;
    try {
      user = JSON.parse(localStorage.getItem("telegram_user") || "null");
    } catch {}

    const payload = {
      user_id: user?.id ? String(user.id) : null,
      user_name:
        [user?.first_name, user?.last_name].filter(Boolean).join(" ") ||
        user?.username ||
        null,
      item_type,
      item_title: title,
      page_url: location.href,
      content: message,
      status: "new",
    };

    const { error } = await supabase.from("feedback_reports").insert(payload);
    if (error) {
      console.error(error);
      alert("–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥ —á–∞—Å –≤—ñ–¥–ø—Ä–∞–≤–∫–∏. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.");
      return;
    }

    modal.style.display = "none";
    txt.value = "";
    alert("‚úÖ –î—è–∫—É—î–º–æ! –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ.");
  }

  btnSend.onclick = () => sendReport("–§—ñ–ª—å–º", "filmTitle");
})();
</script>


</div>
<!-- üí¨ –ö–æ–º–µ–Ω—Ç–∞—Ä—ñ Supabase -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  const supabaseUrl = "https://zerlqvbmqszomlondlte.supabase.co";
  const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InplcmxxdmJtcXN6b21sb25kbHRlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUzMzg3NzQsImV4cCI6MjA3MDkxNDc3NH0.8wUBYIeQRC6KVp6vdzv0oqofIf4PeZyzbV5GcD0vxTE";
  const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
</script>

<!-- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –ª–æ–≥—ñ–∫–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤ -->
<script src="comments.js"></script>
<script>
  window.APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwUULSEmTKFORqOa3VwnQijTmNGw7Mt8bFd82G_HR7xwPSNlarMzE3Tmyrn1nju5WVPbA/exec";
</script>
  
<script src="auth.js"></script>
<div id="footer-placeholder"></div>
<script>
  fetch("footer.html")
    .then(res => res.text())
    .then(html => {
      document.getElementById("footer-placeholder").innerHTML = html;
      // –ø—ñ—Å–ª—è —Ç–æ–≥–æ —è–∫ —Ñ—É—Ç–µ—Ä –∑‚Äô—è–≤–∏–≤—Å—è —É DOM ‚Äî –ø—ñ–¥–∫–ª—é—á–∞—î–º–æ –ª–æ–≥—ñ–∫—É
      const s = document.createElement("script");
      s.src = "footer.js";
      document.body.appendChild(s);
    });
</script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const el = document.querySelector("#filmTitle[data-enc]");
  if (el && el.dataset.enc && !el.textContent.trim()) {
    try {
      const decoded = decodeURIComponent(atob(el.dataset.enc)).split("||")[0];
      el.textContent = decoded;
    } catch (e) {
      console.warn("–ü–æ–º–∏–ª–∫–∞ –¥–µ–∫–æ–¥—É–≤–∞–Ω–Ω—è:", e);
    }
  }
});
</script>

<!-- <script src="/sw-register.js"></script> -->

<script src="seo.js"></script>

<script>
// üß© –í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞–Ω—É –ø—ñ—Å–ª—è –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –∑ PWA
window.addEventListener("pageshow", (e) => {
  if (e.persisted) {
    const player = document.getElementById("seriesPlayer");
    if (!player) return;

    // üÜî –†–æ–±–∏–º–æ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π –∫–ª—é—á –¥–ª—è —Å–µ—Ä—ñ–∞–ª—ñ–≤ —Ç–∞ –º—É–ª—å—Ç—Å–µ—Ä—ñ–∞–ª—ñ–≤
    const isMult = location.pathname.includes("multseries");
    const title = (document.getElementById("seriesTitle")?.textContent || "").trim();
    const filmId = (isMult ? "mult_" : "series_") + title;

    const wasPlaying = localStorage.getItem(`playstate_${filmId}`) === "playing";
    if (wasPlaying) {
      player.play().catch(()=>{});
    }
  }
});
</script>
<script src="/pull-refresh.js"></script>
</body>
</html>
