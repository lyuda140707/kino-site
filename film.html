<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–§—ñ–ª—å–º ‚Äî Relax Kino</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
    .film-container { display: flex; flex-wrap: wrap; gap: 40px; margin-top: 40px; align-items: flex-start; }
    .film-left { flex: 1; min-width: 300px; max-width: 360px; }
    .film-left img { width: 95%; max-width: 275px; border-radius: 10px; margin: 0 auto; display: block;
      box-shadow: 0 0 20px rgba(0, 255, 255, 0.25); border: 1px solid rgba(0, 255, 255, 0.25); transition: transform 0.3s ease; }
    .film-left img:hover { transform: scale(1.05); }
    .film-meta { display: flex; flex-direction: column; gap: 8px; margin-top: 12px; background: none; box-shadow: none; border: none; }
    .film-meta span { display: block; color: #bbb; margin: 4px 0; font-size: 15px; line-height: 1.4; }
    .film-meta b { color: #00fff2; }
    .film-right { flex: 2; min-width: 400px; }
    .film-title { font-size: 28px; color: #00fff2; text-shadow: 0 0 18px #00fff2a0; margin-bottom: 15px; font-weight: 700; }

    /* –ü–µ—Ä–µ–º–∏–∫–∞—á –¥–∂–µ—Ä–µ–ª–∞ */
    .source-switch { display: flex; gap: 10px; margin: 0 0 10px 2px; }
    .source-switch button {
      padding: 10px 14px; border-radius: 10px; border: 1px solid rgba(0,255,242,0.35);
      background: #0f0f0f; color: #e9fefe; cursor: pointer; font-weight: 600;
      box-shadow: 0 0 18px rgba(0,255,242,0.1);
      transition: transform .12s ease, box-shadow .12s ease, background .12s ease, color .12s ease;
    }
    .source-switch button:hover { transform: translateY(-1px); box-shadow: 0 0 22px rgba(0,255,242,0.18); }
    .source-switch button.active { background: #00fff2; color: #002927; }
    .source-switch button:disabled { opacity: .45; cursor: not-allowed; }

    .player-box { position: relative; background: #000; border-radius: 12px; border: 1px solid rgba(0,255,242,0.3); overflow: hidden; box-shadow: 0 0 30px rgba(0,255,242,0.15); }
    video { width: 100%; height: auto; display: block; border-radius: 12px; aspect-ratio: 16/9; }
    .film-description { margin-top: 25px; background: #1a1a1a; border-radius: 12px; border: 1px solid rgba(0,255,242,0.2);
      box-shadow: 0 0 30px rgba(0,255,242,0.1); padding: 20px 24px; color: #ddd; font-size: 16px; line-height: 1.7; }
    footer { margin-top: 80px; }
  </style>
</head>

<body>
  <!-- === HEADER === -->
  <header>
    <div class="container topbar">
      <nav class="main-nav">
        <img src="logo.png" alt="Relax Logo" class="nav-logo" />
        <a href="index.html">–ì–æ–ª–æ–≤–Ω–∞</a>

        <div class="dropdown">
          <a href="#" class="menu-films">–§—ñ–ª—å–º–∏</a>
          <div class="mega-menu">
            <div class="genres">
              <a href="#">–ë—ñ–æ–≥—Ä–∞—Ñ—ñ—è</a><a href="#">–ë–æ–π–æ–≤–∏–∫</a><a href="#">–í–µ—Å—Ç–µ—Ä–Ω</a>
              <a href="#">–í—ñ–π—Å—å–∫–æ–≤–∏–π</a><a href="#">–î–µ—Ç–µ–∫—Ç–∏–≤</a><a href="#">–î–æ–∫—É–º–µ–Ω—Ç–∞–ª—å–Ω–∏–π</a>
              <a href="#">–î—Ä–∞–º–∞</a><a href="#">–Ü—Å—Ç–æ—Ä—ñ—è</a><a href="#">–ö–æ–º–µ–¥—ñ—è</a>
              <a href="#">–ö—Ä–∏–º—ñ–Ω–∞–ª</a><a href="#">–ú–µ–ª–æ–¥—Ä–∞–º–∞</a><a href="#">–ú—ñ—Å—Ç–∏–∫–∞</a>
              <a href="#">–ú—É–∑–∏–∫–∞</a><a href="#">–ú—é–∑–∏–∫–ª</a><a href="#">–ü—Ä–∏–≥–æ–¥–∏</a>
              <a href="#">–°—ñ–º–µ–π–Ω–∏–π</a><a href="#">–°–ø–æ—Ä—Ç</a><a href="#">–¢—Ä–∏–ª–µ—Ä</a>
              <a href="#">–ñ–∞—Ö–∏</a><a href="#">–§–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞</a><a href="#">–§–µ–Ω—Ç–µ–∑—ñ</a>
              <a href="#">–ö–æ—Ä–æ—Ç–∫–æ–º–µ—Ç—Ä–∞–∂–Ω—ñ</a><a href="#">–°—É–±—Ç–∏—Ç—Ä–∏</a>
            </div>
          </div>
        </div>

        <div class="dropdown">
          <a href="#" class="menu-series">–°–µ—Ä—ñ–∞–ª–∏</a>
          <div class="mega-menu mega-series">
            <div class="genres">
              <a href="#">–ë—ñ–æ–≥—Ä–∞—Ñ—ñ—è</a><a href="#">–ë–æ–π–æ–≤–∏–∫</a><a href="#">–î–µ—Ç–µ–∫—Ç–∏–≤</a>
              <a href="#">–î—Ä–∞–º–∞</a><a href="#">–ö–æ–º–µ–¥—ñ—è</a><a href="#">–ú–µ–ª–æ–¥—Ä–∞–º–∞</a>
              <a href="#">–§–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞</a><a href="#">–ñ–∞—Ö–∏</a><a href="#">–§–µ–Ω—Ç–µ–∑—ñ</a>
            </div>
          </div>
        </div>

        <div class="dropdown">
          <a href="#" class="menu-cartoons">–ú—É–ª—å—Ç—Ñ—ñ–ª—å–º–∏</a>
          <div class="mega-menu mega-cartoons">
            <div class="genres">
              <a href="#">–î–ª—è –¥—ñ—Ç–µ–π</a><a href="#">–ü–æ–≤–Ω–æ–º–µ—Ç—Ä–∞–∂–Ω—ñ</a>
              <a href="#">–ú—É–ª—å—Ç—Å–µ—Ä—ñ–∞–ª–∏</a><a href="#">Disney</a>
              <a href="#">DreamWorks</a><a href="#">Pixar</a>
            </div>
          </div>
        </div>

        <a href="#">–ù–æ–≤–∏–Ω–∫–∏</a>
        <a href="#">–ó–±—ñ—Ä–∫–∏ —Ñ—ñ–ª—å–º—ñ–≤</a>
      </nav>
      <div class="top-right">
        <input type="text" placeholder="–ü–æ—à—É–∫‚Ä¶" class="search" />
        <button class="profile-btn">üëë –ú—ñ–π –∫–∞–±—ñ–Ω–µ—Ç</button>
      </div>
    </div>
  </header>

  <!-- === BANNER === -->
  <div class="container">
    <section class="banner-slider">
      <h2>üî• –¢–æ–ø 10 —Ñ—ñ–ª—å–º—ñ–≤</h2>
      <button class="slider-btn left" onclick="scrollSlider(-1)">‚ùÆ</button>
      <button class="slider-btn right" onclick="scrollSlider(1)">‚ùØ</button>
      <div class="slider-row" id="sliderRow">
        <div class="slide"><img src="https://i.postimg.cc/VLHxgJsg/dragon.jpg"><p>–î—Ä–∞–∫–æ–Ω –†–∞–¥–∂–∞</p></div>
        <div class="slide"><img src="https://i.postimg.cc/V6z1QntN/anemone.jpg"><p>–ê–Ω–µ–º–æ–Ω–∞</p></div>
        <div class="slide"><img src="https://i.postimg.cc/mkzLz6nK/enigma.jpg"><p>–ï–Ω—ñ–≥–º–∞</p></div>
        <div class="slide"><img src="https://i.postimg.cc/VvY5YBgJ/afterburn.jpg"><p>Afterburn</p></div>
        <div class="slide"><img src="https://i.postimg.cc/FFqXK6rL/epsilon.jpg"><p>–ï–ø—Å—ñ–ª–æ–Ω</p></div>
        <div class="slide"><img src="https://i.postimg.cc/L6PQ1RzM/volcano.jpg"><p>–°–º–µ—Ä—á—ñ 2024</p></div>
        <div class="slide"><img src="https://i.postimg.cc/qM0MYKnD/patriot.jpg"><p>–ü–∞—Ç—Ä—ñ–æ—Ç</p></div>
        <div class="slide"><img src="https://i.postimg.cc/d3zvTX6X/hero.jpg"><p>–Ü–¥–µ–∞–ª—å–Ω–∏–π –∑–ª–æ—á–∏–Ω</p></div>
        <div class="slide"><img src="https://i.postimg.cc/LX3n8M46/chains.jpg"><p>–£–≤—ñ–º–∫–Ω–∏ –º–µ–Ω–µ</p></div>
        <div class="slide"><img src="https://i.postimg.cc/Y0Lt8Tmn/freeze.jpg"><p>–¢–æ—á–∫–∞ –∑–∞–º–µ—Ä–∑–∞–Ω–Ω—è</p></div>
      </div>
    </section>
  </div>

  <!-- === MAIN === -->
  <main>
    <div class="container film-container">
      <div class="film-left">
        <img id="filmPoster" src="" alt="–ü–æ—Å—Ç–µ—Ä">
        <div class="film-meta">
          <span><b>–†—ñ–∫:</b> <span id="filmYear"></span></span>
          <span><b>–ñ–∞–Ω—Ä:</b> <span id="filmGenre"></span></span>
          <span><b>–ö—Ä–∞—ó–Ω–∞:</b> <span id="filmCountry"></span></span>
          <span><b>–†–µ–∂–∏—Å–µ—Ä:</b> <span id="filmDirector"></span></span>
          <span><b>–í —Ä–æ–ª—è—Ö:</b> <span id="filmCast"></span></span>
          <span><b>–ó–≤—É–∫:</b> <span id="filmSound"></span></span>
          <span><b>–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å:</b> <span id="filmDuration"></span></span>
          <span><b>–í—ñ–∫:</b> <span id="filmAge"></span></span>
          <span><b>IMDb:</b> <span id="filmImdb"></span></span>
        </div>
      </div>

      <div class="film-right">
        <div class="film-title" id="filmTitle">–ù–∞–∑–≤–∞ —Ñ—ñ–ª—å–º—É</div>

        <!-- –ü–µ—Ä–µ–º–∏–∫–∞—á –§—ñ–ª—å–º / –¢—Ä–µ–π–ª–µ—Ä -->
        <div class="source-switch">
          <button id="btnMovie" class="active">üé¨ –§—ñ–ª—å–º</button>
          <button id="btnTrailer">üéûÔ∏è –¢—Ä–µ–π–ª–µ—Ä</button>
        </div>

        <div class="player-box">
          <!-- autoplay –≤–∏–¥–∞–ª–µ–Ω–æ (–Ω–µ–º–∞ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫—É) -->
          <video id="filmPlayer" controls playsinline muted crossorigin="anonymous"></video>
        </div>

        <div class="film-description">
          <h3>–ü—Ä–æ —â–æ —Ñ—ñ–ª—å–º:</h3>
          <p id="filmDesc">–û–ø–∏—Å —Ñ—ñ–ª—å–º—É...</p>
        </div>
      </div>
    </div>
  </main>

  <footer>¬© 2025 KinoSite ‚Ä¢ –£—Å—ñ –ø—Ä–∞–≤–∞ –∑–∞—Ö–∏—â–µ–Ω—ñ</footer>

  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const supabaseUrl = "https://zerlqvbmqszomlondlte.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InplcmxxdmJtcXN6b21sb25kbHRlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUzMzg3NzQsImV4cCI6MjA3MDkxNDc3NH0.8wUBYIeQRC6KVp6vdzv0oqofIf4PeZyzbV5GcD0vxTE";
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

    let hls = null;                   // –ø–æ—Ç–æ—á–Ω–∏–π Hls-—ñ–Ω—Å—Ç–∞–Ω—Å (—â–æ–± –∫–æ—Ä–µ–∫—Ç–Ω–æ —Ä—É–π–Ω—É–≤–∞—Ç–∏)
    let currentSource = "movie";      // 'movie' –∞–±–æ 'trailer'
    let movieUrl = "";                // –≥–æ–ª–æ–≤–Ω–∏–π –ø–æ—Ç—ñ–∫
    let trailerUrl = "";              // —Ç—Ä–µ–π–ª–µ—Ä

    // –£—Ç–∏–ª—ñ—Ç–∞: –∑–Ω–∏—â–µ–Ω–Ω—è Hls –ø—Ä–∏ –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—ñ
    function destroyHls() {
      if (hls) {
        try { hls.destroy(); } catch(e) {}
        hls = null;
      }
    }
// YouTube helpers
function isYouTube(url) {
  return /youtube\.com|youtu\.be|googlevideo\.com/.test(url || "");
}

// –°–ø—Ä–æ–±—É–≤–∞—Ç–∏ –≤–∏—Ç—è–≥–Ω—É—Ç–∏ YouTube ID –∑ —Ä—ñ–∑–Ω–∏—Ö —Ñ–æ—Ä–º–∞—Ç—ñ–≤ (watch?v=, youtu.be/, embed/)
function getYouTubeId(url) {
  if (!url) return "";
  // –∫–ª–∞—Å–∏—á–Ω—ñ —Ñ–æ—Ä–º–∞—Ç–∏
  const m1 = url.match(/(?:v=|\/)([0-9A-Za-z_-]{11})(?:[?&]|$)/);
  if (m1) return m1[1];
  // —è–∫—â–æ –∫–∏–Ω—É–ª–∏ —á–∏—Å—Ç–∏–π ID - 11 —Å–∏–º–≤–æ–ª—ñ–≤
  const m2 = url.match(/^[0-9A-Za-z_-]{11}$/);
  if (m2) return m2[0];
  return ""; // –¥–ª—è googlevideo –∫—Ä–∞—â–µ –≤–Ω–æ—Å–∏—Ç–∏ –Ω–æ—Ä–º–∞–ª—å–Ω–∏–π YouTube-URL —É —Ç–∞–±–ª–∏—Ü—é
}

    // –£–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–∂–µ—Ä–µ–ª–∞ –¥–æ <video>
    function setupPlayer(url) {
      const player = document.getElementById("filmPlayer");
      destroyHls();                   // –≤–∏–º–∏–∫–∞—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —ñ–Ω—Å—Ç–∞–Ω—Å

      // –û–±–Ω—É–ª—è—î–º–æ src —ñ –ø–∞—É–∑–∏–º–æ
      try { player.pause(); } catch(e) {}
      player.removeAttribute("src");
      player.load();

      if (!url) {
        console.warn("–ü–æ—Ä–æ–∂–Ω—ñ–π URL –¥–ª—è –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è");
        return;
      }

      if (url.endsWith(".m3u8")) {
        if (window.Hls && Hls.isSupported()) {
          hls = new Hls({
            maxBufferLength: 30,
            enableWorker: true,
            lowLatencyMode: true,
            xhrSetup: function (xhr, url) {
              xhr.withCredentials = false;
              xhr.setRequestHeader("Origin", "https://relax-time2.onrender.com");
              xhr.setRequestHeader("Referer", "https://relax-time2.onrender.com");
            }
          });
          hls.loadSource(url);
          hls.attachMedia(player);
        } else if (player.canPlayType("application/vnd.apple.mpegurl")) {
          player.src = url; // Safari / iOS
        } else {
          console.error("–¶–µ–π –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î HLS –±–µ–∑ hls.js");
        }
      } else {
        // MP4 —Ç–∞ —ñ–Ω—à—ñ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏
        player.src = url;
      }

      // –ê–≤—Ç–æ–≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤–∏–º–∫–Ω–µ–Ω–æ ‚Äî –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —Å–∞–º –Ω–∞—Ç–∏—Å–Ω–µ Play
    }

    async function loadFilm() {
      const params = new URLSearchParams(window.location.search);
      const id = params.get("id");
      if (!id) return;

      const { data, error } = await supabase
        .from("films_site")
        .select("*")
        .eq("id", id)
        .single();

      if (error || !data) {
        console.error("‚ùå –ü–æ–º–∏–ª–∫–∞ Supabase:", error?.message);
        document.getElementById("filmTitle").textContent = "–§—ñ–ª—å–º –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ";
        return;
      }

      // üü¢ –ó–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö
      document.getElementById("filmPoster").src = data.poster || "";
      document.getElementById("filmTitle").textContent = data.title || "";
      document.getElementById("filmDesc").textContent = data.description || "–û–ø–∏—Å –≤—ñ–¥—Å—É—Ç–Ω—ñ–π";
      document.getElementById("filmYear").textContent = data.year || "";
      document.getElementById("filmGenre").textContent = data.genre || "";
      document.getElementById("filmCountry").textContent = data.country || "";
      document.getElementById("filmDirector").textContent = data.director || "";
      document.getElementById("filmCast").textContent = data.cast || "";
      document.getElementById("filmSound").textContent = data.sound || "";
      document.getElementById("filmDuration").textContent = data.duration || "";
      document.getElementById("filmAge").textContent = data.age || "";
      document.getElementById("filmImdb").textContent = data.imdb || "‚Äî";

      // –î–∂–µ—Ä–µ–ª–∞
      movieUrl   = data.stream_url   || "";
      trailerUrl = data.trailer_url  || "";

      // –°—Ç–∞–Ω –∫–Ω–æ–ø–æ–∫
      const btnMovie   = document.getElementById("btnMovie");
      const btnTrailer = document.getElementById("btnTrailer");

      btnMovie.classList.add("active");
      btnTrailer.classList.remove("active");

      // –Ø–∫—â–æ —Ç—Ä–µ–π–ª–µ—Ä–∞ –Ω–µ–º–∞—î ‚Äî –≤–∏–º–∏–∫–∞—î–º–æ –∫–Ω–æ–ø–∫—É
      btnTrailer.disabled = !trailerUrl;

      // –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ –ø–æ—á–∞—Ç–∫–æ–≤–µ –¥–∂–µ—Ä–µ–ª–æ (—Ñ—ñ–ª—å–º)
      currentSource = "movie";
      setupPlayer(movieUrl);

      // –û–±—Ä–æ–±–Ω–∏–∫–∏ –∫–ª—ñ–∫—ñ–≤
      btnMovie.addEventListener("click", () => {
  if (currentSource === "movie") return;
  currentSource = "movie";
  btnMovie.classList.add("active");
  btnTrailer.classList.remove("active");

  // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –∑–≤–∏—á–∞–π–Ω–∏–π –≤—ñ–¥–µ–æ-–ø–ª–µ—î—Ä
  const box = document.querySelector(".player-box");
  box.innerHTML = `<video id="filmPlayer" controls playsinline muted crossorigin="anonymous"></video>`;
  setupPlayer(movieUrl); // –±–µ–∑ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫—É
});

btnTrailer.addEventListener("click", () => {
  if (!trailerUrl) return;
  if (currentSource === "trailer") return;
  currentSource = "trailer";
  btnTrailer.classList.add("active");
  btnMovie.classList.remove("active");

  const box = document.querySelector(".player-box");

  if (isYouTube(trailerUrl)) {
    // YouTube ‚Üí –ø–æ–∫–∞–∑—É—î–º–æ iframe
    const ytId = getYouTubeId(trailerUrl);
    // —è–∫—â–æ ID –Ω–µ –¥—ñ—Å—Ç–∞–ª–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –¥–∞–ª–∏ manifest.googlevideo) ‚Äî –≤—Å–µ –æ–¥–Ω–æ –ø–æ–∫–∞–∂–µ–º–æ iframe –±–µ–∑ ID
    const src = ytId ? `https://www.youtube.com/embed/${ytId}` : trailerUrl;

    box.innerHTML = `
      <iframe
        width="100%" height="480"
        src="${src}"
        frameborder="0"
        allow="autoplay; encrypted-media"
        allowfullscreen
        style="border-radius:12px;width:100%;aspect-ratio:16/9;">
      </iframe>`;
  } else {
    // –ù–µ YouTube ‚Üí —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π –≤—ñ–¥–µ–æ-–ø–ª–µ—î—Ä
    box.innerHTML = `<video id="filmPlayer" controls playsinline muted crossorigin="anonymous"></video>`;
    setupPlayer(trailerUrl); // –±–µ–∑ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫—É
  }
});
});

    function scrollSlider(direction) {
      const slider = document.getElementById("sliderRow");
      const scrollAmount = 300;
      slider.scrollBy({ left: scrollAmount * direction, behavior: "smooth" });
    }

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏
    loadFilm();
  </script>
</body>
</html>
