<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Relax Kino ‚Äî –ö–∞—Ç–µ–≥–æ—Ä—ñ—è</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://unpkg.com/@supabase/supabase-js"></script>
  <style>
    body { background: #000; color: #fff; font-family: "Poppins", sans-serif; }
    h1 { text-align: center; color: #00fff2; margin-top: 25px; text-shadow: 0 0 10px #00fff2a0; }

    /* üîπ –í–µ—Ä—Ö–Ω—è –ø–∞–Ω–µ–ª—å */
    .top-bar {
      max-width: 1200px;
      margin: 20px auto 10px auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 20px;
    }

    .back-btn {
      background: #0f0f0f;
      border: 1px solid rgba(0,255,255,0.35);
      color: #00fff2;
      padding: 8px 16px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: 0.2s;
    }
    .back-btn:hover {
      background: #00fff2;
      color: #000;
    }

    .sort-select {
      background: #0f0f0f;
      color: #fff;
      border: 1px solid rgba(0,255,255,0.3);
      border-radius: 8px;
      padding: 6px 10px;
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
    }

    .film-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
      padding: 30px;
      max-width: 1200px;
      margin: 0 auto;
    }
    .film-card {
      background: #111;
      border-radius: 10px;
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.25s ease, box-shadow 0.25s ease;
      border: 1px solid rgba(0,255,255,0.15);
    }
    .film-card:hover {
      transform: scale(1.05);
      box-shadow: 0 0 20px rgba(0,255,255,0.2);
    }
    .film-card img {
      width: 100%;
      height: 280px;
      object-fit: cover;
    }
    .film-card h3 {
      margin: 10px;
      font-size: 16px;
      color: #fff;
      text-align: center;
    }
    footer { text-align:center; padding:20px; color:#777; }
  </style>
</head>

<body>
  <!-- –•–µ–¥–µ—Ä -->
  <div id="header-placeholder"></div>
  <script>
    fetch("header.html")
      .then(res => res.text())
      .then(html => { document.getElementById("header-placeholder").innerHTML = html; })
      .catch(err => console.error("–ü–æ–º–∏–ª–∫–∞ —Ö–µ–¥–µ—Ä–∞:", err));
  </script>

  <h1 id="pageTitle">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</h1>

  <!-- üîπ –í–µ—Ä—Ö–Ω—è –ø–∞–Ω–µ–ª—å –∑ –∫–Ω–æ–ø–∫–æ—é –ù–∞–∑–∞–¥ —ñ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è–º -->
  <div class="top-bar">
    <button class="back-btn" onclick="window.location.href='index.html'">‚¨Ö –ù–∞–∑–∞–¥ –Ω–∞ –≥–æ–ª–æ–≤–Ω—É</button>
    <select id="sortSelect" class="sort-select">
      <option value="id_desc">üîπ –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è: –ù–æ–≤—ñ —Å–ø–æ—á–∞—Ç–∫—É</option>
      <option value="year_desc">–ó–∞ —Ä–æ–∫–æ–º (–Ω–æ–≤—ñ—à—ñ)</option>
      <option value="year_asc">–ó–∞ —Ä–æ–∫–æ–º (—Å—Ç–∞—Ä—ñ—à—ñ)</option>
      <option value="imdb_desc">–ó–∞ —Ä–µ–π—Ç–∏–Ω–≥–æ–º IMDb</option>
      <option value="title_asc">–ó–∞ –Ω–∞–∑–≤–æ—é (A‚Äì–Ø)</option>
    </select>
  </div>

  <div class="film-grid" id="filmGrid"></div>

  <footer>¬© 2025 Relax Kino</footer>

<script>
  const supabaseUrl = "https://zerlqvbmqszomlondlte.supabase.co";
  const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InplcmxxdmJtcXN6b21sb25kbHRlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUzMzg3NzQsImV4cCI6MjA3MDkxNDc3NH0.8wUBYIeQRC6KVp6vdzv0oqofIf4PeZyzbV5GcD0vxTE";
  const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

  const params = new URLSearchParams(window.location.search);
  const type = (params.get("type") || "–§—ñ–ª—å–º").trim();
  const genre = (params.get("genre") || "").trim();

  document.getElementById("pageTitle").textContent = `${type} ‚Ä¢ ${genre || "–£—Å—ñ"}`;

  async function loadFilms(sortMode = "id_desc") {
    let query = supabase.from("films_site").select("*");

    if (type) query = query.ilike("type", `%${type}%`);
    if (genre) query = query.ilike("genre", `%${genre}%`);

    // üîπ –ø–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è
    switch (sortMode) {
      case "year_desc": query = query.order("year", { ascending: false }); break;
      case "year_asc": query = query.order("year", { ascending: true }); break;
      case "imdb_desc": query = query.order("imdb", { ascending: false }); break;
      case "title_asc": query = query.order("title", { ascending: true }); break;
      default: query = query.order("id", { ascending: false }); break;
    }

    const { data, error } = await query;
    const grid = document.getElementById("filmGrid");
    grid.innerHTML = "";

    if (error) {
      grid.innerHTML = `<p style="color:#ff6b6b;">–ü–æ–º–∏–ª–∫–∞: ${error.message}</p>`;
      return;
    }

    if (!data || data.length === 0) {
      grid.innerHTML = `<p style="color:#ccc;text-align:center;">–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –¥–ª—è –∂–∞–Ω—Ä—É "${genre}"</p>`;
      return;
    }

    data.forEach(film => {
      const card = document.createElement("div");
      card.className = "film-card";
      card.innerHTML = `
        <img src="${film.poster || 'https://via.placeholder.com/200x280?text=No+Image'}" alt="${film.title}">
        <h3>${film.title}</h3>
      `;
      card.addEventListener("click", () => {
        window.location.href = \`/film.html?id=\${film.id}\`;
      });
      grid.appendChild(card);
    });
  }

  // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
  loadFilms();

  // –ó–º—ñ–Ω–∞ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è
  document.getElementById("sortSelect").addEventListener("change", (e) => {
    loadFilms(e.target.value);
  });
</script>
</body>
</html>
