<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Relax Kino ‚Äî –ö–∞—Ç–µ–≥–æ—Ä—ñ—è</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://unpkg.com/@supabase/supabase-js"></script>
  <style>
    body { background: #000; color: #fff; font-family: "Poppins", sans-serif; }
    h1 { text-align: center; color: #00fff2; margin-top: 25px; text-shadow: 0 0 10px #00fff2a0; }
    .film-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
      padding: 30px;
      max-width: 1200px;
      margin: 0 auto;
    }
    .film-card {
      background: #111;
      border-radius: 10px;
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.25s ease, box-shadow 0.25s ease;
      border: 1px solid rgba(0,255,255,0.15);
    }
    .film-card:hover {
      transform: scale(1.05);
      box-shadow: 0 0 20px rgba(0,255,255,0.2);
    }
    .film-card img {
      width: 100%;
      height: 280px;
      object-fit: cover;
    }
    .film-card h3 {
      margin: 10px;
      font-size: 16px;
      color: #fff;
      text-align: center;
    }
    /* === –§–Ü–õ–¨–¢–†–ò –ù–ê–î –ö–ê–†–¢–ö–ê–ú–ò === */
.filter-bar{
  max-width:1200px; margin:10px auto 0; padding:0 30px;
  display:flex; gap:10px; align-items:center; flex-wrap:wrap;
}
.filter-btn{
  background:#0f0f0f; color:#00fff2; border:1px solid rgba(0,255,255,.35);
  padding:8px 14px; border-radius:10px; font-weight:600; cursor:pointer;
  transition:.2s; user-select:none
}
.filter-btn:hover{ background:#00fff2; color:#000 }
.filter-btn.active{ background:#00fff2; color:#000; box-shadow:0 0 10px rgba(0,255,255,.35) }

    footer { text-align:center; padding:20px; color:#777; }
  </style>
</head>

<body>
  <!-- –•–µ–¥–µ—Ä -->
  <div id="header-placeholder"></div>
  <script>
    fetch("header.html")
      .then(res => res.text())
      .then(html => { document.getElementById("header-placeholder").innerHTML = html; })
      .catch(err => console.error("–ü–æ–º–∏–ª–∫–∞ —Ö–µ–¥–µ—Ä–∞:", err));
  </script>

  <h1 id="pageTitle">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</h1>
  <!-- === –ü–ê–ù–ï–õ–¨ –§–Ü–õ–¨–¢–†–Ü–í === -->
  <div class="filter-bar">
    <button id="btn-latest" class="filter-btn active">üÜï –û—Å—Ç–∞–Ω–Ω—ñ</button>
    <button id="btn-best"   class="filter-btn">‚≠ê –ù–∞–π–∫—Ä–∞—â—ñ (IMDb)</button>
    <button id="btn-year"   class="filter-btn">üìÖ –ó–∞ —Ä–æ–∫–æ–º</button>
  </div>
  <div class="film-grid" id="filmGrid"></div>

  <footer>¬© 2025 Relax Kino</footer>

<script>
  // ‚úÖ —è–∫—â–æ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –≤—ñ–¥–∫—Ä–∏–ª–∞—Å—å —è–∫ /category (–±–µ–∑ .html) ‚Äî –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î–º–æ

  const supabaseUrl = "https://zerlqvbmqszomlondlte.supabase.co";
  const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InplcmxxdmJtcXN6b21sb25kbHRlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUzMzg3NzQsImV4cCI6MjA3MDkxNDc3NH0.8wUBYIeQRC6KVp6vdzv0oqofIf4PeZyzbV5GcD0vxTE";
  const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
  console.log("‚úÖ Supabase –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ");

  const params = new URLSearchParams(window.location.search);
  const type = (params.get("type") || "–§—ñ–ª—å–º").trim();
  const genre = (params.get("genre") || "").trim();

  document.getElementById("pageTitle").textContent = `${type} ‚Ä¢ ${genre || "–£—Å—ñ"}`;

  let currentSort = 'latest'; // latest | best | year

async function loadFilms(sortMode = currentSort) {
  currentSort = sortMode;

  // –±–∞–∑–æ–≤–∏–π –≤–∏–±—ñ—Ä –∑ Supabase
  let query = supabase.from("films_site").select("*");
  if (type)  query = query.ilike("type",  `%${type}%`);
  if (genre) query = query.ilike("genre", `%${genre}%`);

  // –±–µ—Ä–µ–º–æ ¬´–æ—Å—Ç–∞–Ω–Ω—ñ¬ª —è–∫ –¥–µ—Ñ–æ–ª—Ç ‚Äî id ‚Üì (—è–∫ —É —Ç–µ–±–µ –±—É–ª–æ)
  const { data, error } = await query.order("id", { ascending: false });

  const grid = document.getElementById("filmGrid");
  grid.innerHTML = "";

  if (error) {
    grid.innerHTML = `<p style="color:#ff6b6b;">–ü–æ–º–∏–ª–∫–∞: ${error.message}</p>`;
    return;
  }
  if (!data || data.length === 0) {
    grid.innerHTML = `<p style="color:#ccc;text-align:center;">–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –¥–ª—è –∂–∞–Ω—Ä—É "${genre}"</p>`;
    return;
  }

  // –ª–æ–∫–∞–ª—å–Ω–µ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è –¥–ª—è ¬´–ù–∞–π–∫—Ä–∞—â—ñ¬ª —Ç–∞ ¬´–ó–∞ —Ä–æ–∫–æ–º¬ª,
  // –±–æ imdb/year –º–æ–∂—É—Ç—å –±—É—Ç–∏ —Ç–µ–∫—Å—Ç–æ–º —É —Ç–∞–±–ª–∏—Ü—ñ
  let items = [...data];
  if (sortMode === 'best') {
    items.sort((a,b) => (parseFloat(b.imdb||0) || 0) - (parseFloat(a.imdb||0) || 0));
  } else if (sortMode === 'year') {
    items.sort((a,b) => (parseInt(b.year||0) || 0) - (parseInt(a.year||0) || 0));
  }
  // 'latest' –≤–∂–µ –≤—ñ–¥—Å–æ—Ä—Ç–æ–≤–∞–Ω–æ –∑ –±–∞–∑–∏ –ø–æ id ‚Üì

  // –≤—ñ–¥–º–∞–ª—é–≤–∞—Ç–∏ –∫–∞—Ä—Ç–∫–∏
  for (const film of items) {
    const card = document.createElement("div");
    card.className = "film-card";
    card.innerHTML = `
      <img src="${film.poster || 'https://via.placeholder.com/200x280?text=No+Image'}" alt="${film.title}">
      <h3>${film.title}</h3>
    `;
    card.addEventListener("click", () => {
      window.location.href = `/film.html?id=${film.id}`;
    });
    grid.appendChild(card);
  }
}

// –∫–Ω–æ–ø–∫–∏ —Ñ—ñ–ª—å—Ç—Ä—ñ–≤
const btnLatest = document.getElementById('btn-latest');
const btnBest   = document.getElementById('btn-best');
const btnYear   = document.getElementById('btn-year');

function setActive(btn){
  [btnLatest, btnBest, btnYear].forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
}

btnLatest.addEventListener('click', () => { setActive(btnLatest); loadFilms('latest'); });
btnBest  .addEventListener('click', () => { setActive(btnBest);   loadFilms('best');   });
btnYear  .addEventListener('click', () => { setActive(btnYear);   loadFilms('year');   });

// –ø–µ—Ä—à–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
loadFilms('latest');

</script>

</body>
</html>
