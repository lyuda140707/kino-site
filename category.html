<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Relax Kino ‚Äî –ö–∞—Ç–µ–≥–æ—Ä—ñ—è</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { background: #000; color: #fff; font-family: "Poppins", sans-serif; }
    h1 {
      font-size: 2rem;
      font-weight: 800;
      letter-spacing: 1px;
      margin-top: 25px;
      text-align: left;
      margin-left: 180px;
      display: inline-block;
      position: relative;
      
      /* —Å—Ä—ñ–±–ª—è—Å—Ç–∏–π –≥—Ä–∞–¥—ñ—î–Ω—Ç–Ω–∏–π —Ç–µ–∫—Å—Ç */
      background: linear-gradient(90deg, #d9d9d9, #9c9c9c, #e6e6e6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    
      text-shadow: 0 2px 4px rgba(0,0,0,0.6);
      padding-bottom: 6px;
    }
    
    h1::after {
      content: "";
      position: absolute;
      left: 0;
      bottom: 0;
      width: 70%;
      height: 2px;
      background: linear-gradient(90deg, transparent, #00fff2, transparent);
      box-shadow: 0 0 6px #00fff2;
      border-radius: 2px;
    }



    .film-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
      padding: 30px;
      max-width: 1200px;
      margin: 0 auto;
    }
    .film-card {
      background: #111;
      border-radius: 10px;
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.25s ease, box-shadow 0.25s ease;
      border: 1px solid rgba(0,255,255,0.15);
    }
    .film-card:hover {
      transform: scale(1.05);
      box-shadow: 0 0 20px rgba(0,255,255,0.2);
    }
    .film-card img {
      width: 100%;
      height: 280px;
      object-fit: cover;
    }
    .film-card h3 {
      margin: 10px;
      font-size: 16px;
      color: #fff;
      text-align: center;
    }
    /* === –§–Ü–õ–¨–¢–†–ò –ù–ê–î –ö–ê–†–¢–ö–ê–ú–ò === */
.filter-bar{
  max-width:1200px; margin:10px auto 0; padding:0 30px;
  display:flex; gap:10px; align-items:center; flex-wrap:wrap;
}
.year-select {
  background:#0f0f0f;
  color:#00fff2;
  border:1px solid rgba(0,255,255,.35);
  border-radius:10px;
  padding:8px 14px;
  font-weight:600;
  cursor:pointer;
  transition:.2s;
}
.year-select:hover {
  background:#00fff2;
  color:#000;
}

.filter-btn{
  background:#0f0f0f; color:#00fff2; border:1px solid rgba(0,255,255,.35);
  padding:8px 14px; border-radius:10px; font-weight:600; cursor:pointer;
  transition:.2s; user-select:none
}
.filter-btn:hover{ background:#00fff2; color:#000 }
.filter-btn.active{ background:#00fff2; color:#000; box-shadow:0 0 10px rgba(0,255,255,.35) }

    footer { text-align:center; padding:20px; color:#777; }
  </style>
</head>

<body>
  <!-- –•–µ–¥–µ—Ä -->
  <div id="header-placeholder"></div>
  <script>
  // üü¢ –§—É–Ω–∫—Ü—ñ—è, —è–∫–∞ –∞–∫—Ç–∏–≤—É—î –ø–æ—à—É–∫ –ø—ñ—Å–ª—è –≤—Å—Ç–∞–≤–∫–∏ —Ö–µ–¥–µ—Ä–∞
  function bindHeaderSearch() {
    const input = document.getElementById("search-input");
    if (!input) return;

    input.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        const query = input.value.trim();
        if (query.length > 1) {
          localStorage.setItem("searchQuery", query);
          window.location.href = "/search.html";
        }
      }
    });
  }

  // üü¢ –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Ö–µ–¥–µ—Ä —ñ –æ–¥—Ä–∞–∑—É –∞–∫—Ç–∏–≤—É—î–º–æ –ø–æ—à—É–∫
  fetch("header.html")
    .then(res => res.text())
    .then(html => {
      document.getElementById("header-placeholder").innerHTML = html;
      bindHeaderSearch(); // –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ –ø–æ—à—É–∫ –ø—ñ—Å–ª—è –≤—Å—Ç–∞–≤–∫–∏
    })
    .catch(err => console.error("–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ö–µ–¥–µ—Ä–∞:", err));
</script>


  <h1 id="pageTitle">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</h1>
  <!-- === –ü–ê–ù–ï–õ–¨ –§–Ü–õ–¨–¢–†–Ü–í === -->
 <!-- === –ü–ê–ù–ï–õ–¨ –§–Ü–õ–¨–¢–†–Ü–í === -->
<div class="filter-bar">
  <button id="btn-latest" class="filter-btn active">üÜï –û—Å—Ç–∞–Ω–Ω—ñ</button>
  <button id="btn-best"   class="filter-btn">‚≠ê –ù–∞–π–∫—Ä–∞—â—ñ (IMDb)</button>

  <div style="display:flex;align-items:center;gap:10px;">
    <button id="btn-year" class="filter-btn">üìÖ –ó–∞ —Ä–æ–∫–æ–º</button>
    <select id="yearSelect" class="year-select">
      <option value="">–£—Å—ñ —Ä–æ–∫–∏</option>
    </select>
  </div>
</div>

  <div class="film-grid" id="filmGrid"></div>

  <footer>¬© 2025 Relax Kino</footer>

<script>
  // ‚úÖ —è–∫—â–æ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –≤—ñ–¥–∫—Ä–∏–ª–∞—Å—å —è–∫ /category (–±–µ–∑ .html) ‚Äî –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î–º–æ

  const supabaseUrl = "https://zerlqvbmqszomlondlte.supabase.co";
  const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InplcmxxdmJtcXN6b21sb25kbHRlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUzMzg3NzQsImV4cCI6MjA3MDkxNDc3NH0.8wUBYIeQRC6KVp6vdzv0oqofIf4PeZyzbV5GcD0vxTE";
  const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
  console.log("‚úÖ Supabase –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ");

  const params = new URLSearchParams(window.location.search);
  const type = (params.get("type") || "–§—ñ–ª—å–º").trim();
  const genre = (params.get("genre") || "").trim();

  document.getElementById("pageTitle").textContent = `${type} ‚Ä¢ ${genre || "–£—Å—ñ"}`;

let currentSort = 'latest'; // latest | best | year
let selectedYear = '';      // –∑–Ω–∞—á–µ–Ω–Ω—è –∑ –≤–∏–ø–∞–¥–∞—é—á–æ–≥–æ —Å–ø–∏—Å–∫—É

async function loadFilms(sortMode = currentSort) {
  currentSort = sortMode;

  let query = supabase.from("films_site").select("*");
  if (type)  query = query.ilike("type",  `%${type}%`);
  if (genre) query = query.ilike("genre", `%${genre}%`);

  const { data, error } = await query.order("id", { ascending: false });

  const grid = document.getElementById("filmGrid");
  grid.innerHTML = "";

  if (error) {
    grid.innerHTML = `<p style="color:#ff6b6b;">–ü–æ–º–∏–ª–∫–∞: ${error.message}</p>`;
    return;
  }
  if (!data || data.length === 0) {
    grid.innerHTML = `<p style="color:#ccc;text-align:center;">–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –¥–ª—è –∂–∞–Ω—Ä—É "${genre}"</p>`;
    return;
  }

  // ‚úÖ —è–∫—â–æ —Ü–µ —Å–µ—Ä—ñ–∞–ª–∏ ‚Äî –≥—Ä—É–ø—É—î–º–æ –∑–∞ –Ω–∞–∑–≤–æ—é
  let items = [...data];
  if (type.toLowerCase().includes("—Å–µ—Ä—ñ–∞–ª") || type.toLowerCase().includes("–º—É–ª—å—Ç—Å–µ—Ä—ñ–∞–ª")) {
    const map = new Map();
    items.forEach(row => {
      if (!map.has(row.title)) map.set(row.title, row);
    });
    items = [...map.values()];
  }


  // —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –∑–∞ —Ä–æ–∫–æ–º
  if (selectedYear) {
    items = items.filter(f => String(f.year).trim() === selectedYear);
  }

  // —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è
  if (sortMode === 'best') {
    items.sort((a,b) => (parseFloat(b.imdb||0)||0) - (parseFloat(a.imdb||0)||0));
  } else if (sortMode === 'year') {
    items.sort((a,b) => (parseInt(b.year||0)||0) - (parseInt(a.year||0)||0));
  } // latest —É–∂–µ –≤—ñ–¥—Å–æ—Ä—Ç–æ–≤–∞–Ω–æ

  // –≤—ñ–¥–º–∞–ª—å–æ–≤—É—î–º–æ –∫–∞—Ä—Ç–∫–∏
  for (const film of items) {
    const card = document.createElement("div");
    card.className = "film-card";
    card.innerHTML = `
      <img src="${film.poster || 'https://via.placeholder.com/200x280?text=No+Image'}" alt="${film.title}">
      <h3>${film.title}</h3>
    `;

  // üîπ –ª–æ–≥—ñ–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥—É
if (film.type === "–°–µ—Ä—ñ–∞–ª") {
  card.addEventListener("click", () => {
    window.location.href = `/series.html?title=${encodeURIComponent(film.title)}`;
  });
} else if (film.type === "–ú—É–ª—å—Ç—Å–µ—Ä—ñ–∞–ª") {
  card.addEventListener("click", () => {
    window.location.href = `/multseries.html?title=${encodeURIComponent(film.title)}`;
  });
} else {
  card.addEventListener("click", () => {
    window.location.href = `/film.html?id=${film.id}`;
  });
}


    grid.appendChild(card);
  }
}


// === –∫–Ω–æ–ø–∫–∏ —Ñ—ñ–ª—å—Ç—Ä—ñ–≤ ===
const btnLatest = document.getElementById('btn-latest');
const btnBest   = document.getElementById('btn-best');
const btnYear   = document.getElementById('btn-year');
const yearSelect = document.getElementById('yearSelect');

function setActive(btn){
  [btnLatest, btnBest, btnYear].forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
}

// –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É —Ä–æ–∫—ñ–≤ –∑ —Ç–∞–±–ª–∏—Ü—ñ
async function fillYearOptions() {
  const { data, error } = await supabase
    .from("films_site")
    .select("year")
    .order("year", { ascending: false });

  if (!error && data) {
    const years = [...new Set(
      data
        .map(f => String(f.year).trim())
        .filter(y => y && y !== "undefined" && y !== "null")
    )];

    yearSelect.innerHTML =
      '<option value="">–£—Å—ñ —Ä–æ–∫–∏</option>' +
      years.map(y => `<option value="${y}">${y}</option>`).join('');
  }
}

// üîπ –ì–æ–ª–æ–≤–Ω–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è ‚Äî –æ–±–≥–æ—Ä–Ω—É—Ç–∞ –≤ async
async function initCategoryPage() {
  await fillYearOptions();  // –∑–∞–ø–æ–≤–Ω—é—î–º–æ —Ä–æ–∫–∏ –ø–µ—Ä–µ–¥ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º
  loadFilms('latest');      // –ø–æ–∫–∞–∑—É—î–º–æ —Ñ—ñ–ª—å–º–∏ –æ–¥—Ä–∞–∑—É

  // –ö–Ω–æ–ø–∫–∏ —Ñ—ñ–ª—å—Ç—Ä—ñ–≤
  btnLatest.addEventListener('click', () => {
    setActive(btnLatest);
    currentSort = 'latest';
    loadFilms('latest');
  });

  btnBest.addEventListener('click', () => {
    setActive(btnBest);
    currentSort = 'best';
    loadFilms('best');
  });

  btnYear.addEventListener('click', () => {
    setActive(btnYear);
    currentSort = 'year';
    loadFilms('year');
  });

  // –ó–º—ñ–Ω–∞ —Ä–æ–∫—É –≤ select
  yearSelect.addEventListener('change', (e) => {
    selectedYear = e.target.value;
    loadFilms(currentSort);
  });
}

// üöÄ –ó–∞–ø—É—Å–∫
initCategoryPage();

</script>
<script src="auth.js"></script>
<div id="footer-placeholder"></div>
<script>
fetch("footer.html")
  .then(res => res.text())
  .then(html => {
    document.getElementById("footer-placeholder").innerHTML = html;

    // === –î–æ–¥–∞—î–º–æ –ª–æ–≥—ñ–∫—É –ø—ñ—Å–ª—è –≤—Å—Ç–∞–≤–∫–∏ —Ñ—É—Ç–µ—Ä–∞ ===
    const BACKEND_URL = "https://script.google.com/macros/s/AKfycbxW2_rhnZ2Q8a7BQJJA89Ij_65tKSmf6gr8XmOIE9Au0i_BQVv_6PS0xx5sWgKYQ16J/exec";


    const contactModal = document.getElementById("contactModal");
    const rightsModal = document.getElementById("rightsModal");

    // –í—ñ–¥–∫—Ä–∏—Ç—Ç—è / –∑–∞–∫—Ä–∏—Ç—Ç—è
    document.getElementById("openContact").onclick = () => contactModal.style.display = "flex";
    document.getElementById("openRights").onclick = () => rightsModal.style.display = "flex";
    document.getElementById("closeContact").onclick = () => contactModal.style.display = "none";
    document.getElementById("closeRights").onclick = () => rightsModal.style.display = "none";
    window.onclick = e => {
      if (e.target === contactModal) contactModal.style.display = "none";
      if (e.target === rightsModal) rightsModal.style.display = "none";
    };

    // –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞ —Ñ–æ—Ä–º–∞
    document.getElementById("contactForm")?.addEventListener("submit", async (e) => {
      e.preventDefault();
      const name = document.getElementById("contactName").value.trim();
      const msg = document.getElementById("contactMsg").value.trim();
      const statusEl = document.getElementById("contactStatus");
      statusEl.innerText = "‚è≥ –í—ñ–¥–ø—Ä–∞–≤–ª—è—é...";
      try {
        const res = await fetch(BACKEND_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ source: "contact_form", name, message: msg })
        });
        if (!res.ok) throw new Error();
        statusEl.innerText = "‚úÖ –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ!";
        e.target.reset();
      } catch {
        statusEl.innerText = "‚ùå –ù–µ –≤–¥–∞–ª–æ—Å—è –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏. –°–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.";
      }
    });

    // –ü—Ä–∞–≤–æ–≤–ª–∞—Å–Ω–∏–∫–∏
    document.getElementById("dmcaForm")?.addEventListener("submit", async (e) => {
      e.preventDefault();
      const name = document.getElementById("dmcaName").value.trim();
      const email = document.getElementById("dmcaEmail").value.trim();
      const details = document.getElementById("dmcaDetails").value.trim();
      const statusEl = document.getElementById("dmcaStatus");
      statusEl.innerText = "‚è≥ –í—ñ–¥–ø—Ä–∞–≤–ª—è—é...";
      try {
        const res = await fetch(BACKEND_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ source: "dmca_form", name, email, message: details })
        });
        if (!res.ok) throw new Error();
        statusEl.innerText = "‚úÖ –ó–∞–ø–∏—Ç –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ! –ú–∏ –∑–≤‚Äô—è–∂–µ–º–æ—Å—è –Ω–∞–π–±–ª–∏–∂—á–∏–º —á–∞—Å–æ–º.";
        e.target.reset();
      } catch {
        statusEl.innerText = "‚ùå –ù–µ –≤–¥–∞–ª–æ—Å—è –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏. –°–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.";
      }
    });
  });
</script>


</body>
</html>
