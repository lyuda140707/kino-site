<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- ‚úÖ –Ü–∫–æ–Ω–∫–∏ —Å–∞–π—Ç—É –¥–ª—è –≤—Å—ñ—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤ -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#00fff2">

  <!-- Android favicon / PWA icons -->
  <link rel="icon" type="image/png" sizes="192x192" href="/icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/icon-512.png">

  <!-- iOS –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="/icon-512.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icon-512.png">

  <title>Relax Kino ‚Äî –ö–∞—Ç–µ–≥–æ—Ä—ñ—è</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { background: #000; color: #fff; font-family: "Poppins", sans-serif; }
    h1 {
      font-size: 2rem;
      font-weight: 800;
      letter-spacing: 1px;
      margin-top: 25px;
      text-align: left;
      margin-left: 180px;
      display: inline-block;
      position: relative;
      
      /* —Å—Ä—ñ–±–ª—è—Å—Ç–∏–π –≥—Ä–∞–¥—ñ—î–Ω—Ç–Ω–∏–π —Ç–µ–∫—Å—Ç */
      background: linear-gradient(90deg, #d9d9d9, #9c9c9c, #e6e6e6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    
      text-shadow: 0 2px 4px rgba(0,0,0,0.6);
      padding-bottom: 6px;
    }
    
    h1::after {
      content: "";
      position: absolute;
      left: 0;
      bottom: 0;
      width: 70%;
      height: 2px;
      background: linear-gradient(90deg, transparent, #00fff2, transparent);
      box-shadow: 0 0 6px #00fff2;
      border-radius: 2px;
    }



    .film-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
      padding: 30px;
      max-width: 1200px;
      margin: 0 auto;
    }
    .film-card {
      background: #111;
      border-radius: 10px;
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.25s ease, box-shadow 0.25s ease;
      border: 1px solid rgba(0,255,255,0.15);
    }
    .film-card:hover {
      transform: scale(1.05);
      box-shadow: 0 0 20px rgba(0,255,255,0.2);
    }
    .film-card img {
      width: 100%;
      height: 280px;
      object-fit: cover;
    }
    .film-card h3 {
      margin: 10px;
      font-size: 16px;
      color: #fff;
      text-align: center;
    }

    /* === üîπ –ú–æ–±—ñ–ª—å–Ω–∞ –∞–¥–∞–ø—Ç–∞—Ü—ñ—è –∑ –≤—É–∂—á–∏–º–∏ –∫–∞—Ä—Ç–∫–∞–º–∏ (2 —É —Ä—è–¥) === */
@media (max-width: 768px) {
  .film-grid {
    display: grid;
    grid-template-columns: repeat(2, minmax(140px, 1fr));
    justify-content: center;
    gap: 14px;
    padding: 10px 12px;
  }

  .film-card {
    max-width: 180px;
    margin: 0 auto;
  }

  .film-card img {
    height: 210px;
  }

  .film-card h3 {
    font-size: 13px;
    margin: 8px 5px;
  }
}



    /* === –§–Ü–õ–¨–¢–†–ò –ù–ê–î –ö–ê–†–¢–ö–ê–ú–ò === */
.filter-bar{
  max-width:1200px; margin:10px auto 0; padding:0 30px;
  display:flex; gap:10px; align-items:center; flex-wrap:wrap;
}
.year-select {
  background:#0f0f0f;
  color:#00fff2;
  border:1px solid rgba(0,255,255,.35);
  border-radius:10px;
  padding:8px 14px;
  font-weight:600;
  cursor:pointer;
  transition:.2s;
}
.year-select:hover {
  background:#00fff2;
  color:#000;
}

.filter-btn{
  background:#0f0f0f; color:#00fff2; border:1px solid rgba(0,255,255,.35);
  padding:8px 14px; border-radius:10px; font-weight:600; cursor:pointer;
  transition:.2s; user-select:none
}
.filter-btn:hover{ background:#00fff2; color:#000 }
.filter-btn.active{ background:#00fff2; color:#000; box-shadow:0 0 10px rgba(0,255,255,.35) }

    footer { text-align:center; padding:20px; color:#777; }
  #pagination {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 6px;
  flex-wrap: wrap;
  margin: 25px 0 40px;
}

.page-btn {
  background: linear-gradient(145deg, #0b0b0b, #151515);
  border: 1px solid rgba(0, 255, 255, 0.35);
  color: #00fff2;
  border-radius: 10px;
  padding: 8px 14px;
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
  letter-spacing: 0.5px;
  box-shadow: 0 0 8px rgba(0, 255, 255, 0.25);
  transition: all 0.25s ease;
}

.page-btn:hover {
  background: linear-gradient(145deg, #00fff2, #00b5b0);
  color: #000;
  transform: scale(1.08);
  box-shadow: 0 0 18px rgba(0, 255, 255, 0.6);
}

.page-btn.active {
  background: linear-gradient(145deg, #00fff2, #00b5b0);
  color: #000;
  transform: scale(1.05);
  box-shadow: 0 0 25px rgba(0, 255, 255, 0.8);
}

.page-btn:disabled {
  opacity: 0.4;
  cursor: not-allowed;
  box-shadow: none;
}

  </style>
</head>

<body>
  <div id="header-placeholder"></div>
  <script src="header.js"></script>

  <!-- –•–µ–¥–µ—Ä -->
  <div id="header-placeholder"></div>
  <script>
  // üü¢ –§—É–Ω–∫—Ü—ñ—è, —è–∫–∞ –∞–∫—Ç–∏–≤—É—î –ø–æ—à—É–∫ –ø—ñ—Å–ª—è –≤—Å—Ç–∞–≤–∫–∏ —Ö–µ–¥–µ—Ä–∞
  function bindHeaderSearch() {
    const input = document.getElementById("search-input");
    if (!input) return;

    input.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        const query = input.value.trim();
        if (query.length > 1) {
          localStorage.setItem("searchQuery", query);
          window.location.href = "/search.html";
        }
      }
    });
  }

  // üü¢ –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Ö–µ–¥–µ—Ä —ñ –æ–¥—Ä–∞–∑—É –∞–∫—Ç–∏–≤—É—î–º–æ –ø–æ—à—É–∫
  fetch("header.html")
    .then(res => res.text())
    .then(html => {
      document.getElementById("header-placeholder").innerHTML = html;
      bindHeaderSearch(); // –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ –ø–æ—à—É–∫ –ø—ñ—Å–ª—è –≤—Å—Ç–∞–≤–∫–∏
    })
    .catch(err => console.error("–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ö–µ–¥–µ—Ä–∞:", err));
</script>


  <h1 id="pageTitle">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</h1>
  <!-- === –ü–ê–ù–ï–õ–¨ –§–Ü–õ–¨–¢–†–Ü–í === -->
 <!-- === –ü–ê–ù–ï–õ–¨ –§–Ü–õ–¨–¢–†–Ü–í === -->
<div class="filter-bar">
  <button id="btn-latest" class="filter-btn active">üÜï –û—Å—Ç–∞–Ω–Ω—ñ</button>
  <button id="btn-best"   class="filter-btn">‚≠ê –ù–∞–π–∫—Ä–∞—â—ñ (IMDb)</button>

  <div style="display:flex;align-items:center;gap:10px;">
    <button id="btn-year" class="filter-btn">üìÖ –ó–∞ —Ä–æ–∫–æ–º</button>
    <select id="yearSelect" class="year-select">
      <option value="">–£—Å—ñ —Ä–æ–∫–∏</option>
    </select>
  </div>
</div>

  <div class="film-grid" id="filmGrid"></div>
  <div id="pagination" style="text-align:center; margin:20px 0;"></div>

  <footer>¬© 2025 Relax Kino</footer>

<script>
  // ‚úÖ —è–∫—â–æ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –≤—ñ–¥–∫—Ä–∏–ª–∞—Å—å —è–∫ /category (–±–µ–∑ .html) ‚Äî –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î–º–æ

  const supabaseUrl = "https://zerlqvbmqszomlondlte.supabase.co";
  const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InplcmxxdmJtcXN6b21sb25kbHRlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUzMzg3NzQsImV4cCI6MjA3MDkxNDc3NH0.8wUBYIeQRC6KVp6vdzv0oqofIf4PeZyzbV5GcD0vxTE";
  const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
  console.log("‚úÖ Supabase –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ");

  const params = new URLSearchParams(window.location.search);
  const type = (params.get("type") || "–§—ñ–ª—å–º").trim();
  const genre = (params.get("genre") || "").trim();

  document.getElementById("pageTitle").textContent = `${type} ‚Ä¢ ${genre || "–£—Å—ñ"}`;

let currentSort = 'latest'; // latest | best | year
let selectedYear = '';      // –∑–Ω–∞—á–µ–Ω–Ω—è –∑ –≤–∏–ø–∞–¥–∞—é—á–æ–≥–æ —Å–ø–∏—Å–∫—É
let currentPage = 1;
const filmsPerPage = 30; // 6 —Ä—è–¥–∫—ñ–≤ √ó 5 —Ñ—ñ–ª—å–º—ñ–≤
// üîó –ï–ª–µ–º–µ–Ω—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä—ñ–≤ —É DOM
const btnLatest  = document.getElementById('btn-latest');
const btnBest    = document.getElementById('btn-best');
const btnYear    = document.getElementById('btn-year');
const yearSelect = document.getElementById('yearSelect');


async function loadFilms(sortMode = currentSort) {
  currentSort = sortMode;

  let query = supabase.from("films_site").select("*");
  if (type)  query = query.eq("type", type); // —Ç–æ—á–Ω–∏–π —Ç–∏–ø
  if (genre) query = query.ilike("genre", `%${genre}%`);

  const { data, error } = await query.order("id", { ascending: false });

  const grid = document.getElementById("filmGrid");
  grid.innerHTML = "";

  if (error) {
    grid.innerHTML = `<p style="color:#ff6b6b;">–ü–æ–º–∏–ª–∫–∞: ${error.message}</p>`;
    return;
  }
  if (!data || data.length === 0) {
    grid.innerHTML = `<p style="color:#ccc;text-align:center;">–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –¥–ª—è –∂–∞–Ω—Ä—É "${genre}"</p>`;
    return;
  }

  // üé¨ –ì—Ä—É–ø—É–≤–∞–Ω–Ω—è —Å–µ—Ä—ñ–∞–ª—ñ–≤ –∑–∞ –Ω–∞–∑–≤–æ—é
  let items = [...data];
  if (type.toLowerCase().includes("—Å–µ—Ä—ñ–∞–ª")) {
    const unique = new Map();
    items.forEach(row => {
      const key = row.title?.trim().toLowerCase();
      if (!unique.has(key)) unique.set(key, row);
    });
    items = Array.from(unique.values());
  }

  // üéû –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –∑–∞ —Ä–æ–∫–æ–º
  if (selectedYear) {
    items = items.filter(f => String(f.year).trim() === selectedYear);
  }

  // üéØ –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è
  if (sortMode === "best") {
    items.sort((a, b) => (parseFloat(b.imdb || 0) || 0) - (parseFloat(a.imdb || 0) || 0));
  } else if (sortMode === "year") {
    items.sort((a, b) => (parseInt(b.year || 0) || 0) - (parseInt(a.year || 0) || 0));
  }

  // üß© –ü–∞–≥—ñ–Ω–∞—Ü—ñ—è
  const start = (currentPage - 1) * filmsPerPage;
  const end = start + filmsPerPage;
  const pageItems = items.slice(start, end);

  // üé® –í—ñ–¥–º–∞–ª—å–æ–≤—É—î–º–æ –∫–∞—Ä—Ç–∫–∏
  for (const film of pageItems) {
    const card = document.createElement("div");
    card.className = "film-card";
    card.innerHTML = `
      <img src="${film.poster || 'https://via.placeholder.com/200x280?text=No+Image'}" alt="${film.title}">
      <h3>${film.title}</h3>
    `;
    card.addEventListener("click", () => {
      if (film.type === "–°–µ—Ä—ñ–∞–ª") {
        window.location.href = "/series.html?title=" + encodeURIComponent(film.title);
      } else if (film.type === "–ú—É–ª—å—Ç—Å–µ—Ä—ñ–∞–ª") {
        window.location.href = "/multseries.html?title=" + encodeURIComponent(film.title);
      } else {
        window.location.href = "/film.html?id=" + film.id;
      }
    });
    grid.appendChild(card);
  }

  renderPagination(items.length);
}

function renderPagination(totalItems) {
  const totalPages = Math.ceil(totalItems / filmsPerPage);
  const pagination = document.getElementById("pagination");
  pagination.innerHTML = "";
  if (totalPages <= 1) return;

  const makeBtn = (label, page, {active=false, disabled=false}={}) => {
    const b = document.createElement("button");
    b.textContent = label;
    b.className = "page-btn";
    if (active) b.classList.add("active");
    if (disabled) b.disabled = true;
    b.addEventListener("click", () => {
      if (disabled) return;
      currentPage = page;
      loadFilms(currentSort);
      window.scrollTo({ top: 0, behavior: "smooth" });
    });
    return b;
  };

  const totalVisible = 5; // –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏ –ø–æ 5 –Ω–æ–º–µ—Ä—ñ–≤
  let start = Math.max(1, currentPage - Math.floor(totalVisible/2));
  let end   = Math.min(totalPages, start + totalVisible - 1);
  if (end - start + 1 < totalVisible) start = Math.max(1, end - totalVisible + 1);

  // ‚óÄ –ø–æ–ø–µ—Ä–µ–¥–Ω—è
  pagination.appendChild(makeBtn("‚óÄ", Math.max(1, currentPage-1), {disabled: currentPage===1}));

  // 1 2 3 4 5
  for (let i = start; i <= end; i++) {
    pagination.appendChild(makeBtn(String(i), i, {active: i===currentPage}));
  }

  // ‚ñ∂ –Ω–∞—Å—Ç—É–ø–Ω–∞
  pagination.appendChild(makeBtn("‚ñ∂", Math.min(totalPages, currentPage+1), {disabled: currentPage===totalPages}));
}

// === –ó–∞–ø–æ–≤–Ω–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É —Ä–æ–∫—ñ–≤ ===
async function fillYearOptions() {
  const { data, error } = await supabase
    .from("films_site")
    .select("year")
    .order("year", { ascending: false });

  if (error) {
    console.error("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Ä–æ–∫—ñ–≤:", error.message);
    return;
  }

  const yearSelect = document.getElementById("yearSelect");
  if (!yearSelect) return;

  const years = [...new Set(
    data
      .map(f => String(f.year || "").trim())
      .filter(y => y && y !== "undefined" && y !== "null")
  )];

  yearSelect.innerHTML =
    '<option value="">–£—Å—ñ —Ä–æ–∫–∏</option>' +
    years.map(y => `<option value="${y}">${y}</option>`).join('');
}

// === —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è ===
async function initCategoryPage() {
  await fillYearOptions();
  loadFilms("latest");

  btnLatest.addEventListener("click", () => {
    setActive(btnLatest);
    currentSort = "latest";
    currentPage = 1;
    loadFilms("latest");
  });

  btnBest.addEventListener("click", () => {
    setActive(btnBest);
    currentSort = "best";
    currentPage = 1;
    loadFilms("best");
  });

  btnYear.addEventListener("click", () => {
    setActive(btnYear);
    currentSort = "year";
    currentPage = 1;
    loadFilms("year");
  });

  yearSelect.addEventListener("change", (e) => {
    selectedYear = e.target.value;
    currentPage = 1;
    loadFilms(currentSort);
  });
}
// === –ê–∫—Ç–∏–≤–Ω–∞ –∫–Ω–æ–ø–∫–∞ —Ñ—ñ–ª—å—Ç—Ä–∞ ===
function setActive(activeBtn) {
  const buttons = document.querySelectorAll('.filter-btn');
  buttons.forEach(btn => btn.classList.remove('active'));
  activeBtn.classList.add('active');
}

initCategoryPage();


</script>
<script src="auth.js"></script>
<div id="footer-placeholder"></div>
<script>
  fetch("footer.html")
    .then(res => res.text())
    .then(html => {
      document.getElementById("footer-placeholder").innerHTML = html;
      // –ø—ñ—Å–ª—è —Ç–æ–≥–æ —è–∫ —Ñ—É—Ç–µ—Ä –∑‚Äô—è–≤–∏–≤—Å—è —É DOM ‚Äî –ø—ñ–¥–∫–ª—é—á–∞—î–º–æ –ª–æ–≥—ñ–∫—É
      const s = document.createElement("script");
      s.src = "footer.js";
      document.body.appendChild(s);
    });
</script> <!-- üü¢ –æ—Å—å —Ü—å–æ–≥–æ –∑–∞–∫—Ä–∏–≤–∞—é—á–æ–≥–æ —Ç–µ–≥—É –Ω–µ –≤–∏—Å—Ç–∞—á–∞–ª–æ! -->

<script src="/sw-register.js"></script> <!-- ‚úÖ Service Worker -->
</body>

</body>
</html>
