<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–°–µ—Ä—ñ–∞–ª ‚Äî KinoSite</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    /* --- –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ (—è–∫ —É film.html) --- */
.modal {
  display: none;
  position: fixed;
  z-index: 9999;
  left: 0; top: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.75);
}

.modal-content {
  background: #121212;
  color: #e0e0e0;
  margin: 10% auto;
  padding: 20px;
  border-radius: 10px;
  width: 90%;
  max-width: 400px;
  box-shadow: 0 0 15px rgba(0,0,0,0.5);
}

.modal-content h3 {
  margin-top: 0;
  color: #ff6b2b;
}

.modal-content textarea {
  width: 100%;
  background: #1b1b1b;
  border: 1px solid #444;
  color: #fff;
  border-radius: 6px;
  padding: 8px;
  resize: none;
}

.modal-buttons {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
  margin-top: 12px;
}

.modal-buttons button {
  padding: 6px 12px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  font-weight: 600;
}

.modal-buttons .cancel {
  background: #333;
  color: #ccc;
}

.modal-buttons .send {
  background: #ff6b2b;
  color: #fff;
}

.close-modal {
  float: right;
  font-size: 22px;
  cursor: pointer;
  color: #777;
}
.close-modal:hover { color: #fff; }

    .report-btn{
      background:transparent; 
      border:1px solid rgba(255,140,0,.6);
      color:#ffa500; 
      font-size:14px; 
      font-weight:700;
      padding:6px 10px; 
      border-radius:8px; 
      cursor:pointer; 
      transition:.2s; 
      margin-left:8px;
    }
    .report-btn:hover{
      box-shadow:0 0 12px rgba(255,140,0,.35);
      transform:scale(1.03);
    }

    .series-wrap{display:flex;gap:32px;flex-wrap:wrap;margin-top:28px}
    .series-left{flex:1;min-width:280px;max-width:360px;background:#0b0b0b;border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:14px}
    .series-left img {
      width: 95%;
      max-width: 275px;
      border-radius: 10px;
      margin: 0 auto;
      display: block;
      box-shadow: 0 0 20px rgba(0,255,255,0.25);
      border: 1px solid rgba(0,255,255,0.25);
      transition: transform 0.3s ease;
    }
    .series-left img:hover {
      transform: scale(1.05);
    }

    .series-title {
      font-size: 34px;
      color: #00fff2;
      text-shadow: 0 0 10px rgba(0,255,255,.35);
      font-weight: 700;
      margin: 30px 0 10px 10px; /* üî∏ —Ç—Ä–æ—Ö–∏ –≤–Ω–∏–∑ –≤—ñ–¥ —à–∞–ø–∫–∏, —ñ –≤–∏—Ä—ñ–≤–Ω—è–Ω–æ –∑ –ø–æ—Å—Ç–µ—Ä–æ–º */
      text-align: left;
      letter-spacing: 0.4px;
    }

    .series-meta{margin-top:12px;background:#101010;border:1px solid rgba(255,255,255,.06);border-radius:10px;padding:10px}
    .series-meta div{display:flex;justify-content:space-between;background:#151515;color:#ddd;padding:7px 10px;border-radius:6px;margin-bottom:6px}
    .series-right{flex:2;min-width:420px}
    .player-box{position:relative;background:#000;border-radius:12px;border:1px solid rgba(0,255,242,.3);overflow:hidden;box-shadow:0 0 30px rgba(0,255,242,.15)}
    video{width:100%;display:block;aspect-ratio:16/9;border-radius:12px}
    .episodes{margin-top:14px;background:#0d0d0d;border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:12px}
    .episodes h3{color:#00fff2;margin:0 0 10px}
    .season-block{margin-bottom:8px}
    .ep-list{display:flex;flex-wrap:wrap;gap:8px}
    .ep-btn{padding:7px 10px;border-radius:8px;border:1px solid rgba(0,255,242,.35);background:#0f0f0f;color:#e9fefe;font-weight:600;cursor:pointer}
    .ep-btn.active{outline:2px solid #00fff2}
    .series-desc{margin-top:16px;background:#1a1a1a;border:1px solid rgba(0,255,242,.2);border-radius:12px;padding:16px;color:#ddd;line-height:1.7}
    /* –æ–≤–µ—Ä–ª–µ–π–Ω–∞ –≤–µ–ª–∏–∫–∞ –∫–Ω–æ–ø–∫–∞ Play */
    #bigPlayOverlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.45);cursor:pointer;border-radius:12px;transition:opacity .25s ease}
    #bigPlayOverlay>div{width:100px;height:100px;border-radius:50%;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center;box-shadow:0 0 25px rgba(0,255,255,.5)}
    #bigPlayOverlay svg{width:58px;height:58px;fill:#00fff2}
    #bigPlayOverlay:hover svg{transform:scale(1.08);filter:drop-shadow(0 0 8px #00fff2)}
/* === ‚≠ê –ö–ù–û–ü–ö–ê –ó–ê–ö–õ–ê–î–û–ö === */
.source-row {
  display: flex;
  justify-content: flex-end;
  margin-top: 10px;
}

.bookmark-btn {
  background: transparent;
  border: 1px solid rgba(0,255,255,0.4);
  color: #00fff2;
  font-size: 15px;
  font-weight: 700;
  cursor: pointer;
  border-radius: 8px;
  padding: 6px 14px;
  transition: all 0.25s ease;
  text-shadow: 0 0 8px rgba(0,255,255,0.6);
}
.bookmark-btn:hover {
  transform: scale(1.08);
  box-shadow: 0 0 14px rgba(0,255,255,0.45);
}

/* üü° –ê–∫—Ç–∏–≤–Ω–∞ (–≤ –∑–∞–∫–ª–∞–¥–∫–∞—Ö) */
.bookmark-btn.active {
  border-color: gold;
  color: gold;
  text-shadow: 0 0 10px gold, 0 0 20px rgba(255,215,0,0.6);
  box-shadow: 0 0 15px rgba(255,215,0,0.3);
}
.bookmark-btn.active:hover {
  transform: scale(1.1);
  box-shadow: 0 0 25px rgba(255,215,0,0.5);
}

 /* === –†—è–¥–æ–∫ –∑ –Ω–∞–∑–≤–æ—é —Ç–∞ –∫–Ω–æ–ø–∫–æ—é –Ω–∞–¥ –ø–ª–µ—î—Ä–æ–º === */
.series-top-row{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  margin:6px 0 12px 0;
}
.series-top-title{
  margin:0;
  color:#00fff2;
}

/* –∫–Ω–æ–ø–∫–∞ –∑–∞–∫–ª–∞–¥–æ–∫ (—è–∫ —ñ —Ä–∞–Ω—ñ—à–µ) + –∞–∫—Ç–∏–≤–Ω–∏–π —Å—Ç–∞–Ω */
.bookmark-btn{
  background:transparent;
  border:1px solid rgba(0,255,255,.4);
  color:#00fff2;
  font-size:15px;
  font-weight:700;
  cursor:pointer;
  border-radius:8px;
  padding:6px 14px;
  transition:all .25s ease;
  text-shadow:0 0 8px rgba(0,255,255,.6);
}
.bookmark-btn:hover{
  transform:scale(1.08);
  box-shadow:0 0 14px rgba(0,255,255,.45);
}
.bookmark-btn.active{
  border-color:gold;
  color:gold;
  text-shadow:0 0 10px gold, 0 0 20px rgba(255,215,0,.6);
  box-shadow:0 0 15px rgba(255,215,0,.3);
}
.bookmark-btn.active:hover{
  transform:scale(1.1);
  box-shadow:0 0 25px rgba(255,215,0,.5);
}
/* --- –±–ª–æ–∫ –∫–Ω–æ–ø–æ–∫ –ø—Ä–∞–≤–æ—Ä—É—á --- */
.series-actions {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 4px;
}

/* ‚ö† —Ç–µ–∫—Å—Ç–æ–≤–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –∑–∞–º—ñ—Å—Ç—å –∫–Ω–æ–ø–∫–∏ */
.report-link {
  font-size: 13px;
  color: #ffae42;
  cursor: pointer;
  text-decoration: underline;
  transition: color .2s;
}
.report-link:hover {
  color: #ffc374;
}

/* –∞–¥–∞–ø—Ç–∏–≤: –Ω–∞ –≤—É–∑—å–∫–∏—Ö –µ–∫—Ä–∞–Ω–∞—Ö ‚Äî –ø–µ—Ä–µ–Ω–æ—Å –Ω–∞–∑–≤–∏ —ñ –∫–Ω–æ–ø–∫–∏ —É –¥–≤–∞ —Ä—è–¥–∫–∏ */
@media (max-width:640px){
  .series-top-row{flex-wrap:wrap;justify-content:flex-start;gap:8px}
}
  /* ===== üí¨ –°–ï–ö–¶–Ü–Ø –ö–û–ú–ï–ù–¢–ê–†–Ü–í ===== */
.comments-section {
  margin-top: 22px;
  background: #0d0d0d;
  border: 1px solid rgba(255, 255, 255, 0.06);
  border-radius: 12px;
  padding: 16px;
  width: 100%;
  box-sizing: border-box;
}

.comments-section h3 {
  color: #00fff2;
  font-size: 20px;
  margin-bottom: 12px;
}

.comment {
  background: #121212;
  border-radius: 8px;
  padding: 10px;
  color: #ddd;
  margin-bottom: 10px;
  border: 1px solid rgba(255, 255, 255, 0.05);
}

.comment strong {
  color: #00fff2;
  font-size: 15px;
}

.comment p {
  margin: 6px 0;
  line-height: 1.5;
}

.comment small {
  color: #888;
  font-size: 12px;
}

.comment-form {
  margin-top: 12px;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.comment-form input,
.comment-form textarea {
  background: #181818;
  border: 1px solid rgba(255, 255, 255, 0.08);
  color: #fff;
  border-radius: 8px;
  padding: 8px 10px;
  font-family: inherit;
  font-size: 14px;
}

.comment-form textarea {
  resize: none;
  height: 80px;
}

.comment-form button {
  background: #00fff2;
  border: none;
  color: #001c1a;
  font-weight: 700;
  font-size: 15px;
  border-radius: 8px;
  padding: 8px 0;
  cursor: pointer;
  transition: all 0.25s ease;
}

.comment-form button:hover {
  background: #00e6da;
  box-shadow: 0 0 12px rgba(0, 255, 255, 0.35);
}
 
  </style>
</head>
<body>

<!-- HEADER -->
<div id="header-placeholder"></div>
<script>
  // üü¢ –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó –ø–æ—à—É–∫—É –ø—ñ—Å–ª—è –≤—Å—Ç–∞–≤–∫–∏ —Ö–µ–¥–µ—Ä–∞
  function bindHeaderSearch() {
    const input = document.getElementById("search-input");
    if (!input) return;

    input.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        const query = input.value.trim();
        if (query.length > 1) {
          localStorage.setItem("searchQuery", query);
          window.location.href = "/search.html";
        }
      }
    });
  }

  // üü¢ –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ header.html —ñ –ø—ñ–¥–∫–ª—é—á–∞—î–º–æ –ø–æ—à—É–∫ –ø—ñ—Å–ª—è –≤—Å—Ç–∞–≤–∫–∏
  fetch("header.html")
    .then(r => r.text())
    .then(h => {
      document.getElementById("header-placeholder").innerHTML = h;
      bindHeaderSearch(); // –∞–∫—Ç–∏–≤—É—î–º–æ –ø–æ—à—É–∫ –ø—ñ—Å–ª—è –≤—Å—Ç–∞–≤–∫–∏
    })
    .catch(err => console.error("–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ö–µ–¥–µ—Ä–∞:", err));
</script>


<div class="container">
  <h1 class="series-title" id="seriesTitle">–°–µ—Ä—ñ–∞–ª</h1>

  <div class="series-wrap">
    <div class="series-left">
      <img id="seriesPoster" src="" alt="–ü–æ—Å—Ç–µ—Ä —Å–µ—Ä—ñ–∞–ª—É">
      <div class="series-meta">
        <div><span>–ñ–∞–Ω—Ä</span><span id="seriesGenre"></span></div>
        <div><span>–†—ñ–∫</span><span id="seriesYear"></span></div>
        <div><span>IMDb</span><span id="seriesImdb"></span></div>
      </div>
     

    </div>

    <div class="series-right">
      <div class="series-top-row">
        <h3 class="series-top-title">üé¨ –ü–µ—Ä–µ–≥–ª—è–¥</h3>
      
        <div class="series-actions">
          <button id="bookmarkSeriesBtn" class="bookmark-btn">‚≠ê –î–æ–¥–∞—Ç–∏ –≤ –∑–∞–∫–ª–∞–¥–∫–∏</button>
          <div id="reportIssueBtn" class="report-link">‚ö† –ü–æ–≤—ñ–¥–æ–º–∏—Ç–∏ –ø—Ä–æ –ø—Ä–æ–±–ª–µ–º—É</div>
        </div>
      </div>
      <div class="player-box">
        <video id="seriesPlayer" controls playsinline muted preload="metadata" crossorigin="anonymous"></video>
        <div id="bigPlayOverlay"><div><svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></div></div>
      </div>

      <div class="episodes">
        <h3>–°–µ—Ä—ñ—ó</h3>
        <div id="episodesContainer"></div>
      </div>

      <div class="series-desc">
        <h3>–ü—Ä–æ —Å–µ—Ä—ñ–∞–ª</h3>
        <p id="seriesDesc">–û–ø–∏—Å‚Ä¶</p>
      </div>
      <!-- üí¨ –ö–æ–º–µ–Ω—Ç–∞—Ä—ñ -->
<div class="comments-section">
  <h3>üí¨ –ö–æ–º–µ–Ω—Ç–∞—Ä—ñ</h3>

  <div id="commentsList"></div>

  <div class="comment-form">
    <input type="text" id="username" placeholder="–í–∞—à–µ —ñ–º‚Äô—è (–Ω–µ–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ)">
    <textarea id="commentText" placeholder="–ù–∞–ø–∏—à—ñ—Ç—å —Å–≤—ñ–π –∫–æ–º–µ–Ω—Ç–∞—Ä..." rows="3"></textarea>
    <button id="sendComment">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏</button>
  </div>
</div>

    </div>
  </div>
</div>

<footer>¬© 2025 KinoSite ‚Ä¢ –£—Å—ñ –ø—Ä–∞–≤–∞ –∑–∞—Ö–∏—â–µ–Ω—ñ</footer>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  // === Supabase
  const supabaseUrl = "https://zerlqvbmqszomlondlte.supabase.co";
  const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InplcmxxdmJtcXN6b21sb25kbHRlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUzMzg3NzQsImV4cCI6MjA3MDkxNDc3NH0.8wUBYIeQRC6KVp6vdzv0oqofIf4PeZyzbV5GcD0vxTE";
  const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

  const urlParams = new URLSearchParams(window.location.search);
  const seriesTitle = decodeURIComponent(urlParams.get("title") || "");

  const player = document.getElementById("seriesPlayer");
  const overlay = document.getElementById("bigPlayOverlay");
  let hls = null;

  function useSource(url){
    // –ø—Ä–∏–±–∏—Ä–∞—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π HLS
    if (hls){ try{hls.destroy()}catch(e){} hls=null; }
    try{ player.pause(); }catch(e){}
    player.removeAttribute("src"); player.load();

    if (!url) return;

    if (url.endsWith(".m3u8")){
      if (window.Hls && Hls.isSupported()){
        hls = new Hls({maxBufferLength:30,lowLatencyMode:true,enableWorker:true});
        hls.loadSource(url);
        hls.attachMedia(player);
      }else if (player.canPlayType("application/vnd.apple.mpegurl")){
        player.src = url; // Safari/iOS
      }
    }else{
      player.src = url; // mp4 —Ç–æ—â–æ
    }
  }

  overlay.addEventListener("click", async ()=>{
    try{ await player.play(); overlay.style.opacity="0"; overlay.style.pointerEvents="none"; }catch(e){}
  });
  player.addEventListener("play", ()=>{ overlay.style.opacity="0"; overlay.style.pointerEvents="none"; });
  player.addEventListener("pause", ()=>{ overlay.style.opacity="1"; overlay.style.pointerEvents="auto"; });

  function groupBySeason(rows){
    const map = new Map();
    rows.forEach(r=>{
      const s = r.season || 1;
      if(!map.has(s)) map.set(s, []);
      map.get(s).push(r);
    });
    // –µ–ø—ñ–∑–æ–¥–∏ –ø–æ –∑—Ä–æ—Å—Ç–∞–Ω–Ω—é
    for (const [s, arr] of map.entries()){
      arr.sort((a,b)=>(a.episode||0)-(b.episode||0));
    }
    return [...map.entries()].sort((a,b)=>a[0]-b[0]);
  }

  async function loadSeries(){
    if(!seriesTitle){
      document.body.innerHTML = "<h2 style='color:#fff;text-align:center'>–°–µ—Ä—ñ–∞–ª –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</h2>";
      return;
    }

    const { data, error } = await supabase
      .from("films_site")
      .select("*")
      .eq("type", "–°–µ—Ä—ñ–∞–ª")
      .eq("title", seriesTitle)
      .order("season", { ascending: true })
      .order("episode", { ascending: true });

    if (error || !data || !data.length){
      document.body.innerHTML = "<h2 style='color:#fff;text-align:center'>–°–µ—Ä—ñ–∞–ª –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</h2>";
      return;
    }

    // –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –∑–∞–≥–æ–ª–æ–≤–∫—É/–ø–æ—Å—Ç–µ—Ä–∞/–º–µ—Ç–∏/–æ–ø–∏—Å—É –∑ –ø–µ—Ä—à–æ–≥–æ —Ä—è–¥–∫–∞
    const first = data[0];
    document.getElementById("seriesTitle").textContent = first.title || seriesTitle;
    document.getElementById("seriesPoster").src = first.poster || "";
    document.getElementById("seriesGenre").textContent = first.genre || "";
    document.getElementById("seriesYear").textContent  = first.year  || "";
    document.getElementById("seriesImdb").textContent  = first.imdb  || "‚Äî";
    document.getElementById("seriesDesc").textContent  = first.description || "–û–ø–∏—Å –≤—ñ–¥—Å—É—Ç–Ω—ñ–π";

        // üß© –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ PRO-–¥–æ—Å—Ç—É–ø—É
    const isProSeries = String(first.pro_access || '').toUpperCase() === 'PRO';
    if (isProSeries) {
      const user = JSON.parse(localStorage.getItem('telegram_user') || 'null');
      const userId = user?.id ? String(user.id) : null;
      let hasPro = false;

      try {
        const resp = await fetch(`https://script.google.com/macros/s/AKfycbwUULSEmTKFORqOa3VwnQijTmNGw7Mt8bFd82G_HR7xwPSNlarMzE3Tmyrn1nju5WVPbA/exec?user_id=${encodeURIComponent(userId)}`);
        const json = await resp.json();
        hasPro = json?.isPro === true;
      } catch (e) {
        console.warn('–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ PRO:', e);
      }

      if (!hasPro) {
        const playerBox = document.querySelector('.player-box');
        playerBox.innerHTML = `
          <div style="
            background:#000;
            color:#00fff2;
            text-align:center;
            padding:40px;
            border-radius:12px;
            border:1px solid rgba(0,255,255,0.3);
            box-shadow:0 0 30px rgba(0,255,255,0.15);
          ">
            üíé –¶–µ–π —Å–µ—Ä—ñ–∞–ª –¥–æ—Å—Ç—É–ø–Ω–∏–π –ª–∏—à–µ –¥–ª—è PRO –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤.<br><br>
            <a href="profile.html" style="color:#fff;text-decoration:underline;">–û—Ç—Ä–∏–º–∞—Ç–∏ PRO</a>
          </div>
        `;
        return; // ‚ùó –∑—É–ø–∏–Ω—è—î–º–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è, –Ω–µ –ø–æ–∫–∞–∑—É—î–º–æ –ø–ª–µ—î—Ä
      }
    }


    // –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –ø–µ—Ä—à–µ –¥–∂–µ—Ä–µ–ª–æ
    useSource(first.stream_url || "");
    player.pause();

    // –º–∞–ª—é—î–º–æ —Å–ø–∏—Å–æ–∫ —Å–µ—Ä—ñ–π, –∑–≥—Ä—É–ø–æ–≤–∞–Ω–æ –ø–æ —Å–µ–∑–æ–Ω–∞—Ö
    const container = document.getElementById("episodesContainer");
    container.innerHTML = "";
    const groups = groupBySeason(data);

    groups.forEach(([season, episodes])=>{
      const block = document.createElement("div");
      block.className = "season-block";
      const h = document.createElement("h4");
      h.style.color="#bbb"; h.style.margin="6px 0";
      h.textContent = `–°–µ–∑–æ–Ω ${season}`;
      const list = document.createElement("div");
      list.className = "ep-list";

      episodes.forEach(ep=>{
        const btn = document.createElement("button");
        btn.className = "ep-btn";
        btn.textContent = `–°–µ—Ä—ñ—è ${ep.episode || "?"}`;
        btn.addEventListener("click", ()=>{
          container.querySelectorAll(".ep-btn.active").forEach(b=>b.classList.remove("active"));
          btn.classList.add("active");
          useSource(ep.stream_url || "");
          // ‚ñ∂Ô∏è –ê–≤—Ç–æ–ø–ª–µ–π –ø—Ä–∏–±—Ä–∞–Ω–æ ‚Äî –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —Å–∞–º –Ω–∞—Ç–∏—Å–∫–∞—î Play
        });
        // –∞–∫—Ç–∏–≤—É—î–º–æ –ø–µ—Ä—à—É –∫–Ω–æ–ø–∫—É
        if (ep === first) btn.classList.add("active");
        list.appendChild(btn);
      });

      block.appendChild(h);
      block.appendChild(list);
      container.appendChild(block);
    });
  }

  document.addEventListener("DOMContentLoaded", loadSeries);
  // === ‚≠ê –ó–ê–ö–õ–ê–î–ö–ò (–°–ï–†–Ü–ê–õ–ò) ===
function getBookmarks() {
  try { return JSON.parse(localStorage.getItem("bookmarks") || "[]"); }
  catch { return []; }
}
function setBookmarks(arr) {
  localStorage.setItem("bookmarks", JSON.stringify(arr));
}
function isSeriesBookmarked(title) {
  const list = getBookmarks();
  return list.some(x => x.title === title && x.type === "–°–µ—Ä—ñ–∞–ª");
}
function updateSeriesBookmarkBtn(title) {
  const btn = document.getElementById("bookmarkSeriesBtn");
  if (!btn) return;
  const active = isSeriesBookmarked(title);
  btn.textContent = active ? "‚≠ê –£ –∑–∞–∫–ª–∞–¥–∫–∞—Ö" : "‚≠ê –î–æ–¥–∞—Ç–∏ –≤ –∑–∞–∫–ª–∞–¥–∫–∏";
  btn.classList.toggle("active", active);
}

document.getElementById("bookmarkSeriesBtn")?.addEventListener("click", () => {
  const title = document.getElementById("seriesTitle")?.textContent.trim();
  const poster = document.getElementById("seriesPoster")?.src;
  const year = document.getElementById("seriesYear")?.textContent.trim();
  const genre = document.getElementById("seriesGenre")?.textContent.trim();
  const imdb = document.getElementById("seriesImdb")?.textContent.trim();

  let list = getBookmarks();
  const exists = isSeriesBookmarked(title);

  if (exists) {
    list = list.filter(x => !(x.title === title && x.type === "–°–µ—Ä—ñ–∞–ª"));
    setBookmarks(list);
    updateSeriesBookmarkBtn(title);
    alert("‚ùå –í–∏–¥–∞–ª–µ–Ω–æ —ñ–∑ –∑–∞–∫–ª–∞–¥–æ–∫");
  } else {
    list.push({
      id: "", // —Å–µ—Ä—ñ–∞–ª–∏ –≤—ñ–¥–∫—Ä–∏–≤–∞—é—Ç—å—Å—è –ø–æ title
      title,
      poster,
      year,
      genre,
      imdb,
      type: "–°–µ—Ä—ñ–∞–ª"
    });
    setBookmarks(list);
    updateSeriesBookmarkBtn(title);
    alert("‚úÖ –î–æ–¥–∞–Ω–æ —É –∑–∞–∫–ª–∞–¥–∫–∏");
  }
});

// –ü—ñ—Å–ª—è –ø–æ–≤–Ω–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö
document.addEventListener("DOMContentLoaded", async () => {
  await loadSeries(); // –¥–æ—á–µ–∫–∞—Ç–∏—Å—å –ø—ñ–¥–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–µ—Ä—ñ–∞–ª—É
  const title = document.getElementById("seriesTitle")?.textContent.trim();
  if (title) updateSeriesBookmarkBtn(title);
});


</script>
<!-- üßæ –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ -->
<div id="reportModal" class="modal">
  <div class="modal-content">
    <span class="close-modal">&times;</span>
    <h3>‚ö† –ü–æ–≤—ñ–¥–æ–º–∏—Ç–∏ –ø—Ä–æ –ø—Ä–æ–±–ª–µ–º—É</h3>
    <p>–û–ø–∏—à—ñ—Ç—å –∫–æ—Ä–æ—Ç–∫–æ, —â–æ –Ω–µ –ø—Ä–∞—Ü—é—î (–ø–æ—Å–∏–ª–∞–Ω–Ω—è, —Å–µ—Ä—ñ—è, –ø–ª–µ—î—Ä —Ç–æ—â–æ):</p>
    <textarea id="reportText" rows="4" placeholder="–ö–æ—Ä–æ—Ç–∫–æ –æ–ø–∏—à—ñ—Ç—å –ø—Ä–æ–±–ª–µ–º—É..."></textarea>
    <div class="modal-buttons">
      <button id="reportCancel" class="cancel">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
      <button id="reportSend" class="send">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏</button>
    </div>
  </div>
</div>

<script>
// === ‚ö† –ü–æ–≤—ñ–¥–æ–º–∏—Ç–∏ –ø—Ä–æ –ø—Ä–æ–±–ª–µ–º—É ===
(function(){
  const modal   = document.getElementById("reportModal");
  const txt     = document.getElementById("reportText");
  const btnOpen = document.getElementById("reportIssueBtn");
  const btnSend = document.getElementById("reportSend");
  const btnCancel = document.getElementById("reportCancel");

  if (!btnOpen || !modal) return;

  btnOpen.addEventListener("click", ()=>{ modal.style.display="block"; txt.focus(); });
  btnCancel.addEventListener("click", ()=>{ modal.style.display="none"; txt.value=""; });
  modal.addEventListener("click", (e)=>{ if (e.target===modal) modal.style.display="none"; });
  document.querySelector(".close-modal")?.addEventListener("click", ()=>{ modal.style.display="none"; });

  async function sendReport(item_type, titleElId){
    const message = (txt.value || "").trim();
    if (message.length < 5) return alert("–û–ø–∏—à—ñ—Ç—å –ø—Ä–æ–±–ª–µ–º—É –¥–µ—Ç–∞–ª—å–Ω—ñ—à–µ (–º—ñ–Ω—ñ–º—É–º 5 —Å–∏–º–≤–æ–ª—ñ–≤).");

    const title = (document.getElementById(titleElId)?.textContent || "").trim();
    let user = null;
    try { user = JSON.parse(localStorage.getItem("telegram_user") || "null"); } catch {}

    const payload = {
      user_id: user?.id ? String(user.id) : null,
      user_name: [user?.first_name, user?.last_name].filter(Boolean).join(" ") || user?.username || null,
      item_type,
      item_title: title,
      page_url: location.href,
      content: message,
      status: "new"
    };

    const { error } = await supabase.from("feedback_reports").insert(payload);
    if (error) { console.error(error); alert("–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥ —á–∞—Å –≤—ñ–¥–ø—Ä–∞–≤–∫–∏. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑."); return; }

    modal.style.display="none"; txt.value="";
    alert("‚úÖ –î—è–∫—É—î–º–æ! –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ. –í—ñ–¥–ø–æ–≤—ñ–¥—å –∑ º—è–≤–∏—Ç—å—Å—è —É —Ä–æ–∑–¥—ñ–ª—ñ ¬´–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è¬ª –≤–∞—à–æ–≥–æ –∫–∞–±—ñ–Ω–µ—Ç—É.");
  }

  btnSend.onclick = ()=>sendReport("–°–µ—Ä—ñ–∞–ª", "seriesTitle");
})();
</script>




<!-- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –ª–æ–≥—ñ–∫–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤ -->
<script src="comments.js"></script>
<script>
  window.APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwUULSEmTKFORqOa3VwnQijTmNGw7Mt8bFd82G_HR7xwPSNlarMzE3Tmyrn1nju5WVPbA/exec";
</script>
<script src="auth.js"></script>
<div id="footer-placeholder"></div>
<script>
  fetch("footer.html")
    .then(res => res.text())
    .then(html => {
      document.getElementById("footer-placeholder").innerHTML = html;
      // –ø—ñ—Å–ª—è —Ç–æ–≥–æ —è–∫ —Ñ—É—Ç–µ—Ä –∑‚Äô—è–≤–∏–≤—Å—è —É DOM ‚Äî –ø—ñ–¥–∫–ª—é—á–∞—î–º–æ –ª–æ–≥—ñ–∫—É
      const s = document.createElement("script");
      s.src = "footer.js";
      document.body.appendChild(s);
    });
</script>

</body>
</html>
