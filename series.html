<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <!-- ‚úÖ –Ü–∫–æ–Ω–∫–∏ —Å–∞–π—Ç—É –¥–ª—è –≤—Å—ñ—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤ -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#00fff2">

  <!-- Android favicon / PWA icons -->
  <link rel="icon" type="image/png" sizes="192x192" href="/icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/icon-512.png">

  <!-- iOS –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="/icon-512.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icon-512.png">

  <title>–°–µ—Ä—ñ–∞–ª ‚Äî KinoSite</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <style>

/* === üîπ –ö–Ω–æ–ø–∫–∏ –≤–∏–±–æ—Ä—É —Å–µ–∑–æ–Ω—É === */
.seasons-row {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-bottom: 16px;
  justify-content: flex-start;
}

.season-btn {
  background: linear-gradient(145deg, #0f0f0f, #151515);
  border: 1px solid rgba(0,255,255,0.35);
  color: #00fff2;
  font-weight: 600;
  border-radius: 10px;
  padding: 7px 14px;
  cursor: pointer;
  font-size: 15px;
  transition: all 0.25s ease;
  text-shadow: 0 0 5px rgba(0,255,255,0.6);
  box-shadow: 0 0 8px rgba(0,255,255,0.15);
}

.season-btn:hover {
  background: rgba(0,255,255,0.1);
  box-shadow: 0 0 10px rgba(0,255,255,0.3);
  transform: scale(1.05);
}

/* üü° –ê–∫—Ç–∏–≤–Ω–∏–π —Å–µ–∑–æ–Ω ‚Äî —è—Å–∫—Ä–∞–≤–æ –≤–∏–¥—ñ–ª–µ–Ω–∏–π */
.season-btn.active {
  background: linear-gradient(145deg, #00fff2, #00b5b0);
  color: #000;
  font-weight: 700;
  border-color: #00fff2;
  box-shadow: 0 0 20px rgba(0,255,255,0.5), inset 0 0 6px rgba(0,0,0,0.5);
  transform: scale(1.08);
}

/* –∞–¥–∞–ø—Ç–∏–≤ –¥–ª—è –≤—É–∑—å–∫–∏—Ö –µ–∫—Ä–∞–Ω—ñ–≤ */
@media (max-width: 600px) {
  .season-btn {
    font-size: 14px;
    padding: 6px 10px;
  }
}


    /* --- –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ (—è–∫ —É film.html) --- */
.modal {
  display: none;
  position: fixed;
  z-index: 9999;
  left: 0; top: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.75);
}

.modal-content {
  background: #121212;
  color: #e0e0e0;
  margin: 10% auto;
  padding: 20px;
  border-radius: 10px;
  width: 90%;
  max-width: 400px;
  box-shadow: 0 0 15px rgba(0,0,0,0.5);
}

.modal-content h3 {
  margin-top: 0;
  color: #ff6b2b;
}

.modal-content textarea {
  width: 100%;
  background: #1b1b1b;
  border: 1px solid #444;
  color: #fff;
  border-radius: 6px;
  padding: 8px;
  resize: none;
}

.modal-buttons {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
  margin-top: 12px;
}

.modal-buttons button {
  padding: 6px 12px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  font-weight: 600;
}

.modal-buttons .cancel {
  background: #333;
  color: #ccc;
}

.modal-buttons .send {
  background: #ff6b2b;
  color: #fff;
}

.close-modal {
  float: right;
  font-size: 22px;
  cursor: pointer;
  color: #777;
}
.close-modal:hover { color: #fff; }

    .report-btn{
      background:transparent; 
      border:1px solid rgba(255,140,0,.6);
      color:#ffa500; 
      font-size:14px; 
      font-weight:700;
      padding:6px 10px; 
      border-radius:8px; 
      cursor:pointer; 
      transition:.2s; 
      margin-left:8px;
    }
    .report-btn:hover{
      box-shadow:0 0 12px rgba(255,140,0,.35);
      transform:scale(1.03);
    }
    /* === üé¨ –ö–Ω–æ–ø–∫–∏ –Ω–∞–¥ –ø–ª–µ—î—Ä–æ–º (–°–µ—Ä—ñ—è / –¢—Ä–µ–π–ª–µ—Ä) === */
    .source-switch button {
      background: linear-gradient(145deg, #111, #181818);
      border: 1px solid rgba(0,255,255,0.4);
      color: #00fff2;
      font-size: 15px;
      font-weight: 600;
      padding: 8px 20px;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.25s ease;
      text-shadow: 0 0 6px rgba(0,255,255,0.5);
      box-shadow: 0 0 10px rgba(0,255,255,0.1);
    }
    
    .source-switch button:hover {
      background: rgba(0,255,255,0.1);
      box-shadow: 0 0 12px rgba(0,255,255,0.3);
      transform: translateY(-1px);
    }
    
    .source-switch button.active {
      background: linear-gradient(145deg, #00fff2, #00b5b0);
      color: #000;
      font-weight: 700;
      border-color: #00fff2;
      box-shadow: 0 0 15px rgba(0,255,255,0.5);
      transform: scale(1.05);
    }

    .series-wrap{display:flex;gap:32px;flex-wrap:wrap;margin-top:28px}
    .series-left {
      flex: 1;
      min-width: 280px;
      max-width: 360px;
      background: #0b0b0b;
      border: 1px solid rgba(0,255,255,0.2);
      border-radius: 12px;
      padding: 18px;
      box-shadow: 0 0 25px rgba(0,255,255,0.08);
    }

    .series-left img {
      width: 95%;
      max-width: 275px;
      border-radius: 10px;
      margin: 0 auto;
      display: block;
      box-shadow: 0 0 20px rgba(0,255,255,0.25);
      border: 1px solid rgba(0,255,255,0.25);
      transition: transform 0.3s ease;
    }
    .series-left img:hover {
      transform: scale(1.05);
    }

    .series-title {
      font-size: 34px;
      color: #00fff2;
      text-shadow: 0 0 10px rgba(0,255,255,.35);
      font-weight: 700;
      margin: 30px 0 10px 10px; /* üî∏ –¥–æ–¥–∞—î –≥–∞—Ä–Ω–∏–π –≤—ñ–¥—Å—Ç—É–ø –∑–≥–æ—Ä–∏ —ñ –≤–∏—Ä—ñ–≤–Ω—é—î –∑ –ø–æ—Å—Ç–µ—Ä–æ–º */
      text-align: left;
      letter-spacing: 0.4px;
    }


        /* === üßæ –õ—ñ–≤–∞ –∫–æ–ª–æ–Ω–∫–∞ –∑ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é === */
    .series-meta {
      margin-top: 14px;
      background: #0e0e0e;
      border: 1px solid rgba(0,255,255,0.25);
      border-radius: 12px;
      padding: 14px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      box-shadow: 0 0 20px rgba(0,255,255,0.1);
    }
    
    .series-meta div {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 8px;
      padding: 6px 10px;
      color: #ccc;
      font-size: 15px;
      transition: all 0.25s ease;
    }
    
    .series-meta div:hover {
      background: rgba(0,255,255,0.05);
      border-color: rgba(0,255,255,0.3);
      color: #00fff2;
    }
    
    .series-meta span:first-child {
      color: #00fff2;
      font-weight: 600;
    }

    .series-right{flex:2;min-width:420px}
    .player-box{position:relative;background:#000;border-radius:12px;border:1px solid rgba(0,255,242,.3);overflow:hidden;box-shadow:0 0 30px rgba(0,255,242,.15)}
    video{width:100%;display:block;aspect-ratio:16/9;border-radius:12px}
    .episodes{margin-top:14px;background:#0d0d0d;border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:12px}
    .episodes h3{color:#00fff2;margin:0 0 10px}
    .season-block{margin-bottom:8px}
    .ep-list{display:flex;flex-wrap:wrap;gap:8px}
    .ep-btn{padding:7px 10px;border-radius:8px;border:1px solid rgba(0,255,242,.35);background:#0f0f0f;color:#e9fefe;font-weight:600;cursor:pointer}
    .ep-btn.active{outline:2px solid #00fff2}
    .series-desc{margin-top:16px;background:#1a1a1a;border:1px solid rgba(0,255,242,.2);border-radius:12px;padding:16px;color:#ddd;line-height:1.7}
    /* –æ–≤–µ—Ä–ª–µ–π–Ω–∞ –≤–µ–ª–∏–∫–∞ –∫–Ω–æ–ø–∫–∞ Play */
    #bigPlayOverlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.45);cursor:pointer;border-radius:12px;transition:opacity .25s ease}
    #bigPlayOverlay>div{width:100px;height:100px;border-radius:50%;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center;box-shadow:0 0 25px rgba(0,255,255,.5)}
    #bigPlayOverlay svg{width:58px;height:58px;fill:#00fff2}
    #bigPlayOverlay:hover svg{transform:scale(1.08);filter:drop-shadow(0 0 8px #00fff2)}
/* === ‚≠ê –ö–ù–û–ü–ö–ê –ó–ê–ö–õ–ê–î–û–ö === */
.source-row {
  display: flex;
  justify-content: flex-end;
  margin-top: 10px;
}

.bookmark-btn {
  background: transparent;
  border: 1px solid rgba(0,255,255,0.4);
  color: #00fff2;
  font-size: 15px;
  font-weight: 700;
  cursor: pointer;
  border-radius: 8px;
  padding: 6px 14px;
  transition: all 0.25s ease;
  text-shadow: 0 0 8px rgba(0,255,255,0.6);
}
.bookmark-btn:hover {
  transform: scale(1.08);
  box-shadow: 0 0 14px rgba(0,255,255,0.45);
}

/* üü° –ê–∫—Ç–∏–≤–Ω–∞ (–≤ –∑–∞–∫–ª–∞–¥–∫–∞—Ö) */
.bookmark-btn.active {
  border-color: gold;
  color: gold;
  text-shadow: 0 0 10px gold, 0 0 20px rgba(255,215,0,0.6);
  box-shadow: 0 0 15px rgba(255,215,0,0.3);
}
.bookmark-btn.active:hover {
  transform: scale(1.1);
  box-shadow: 0 0 25px rgba(255,215,0,0.5);
}

 /* === –†—è–¥–æ–∫ –∑ –Ω–∞–∑–≤–æ—é —Ç–∞ –∫–Ω–æ–ø–∫–æ—é –Ω–∞–¥ –ø–ª–µ—î—Ä–æ–º === */
.series-top-row{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  margin:6px 0 12px 0;
}
.series-top-title{
  margin:0;
  color:#00fff2;
}

/* –∫–Ω–æ–ø–∫–∞ –∑–∞–∫–ª–∞–¥–æ–∫ (—è–∫ —ñ —Ä–∞–Ω—ñ—à–µ) + –∞–∫—Ç–∏–≤–Ω–∏–π —Å—Ç–∞–Ω */
.bookmark-btn{
  background:transparent;
  border:1px solid rgba(0,255,255,.4);
  color:#00fff2;
  font-size:15px;
  font-weight:700;
  cursor:pointer;
  border-radius:8px;
  padding:6px 14px;
  transition:all .25s ease;
  text-shadow:0 0 8px rgba(0,255,255,.6);
}
.bookmark-btn:hover{
  transform:scale(1.08);
  box-shadow:0 0 14px rgba(0,255,255,.45);
}
.bookmark-btn.active{
  border-color:gold;
  color:gold;
  text-shadow:0 0 10px gold, 0 0 20px rgba(255,215,0,.6);
  box-shadow:0 0 15px rgba(255,215,0,.3);
}
.bookmark-btn.active:hover{
  transform:scale(1.1);
  box-shadow:0 0 25px rgba(255,215,0,.5);
}
/* --- –±–ª–æ–∫ –∫–Ω–æ–ø–æ–∫ –ø—Ä–∞–≤–æ—Ä—É—á --- */
.series-actions {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 4px;
}

/* ‚ö† —Ç–µ–∫—Å—Ç–æ–≤–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –∑–∞–º—ñ—Å—Ç—å –∫–Ω–æ–ø–∫–∏ */
.report-link {
  font-size: 13px;
  color: #ffae42;
  cursor: pointer;
  text-decoration: underline;
  transition: color .2s;
}
.report-link:hover {
  color: #ffc374;
}

/* –∞–¥–∞–ø—Ç–∏–≤: –Ω–∞ –≤—É–∑—å–∫–∏—Ö –µ–∫—Ä–∞–Ω–∞—Ö ‚Äî –ø–µ—Ä–µ–Ω–æ—Å –Ω–∞–∑–≤–∏ —ñ –∫–Ω–æ–ø–∫–∏ —É –¥–≤–∞ —Ä—è–¥–∫–∏ */
@media (max-width:640px){
  .series-top-row{flex-wrap:wrap;justify-content:flex-start;gap:8px}
}
  /* ===== üí¨ –°–ï–ö–¶–Ü–Ø –ö–û–ú–ï–ù–¢–ê–†–Ü–í ===== */
.comments-section {
  margin-top: 22px;
  background: #0d0d0d;
  border: 1px solid rgba(255, 255, 255, 0.06);
  border-radius: 12px;
  padding: 16px;
  width: 100%;
  box-sizing: border-box;
}

.comments-section h3 {
  color: #00fff2;
  font-size: 20px;
  margin-bottom: 12px;
}

.comment {
  background: #121212;
  border-radius: 8px;
  padding: 10px;
  color: #ddd;
  margin-bottom: 10px;
  border: 1px solid rgba(255, 255, 255, 0.05);
}

.comment strong {
  color: #00fff2;
  font-size: 15px;
}

.comment p {
  margin: 6px 0;
  line-height: 1.5;
}

.comment small {
  color: #888;
  font-size: 12px;
}

.comment-form {
  margin-top: 12px;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.comment-form input,
.comment-form textarea {
  background: #181818;
  border: 1px solid rgba(255, 255, 255, 0.08);
  color: #fff;
  border-radius: 8px;
  padding: 8px 10px;
  font-family: inherit;
  font-size: 14px;
}

.comment-form textarea {
  resize: none;
  height: 80px;
}

.comment-form button {
  background: #00fff2;
  border: none;
  color: #001c1a;
  font-weight: 700;
  font-size: 15px;
  border-radius: 8px;
  padding: 8px 0;
  cursor: pointer;
  transition: all 0.25s ease;
}

.comment-form button:hover {
  background: #00e6da;
  box-shadow: 0 0 12px rgba(0, 255, 255, 0.35);
}
 /* ===== üé¨ –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω—ñ (—É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω—ñ —Å—Ç–∏–ª—ñ) ===== */
.recommended-section {
  margin-top: 22px;
  background: #0d0d0d;
  border: 1px solid rgba(255,255,255,0.06);
  border-radius: 12px;
  padding: 16px;
}
.recommended-section h3 {
  color: #00fff2;
  font-size: 18px;
  margin-bottom: 12px;
}
.recommended-list {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
}
.recommended-item {
  width: 100px;
  text-align: center;
  cursor: pointer;
  transition: transform 0.2s ease;
}
.recommended-item:hover { transform: translateY(-4px); }
.recommended-item img {
  width: 100%;
  height: 145px;
  object-fit: cover;
  border-radius: 8px;
}
.recommended-item p {
  margin-top: 6px;
  font-size: 13px;
  color: #ccc;
  line-height: 1.3;
}
/* === üîπ Telegram Banner (—è–∫ —É film.html) === */
.tg-banner {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  gap: 8px;
  width: 95%;
  background: #0d0d0d;
  border: 1px solid rgba(255, 255, 255, 0.08);
  border-radius: 10px;
  padding: 10px 14px;
  color: #00fff2;
  text-decoration: none;
  font-weight: 500;
  font-size: 13.5px;
  margin: 0 auto 12px auto; /* –ø–æ —Ü–µ–Ω—Ç—Ä—É —ñ –∑ –≤—ñ–¥—Å—Ç—É–ø–æ–º */
  box-shadow: none;
  transition: none;
}
.tg-banner:hover {
  background: #0d0d0d;
  transform: none;
  box-shadow: none;
}
.tg-icon {
  width: 18px;
  height: 18px;
  filter: invert(58%) sepia(82%) saturate(610%) hue-rotate(138deg) brightness(97%) contrast(97%);
}

  </style>
</head>
<body>
<div id="header-placeholder"></div>
<script src="header.js"></script>



<div class="container">
  <h1 class="series-title" id="seriesTitle" data-enc=""></h1>

<div class="series-wrap">

  <!-- üñºÔ∏è –õ—ñ–≤–æ—Ä—É—á –ø–æ—Å—Ç–µ—Ä —ñ –º–µ—Ç–∞ -->
  <div class="series-left">
    <img id="seriesPoster" src="" alt="–ü–æ—Å—Ç–µ—Ä —Å–µ—Ä—ñ–∞–ª—É">

    <div class="series-meta">
      <div><span>–ñ–∞–Ω—Ä</span><span id="seriesGenre"></span></div>
      <div><span>–†—ñ–∫</span><span id="seriesYear"></span></div>
      <div><span>IMDb</span><span id="seriesImdb"></span></div>
      <div><span>–ö—Ä–∞—ó–Ω–∞</span><span id="seriesCountry"></span></div>
      <div><span>–†–µ–∂–∏—Å–µ—Ä</span><span id="seriesDirector"></span></div>
      <div><span>–í —Ä–æ–ª—è—Ö</span><span id="seriesCast"></span></div>
      <div><span>–ó–≤—É–∫</span><span id="seriesSound"></span></div>
      <div><span>–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å</span><span id="seriesDuration"></span></div>
      <div><span>–í—ñ–∫</span><span id="seriesAge"></span></div>
    </div>
  </div> <!-- /series-left -->

      <!-- üé¨ –ü—Ä–∞–≤–æ—Ä—É—á –≤—ñ–¥–µ–æ, —Å–µ–∑–æ–Ω–∏, –æ–ø–∏—Å -->
      <div class="series-right">
    <!-- üîπ –¢–µ–ª–µ–≥—Ä–∞–º-–±–∞–Ω–µ—Ä -->
    <a href="https://t.me/RelaxBoxUA_bot?start=series_1234" target="_blank" class="tg-banner" 
       style="display:flex;align-items:center;gap:10px;background:#0d0d0d;border:1px solid rgba(0,255,255,0.3);
              border-radius:10px;padding:10px 14px;margin-bottom:10px;text-decoration:none;color:#00fff2;
              font-weight:600;box-shadow:0 0 10px rgba(0,255,255,0.15);">
      <img src="https://upload.wikimedia.org/wikipedia/commons/8/82/Telegram_logo.svg"
           alt="Telegram" style="width:28px;height:28px;">
      <span>üî• –ù–æ–≤–∏–Ω–∫–∏ –≤ –∫–∞–Ω–∞–ª—ñ, –ø–µ—Ä–µ–≥–ª—è–¥ —É –±–æ—Ç—ñ ‚Äî —É—Å–µ –≤ –æ–¥–Ω–æ–º—É –º—ñ—Å—Ü—ñ!</span>
    </a>
    
        <!-- üîπ –ü–µ—Ä–µ–º–∏–∫–∞—á –¥–∂–µ—Ä–µ–ª–∞ -->
    <div class="source-row" style="display:flex;align-items:center;justify-content:space-between;gap:12px;margin:10px 0 14px 0;">
      <div class="source-switch" style="display:flex;gap:10px;">
        <button id="btnEpisode" class="active">üé¨ –°–µ—Ä—ñ—è</button>
        <button id="btnSeasonTrailer">üéûÔ∏è –¢—Ä–µ–π–ª–µ—Ä</button>
      </div>

      <div class="series-actions">
        <button id="bookmarkSeriesBtn" class="bookmark-btn">‚≠ê –î–æ–¥–∞—Ç–∏ –≤ –∑–∞–∫–ª–∞–¥–∫–∏</button>
        <div id="reportIssueBtn" class="report-link">‚ö† –ü–æ–≤—ñ–¥–æ–º–∏—Ç–∏ –ø—Ä–æ –ø—Ä–æ–±–ª–µ–º—É</div>
      </div>
    </div>

    <!-- üß© –ü–ª–µ—î—Ä -->
    <div class="player-box">
      <video id="seriesPlayer" controls playsinline muted preload="metadata" crossorigin="anonymous"></video>
      <script>
// üïí –ó–∞–ø–∞–º‚Äô—è—Ç–æ–≤—É—î–º–æ –æ—Å—Ç–∞–Ω–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏–π —Å–µ—Ä—ñ–∞–ª –∞–±–æ –º—É–ª—å—Ç—Å–µ—Ä—ñ–∞–ª
const typeName = location.pathname.includes("multseries") ? "–ú—É–ª—å—Ç—Å–µ—Ä—ñ–∞–ª" : "–°–µ—Ä—ñ–∞–ª";

const playerEl = document.getElementById("seriesPlayer");
playerEl.addEventListener("timeupdate", () => {
  const currentTime = playerEl.currentTime;
  if (currentTime > 30) { // –∑–±–µ—Ä—ñ–≥–∞—î–º–æ –ª–∏—à–µ —è–∫—â–æ –ø–æ–¥–∏–≤–∏–ª–∏—Å—å –±—ñ–ª—å—à–µ 30 —Å–µ–∫
    const title = document.getElementById("seriesTitle")?.textContent.trim();
    const poster = document.getElementById("seriesPoster")?.src || "";
    const lastData = { 
      id: title, 
      title, 
      poster, 
      time: currentTime, 
      type: typeName,
      url: location.href
    };
    localStorage.setItem("lastWatched", JSON.stringify(lastData));
  }
});

// ‚ñ∂Ô∏è –í—ñ–¥–Ω–æ–≤–ª—é—î–º–æ –ø–æ–∑–∏—Ü—ñ—é –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º—É –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ
document.addEventListener("DOMContentLoaded", () => {
  const title = document.getElementById("seriesTitle")?.textContent.trim();
  const last = JSON.parse(localStorage.getItem("lastWatched") || "null");
  if (last && last.title === title && last.type === typeName) {
    const player = document.getElementById("seriesPlayer");
    player.currentTime = last.time;
  }
});
</script>

      <div id="bigPlayOverlay"><div><svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></div></div>
    </div>

    <!-- üì∫ –°–µ–∑–æ–Ω–∏ –π —Å–µ—Ä—ñ—ó -->
    <div class="episodes">
      <h3>–°–µ—Ä—ñ—ó</h3>
      <h4 style="color:#00fff2;margin-top:8px;">–°–µ–∑–æ–Ω–∏:</h4>
      <div id="episodesContainer"></div>
    </div>

    <!-- üìñ –û–ø–∏—Å -->
    <div class="series-desc">
      <h3>–ü—Ä–æ —Å–µ—Ä—ñ–∞–ª</h3>
      <p id="seriesDesc">–û–ø–∏—Å‚Ä¶</p>
    </div>

    <!-- üéûÔ∏è –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω—ñ -->
    <div class="recommended-section">
      <h3>üéûÔ∏è –†–µ–∫–æ–º–µ–Ω–¥—É—î–º–æ –ø–æ–¥–∏–≤–∏—Ç–∏—Å—å</h3>
      <div id="recommendedSeriesList" class="recommended-list"></div>
    </div>

    <!-- üí¨ –ö–æ–º–µ–Ω—Ç–∞—Ä—ñ -->
    <div class="comments-section">
      <h3>üí¨ –ö–æ–º–µ–Ω—Ç–∞—Ä—ñ</h3>
      <div id="commentsList"></div>
      <div class="comment-form">
        <input type="text" id="username" placeholder="–í–∞—à–µ —ñ–º‚Äô—è (–Ω–µ–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ)">
        <textarea id="commentText" placeholder="–ù–∞–ø–∏—à—ñ—Ç—å —Å–≤—ñ–π –∫–æ–º–µ–Ω—Ç–∞—Ä..." rows="3"></textarea>
        <button id="sendComment">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏</button>
      </div>
    </div>

  </div> <!-- /series-right -->
</div> <!-- /series-wrap -->

<footer>¬© 2025 KinoSite ‚Ä¢ –£—Å—ñ –ø—Ä–∞–≤–∞ –∑–∞—Ö–∏—â–µ–Ω—ñ</footer>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  // === Supabase
  const supabaseUrl = "https://zerlqvbmqszomlondlte.supabase.co";
  const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InplcmxxdmJtcXN6b21sb25kbHRlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUzMzg3NzQsImV4cCI6MjA3MDkxNDc3NH0.8wUBYIeQRC6KVp6vdzv0oqofIf4PeZyzbV5GcD0vxTE";
  const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

  const urlParams = new URLSearchParams(window.location.search);
  const seriesTitle = decodeURIComponent(urlParams.get("title") || "");

  const player = document.getElementById("seriesPlayer");
  const overlay = document.getElementById("bigPlayOverlay");
  let hls = null;
  // === –°—Ç–µ–π—Ç –¥–ª—è –ø–µ—Ä–µ–º–∏–∫–∞—á–∞ –¥–∂–µ—Ä–µ–ª–∞
  let currentSource = "episode";        // 'episode' | 'trailer'
  let currentEpisodeUrl = "";           // –ø–æ—Ç–æ—á–Ω–∞ —Å–µ—Ä—ñ—è
  let currentTrailerUrl = "";           // —Ç—Ä–µ–π–ª–µ—Ä —Å–µ–∑–æ–Ω—É (–∑ —Ç–∞–±–ª–∏—Ü—ñ)
  
  // YouTube helpers (—è–∫ —É film.html)
  function isYouTube(url){
    return /youtube\.com|youtu\.be|googlevideo\.com/.test(url || "");
  }
  function getYouTubeId(url){
    if (!url) return "";
    const m1 = url.match(/(?:v=|\/)([0-9A-Za-z_-]{11})(?:[?&]|$)/);
    if (m1) return m1[1];
    const m2 = url.match(/^[0-9A-Za-z_-]{11}$/);
    return m2 ? m2[0] : "";
  }
  
  // –í—ñ–¥–Ω–æ–≤–∏—Ç–∏ –≤—ñ–¥–µ–æ-–ø–ª–µ—î—Ä —É—Å–µ—Ä–µ–¥–∏–Ω—ñ .player-box (–∫–æ–ª–∏ –¥–æ —Ü—å–æ–≥–æ –±—É–≤ iframe —Ç—Ä–µ–π–ª–µ—Ä–∞)
 function ensureVideoPlayer() {
  const box = document.querySelector(".player-box");
  let video = box.querySelector("video#seriesPlayer");
  let overlay = box.querySelector("#bigPlayOverlay");

  // –Ø–∫—â–æ –≤—ñ–¥–µ–æ –≤—ñ–¥—Å—É—Ç–Ω—î ‚Äî —Å—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤–∏–π –ø–ª–µ—î—Ä
  if (!video) {
    box.innerHTML = `
      <video id="seriesPlayer" controls playsinline muted preload="metadata" crossorigin="anonymous"
        style="width:100%;display:block;aspect-ratio:16/9;border-radius:12px"></video>
      <div id="bigPlayOverlay">
        <div>
          <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
        </div>
      </div>
    `;
    video = box.querySelector("#seriesPlayer");
    overlay = box.querySelector("#bigPlayOverlay");
  }

  // ü©µ –Ø–∫—â–æ –∫–Ω–æ–ø–∫–∞ –∑–Ω–∏–∫–ª–∞ ‚Äî –¥–æ–¥–∞—î–º–æ —ó—ó –∑–Ω–æ–≤—É
  if (!overlay) {
    const div = document.createElement("div");
    div.id = "bigPlayOverlay";
    div.innerHTML = `<div><svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></div>`;
    box.appendChild(div);
    overlay = div;
  }

  // –∫–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞—Ç–∏—Å–Ω–µ ‚ñ∂Ô∏è, –ø—Ä–∏–±–∏—Ä–∞—î–º–æ overlay
  overlay.onclick = async () => {
    try {
      player.muted = false; // ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–º–∏–∫–∞—î–º–æ –∑–≤—É–∫
      await player.play();
      overlay.style.opacity = "0";
      overlay.style.pointerEvents = "none";
    } catch (e) {}
  };


  video.addEventListener("play", () => {
    overlay.style.opacity = "0";
    overlay.style.pointerEvents = "none";
  });

  video.addEventListener("pause", () => {
    overlay.style.opacity = "1";
    overlay.style.pointerEvents = "auto";
  });
}

  
function useSource(url) {
  ensureVideoPlayer(); 
  const player = document.getElementById("seriesPlayer");
  const overlay = document.getElementById("bigPlayOverlay");

  // üî• –ó–Ω–∏—â—É—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —ñ–Ω—Å—Ç–∞–Ω—Å HLS
  if (hls) {
    try { hls.destroy(); } catch (e) {}
    hls = null;
  }

  try { player.pause(); } catch (e) {}
  player.removeAttribute("src");
  player.load();

  // –ø–æ–∫–∞–∑—É—î–º–æ –∫–Ω–æ–ø–∫—É Play
  if (overlay) {
    overlay.style.opacity = "1";
    overlay.style.pointerEvents = "auto";
  }

  if (!url) return;

  // === Google Drive ‚Üí –ø—Ä–æ–∫—Å—ñ Worker ===
  if (url.includes("drive.google.com") || url.includes("uc?export=download")) {
    const fileId = url.match(/\/d\/([^/]+)/)?.[1];
    if (fileId) {
      url = `https://driveproxy.lyuda14070702.workers.dev/?id=${fileId}`;
      console.log("üé• Google Drive —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å—ñ:", url);
    }
  }

  // === HLS (.m3u8) ===
  if (url.includes(".m3u8")) {
    if (window.Hls && Hls.isSupported()) {

      hls = new Hls({
        maxBufferLength: 60,
        maxMaxBufferLength: 120,
        backBufferLength: 120,
        liveSyncDurationCount: 3,
        enableWorker: true,
        lowLatencyMode: false,

        fragLoadingMaxRetry: 6,
        fragLoadingRetryDelay: 800,
        manifestLoadingRetryDelay: 800,

        xhrSetup: (xhr) => {
          xhr.withCredentials = false;
        }
      });

      hls.loadSource(url);
      hls.attachMedia(player);

      // –ö–æ–ª–∏ HLS –≥–æ—Ç–æ–≤–∏–π ‚Äî –≤—ñ–¥–Ω–æ–≤–ª—é—î–º–æ —á–∞—Å –ø–µ—Ä–µ–≥–ª—è–¥—É
      hls.on(Hls.Events.MANIFEST_PARSED, () => {
        const title = document.getElementById("seriesTitle")?.textContent.trim();
        const last = JSON.parse(localStorage.getItem("lastWatched") || "null");
        if (last && last.title === title && last.time > 1) {
          player.currentTime = last.time;
        }
      });

      // –ê–≤—Ç–æ–≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∏ –ø–æ–º–∏–ª–∫–∞—Ö
      hls.on(Hls.Events.ERROR, (ev, data) => {
        if (data.fatal) {
          if (data.type === Hls.ErrorTypes.NETWORK_ERROR) {
            hls.startLoad();
          } else if (data.type === Hls.ErrorTypes.MEDIA_ERROR) {
            hls.recoverMediaError();
          } else {
            hls.destroy();
            hls = null;
          }
        }
      });

    } else if (player.canPlayType("application/vnd.apple.mpegurl")) {
      // Safari / iPhone
      player.src = url;
    }

    return;
  }

  // === mp4 ===
  player.src = url;
}



  function groupBySeason(rows){
    const map = new Map();
    rows.forEach(r=>{
      const s = r.season || 1;
      if(!map.has(s)) map.set(s, []);
      map.get(s).push(r);
    });
    // –µ–ø—ñ–∑–æ–¥–∏ –ø–æ –∑—Ä–æ—Å—Ç–∞–Ω–Ω—é
    for (const [s, arr] of map.entries()){
      arr.sort((a,b)=>(a.episode||0)-(b.episode||0));
    }
    return [...map.entries()].sort((a,b)=>a[0]-b[0]);
  }

  async function loadSeries(){
    if(!seriesTitle){
      document.body.innerHTML = "<h2 style='color:#fff;text-align:center'>–°–µ—Ä—ñ–∞–ª –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</h2>";
      return;
    }

    const { data, error } = await supabase
    .from("films_site")
    .select("*, episode_label")
    .eq("type", "–°–µ—Ä—ñ–∞–ª")
    .or(`title.eq.${seriesTitle},main_title.eq.${seriesTitle}`)
    .order("season", { ascending: true })
    .order("episode", { ascending: true });

    if (error || !data || !data.length){
      document.body.innerHTML = "<h2 style='color:#fff;text-align:center'>–°–µ—Ä—ñ–∞–ª –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</h2>";
      return;
    }

    // üßπ –ü—Ä–∏–±–∏—Ä–∞—î–º–æ –¥—É–±–ª—ñ–∫–∞—Ç–∏ —Å–µ—Ä—ñ–π (–æ–¥–Ω–∞–∫–æ–≤–∏–π —Å–µ–∑–æ–Ω + –Ω–æ–º–µ—Ä —Å–µ—Ä—ñ—ó)
    const uniqueEpisodes = new Map();
    data.forEach(row => {
      const key = `${row.season || 1}_${row.episode || 0}`;
      if (!uniqueEpisodes.has(key)) uniqueEpisodes.set(key, row);
    });
    const cleanData = Array.from(uniqueEpisodes.values());


    // –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –∑–∞–≥–æ–ª–æ–≤–∫—É/–ø–æ—Å—Ç–µ—Ä–∞/–º–µ—Ç–∏/–æ–ø–∏—Å—É –∑ –ø–µ—Ä—à–æ–≥–æ —Ä—è–¥–∫–∞
    const first = cleanData[0];
    // üß© –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ –±–æ—Ç—ñ–≤ —ñ–∑ ‚Äú—Å—ñ–ª–ª—é‚Äù
    const titleEl = document.getElementById("seriesTitle");
    if (titleEl && first.title) {
      const salt = "relaxbox2025"; // –º–æ–∂–µ—à –∑–º—ñ–Ω–∏—Ç–∏ –Ω–∞ —ñ–Ω—à–µ —Å–ª–æ–≤–æ
      const encoded = btoa(encodeURIComponent(first.title + "||" + salt));
      titleEl.dataset.enc = encoded;
    
      try {
        const decoded = decodeURIComponent(atob(encoded)).split("||")[0];
        titleEl.textContent = decoded;
      } catch (e) {
        console.warn("–ü–æ–º–∏–ª–∫–∞ –¥–µ–∫–æ–¥—É–≤–∞–Ω–Ω—è –Ω–∞–∑–≤–∏ —Å–µ—Ä—ñ–∞–ª—É:", e);
        titleEl.textContent = first.title; // –∑–∞–ø–∞—Å–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç
      }
    } else {
      // –Ø–∫—â–æ –Ω–µ–º–∞—î titleEl –∞–±–æ –Ω–∞–∑–≤–∏ ‚Äî –ø–æ–∫–∞–∑—É—î–º–æ —è–∫ —î
      document.getElementById("seriesTitle").textContent = seriesTitle;
    }

    document.getElementById("seriesPoster").src = first.poster || "";
    document.getElementById("seriesGenre").textContent = first.genre || "";
    document.getElementById("seriesYear").textContent  = first.year  || "";
    document.getElementById("seriesImdb").textContent  = first.imdb  || "‚Äî";
    document.getElementById("seriesDesc").textContent  = first.description || "–û–ø–∏—Å –≤—ñ–¥—Å—É—Ç–Ω—ñ–π";

    // üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –∑–∞–º—ñ–Ω–∞ –¥–∂–µ—Ä–µ–ª–∞ –Ω–∞ Worker
    const WORKER_URL = "https://kino-hls.lyuda14070702.workers.dev";
    
    data.forEach(r => {
      if (r.stream_url) {
        r.stream_url = r.stream_url.replace(
          "https://kino-video.pages.dev",
          WORKER_URL
        );
      }
    });
    
    first.stream_url = first.stream_url?.replace("https://kino-video.pages.dev", WORKER_URL);

    // üé¨ –ü—ñ–¥–±—ñ—Ä–∫–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∏—Ö —Å–µ—Ä—ñ–∞–ª—ñ–≤
    loadRecommendedSeries(first.title, first.genre);

// üß© –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ PRO-–¥–æ—Å—Ç—É–ø—É (–ø—Ä–∞—Ü—é—î —ñ –¥–ª—è Telegram, —ñ –¥–ª—è Email/Web)
let hasPro = true;
const isProSeries = String(first.pro_access || '').toUpperCase() === 'PRO';

if (isProSeries) {
  hasPro = false;

  const tgUser   = localStorage.getItem('telegram_user');
  const emailUser = localStorage.getItem('email_user');
  const webId     = localStorage.getItem('web_id');
  let url = window.APPS_SCRIPT_URL;

  try {
    // üü¢ Telegram-–≤—Ö—ñ–¥
    if (tgUser) {
      const parsed = JSON.parse(tgUser);
      if (parsed?.id) url += `?user_id=${encodeURIComponent(parsed.id)}`;

    // üü£ Email / Web-–≤—Ö—ñ–¥ (WEB-ID)
    } else if (webId) {
      url += `?user_id=${encodeURIComponent(webId)}`;

    // üî∏ –†–µ–∑–µ—Ä–≤ ‚Äî —è–∫—â–æ ID —î –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ emailUser
    } else if (emailUser) {
      const parsed = JSON.parse(emailUser);
      if (parsed?.id) url += `?user_id=${encodeURIComponent(parsed.id)}`;
    }

    console.log("üì° –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ PRO:", url);
    const res = await fetch(url);
    const json = await res.json();
    hasPro = json?.isPro === true;
    console.log("üîé –†–µ–∑—É–ª—å—Ç–∞—Ç PRO:", json);

  } catch (err) {
    console.warn("‚ùå –ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ PRO:", err);
  }

  // üíé –Ø–∫—â–æ –Ω–µ–º–∞—î PRO ‚Äî –ø–æ–∫–∞–∑—É—î–º–æ –±–∞–Ω–µ—Ä
  if (!hasPro) {
    const playerBox = document.querySelector('.player-box');
    playerBox.innerHTML = `
      <div style="
        background:#000;
        color:#00fff2;
        text-align:center;
        padding:45px 20px;
        border-radius:12px;
        border:1px solid rgba(0,255,255,0.3);
        box-shadow:0 0 30px rgba(0,255,255,0.15);
        font-size:18px;
        line-height:1.6;
      ">
        üíé –¶–µ–π –∫–æ–Ω—Ç–µ–Ω—Ç –¥–æ—Å—Ç—É–ø–Ω–∏–π –ª–∏—à–µ –¥–ª—è <b>PRO –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</b>.<br><br>
        <a href="profile.html" style="color:#fff;text-decoration:underline;font-weight:600;">
          –û—Ç—Ä–∏–º–∞—Ç–∏ PRO
        </a>
      </div>
    `;
  }
}



// üé¨ –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–∞—î PRO –∞–±–æ —Å–µ—Ä—ñ–∞–ª –Ω–µ PRO ‚Äî –ø–æ–∫–∞–∑—É—î–º–æ –≤—ñ–¥–µ–æ
if (hasPro) {
  useSource(first.stream_url || "");
  player.pause();
} 
// üé¨ –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –±–µ–∑ PRO ‚Äî –ø–æ–∫–∞–∑—É—î–º–æ –±–∞–Ω–µ—Ä
else {
  const playerBox = document.querySelector('.player-box');
  playerBox.innerHTML = `
    <div style="
      background:#000;
      color:#00fff2;
      text-align:center;
      padding:45px 20px;
      border-radius:12px;
      border:1px solid rgba(0,255,255,0.3);
      box-shadow:0 0 30px rgba(0,255,255,0.15);
      font-size:18px;
      line-height:1.6;
    ">
      üíé –¶–µ–π —Å–µ—Ä—ñ–∞–ª –¥–æ—Å—Ç—É–ø–Ω–∏–π –ª–∏—à–µ –¥–ª—è <b>PRO –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</b>.<br><br>
      <a href="profile.html" 
         style="color:#fff;text-decoration:underline;font-weight:600;">
         –û—Ç—Ä–∏–º–∞—Ç–∏ PRO –¥–æ—Å—Ç—É–ø
      </a>
    </div>
  `;
}
// üîπ –ì–ª–æ–±–∞–ª—å–Ω—ñ –∫–æ–ª—å–æ—Ä–∏ –¥–ª—è —Å–µ–∑–æ–Ω—ñ–≤ (—â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ ReferenceError)
const seasonColors = {
  1: "#00fff2",
  2: "#ff6b2b",
  3: "#ff00ff",
  4: "#aaff00",
  5: "#ffaa00",
  6: "#00fff2",
  7: "#ff6b2b",
  8: "#ff00ff",
  9: "#aaff00",
  10: "#ffaa00",
  11: "#00fff2",
  12: "#ff6b2b",
  13: "#ff00ff",
  14: "#aaff00",
  15: "#ffaa00"
};

// üü£ –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å–µ–∑–æ–Ω—ñ–≤ –∫–Ω–æ–ø–∫–∞–º–∏ (–∑ –ø—ñ–¥—Å–≤—ñ—Ç–∫–æ—é —Å–µ—Ä—ñ–π)
const container = document.getElementById("episodesContainer");
container.innerHTML = "";

const groups = groupBySeason(cleanData);
let currentSeason = groups[0]?.[0] || 1;

// —Å—Ç–≤–æ—Ä—é—î–º–æ –±–ª–æ–∫ –∫–Ω–æ–ø–æ–∫ —Å–µ–∑–æ–Ω—ñ–≤
const seasonsRow = document.createElement("div");
seasonsRow.className = "seasons-row";
container.appendChild(seasonsRow);

// —Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–Ω–æ–ø–∫–∏ —Å–µ–∑–æ–Ω—É
groups.forEach(([season]) => {
  const btn = document.createElement("button");
  btn.className = "season-btn";
  btn.textContent = `–°–µ–∑–æ–Ω ${season}`;
  btn.dataset.season = season;
  btn.addEventListener("click", () => {
    currentSeason = season;
    renderEpisodes(season);
    document.querySelectorAll(".season-btn").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
  });
  seasonsRow.appendChild(btn);
});

const listContainer = document.createElement("div");
listContainer.id = "episodeList";
container.appendChild(listContainer);

// —Ñ—É–Ω–∫—Ü—ñ—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å–µ—Ä—ñ–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ–∑–æ–Ω—É
function renderEpisodes(season) {
  listContainer.innerHTML = "";
  const episodes = groups.find(([s]) => s == season)?.[1] || [];

  // === –Ü–Ω—Ñ–æ –ø—Ä–æ —Å–µ–∑–æ–Ω (1-–π —Ä—è–¥–æ–∫ —Å–µ–∑–æ–Ω—É –∑ —Ç–∞–±–ª–∏—Ü—ñ)
  const seasonInfo = episodes[0] || {};
  // === üü¢ –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–≥–æ–ª–æ–≤–∫—É –ø—Ä–∏ –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—ñ —Å–µ–∑–æ–Ω—É ===
  const mainTitle = seasonInfo.main_title || first.main_title || first.title || seriesTitle;
  const currentSeasonTitle = seasonInfo.title || "";
  const fullTitle = 
    currentSeasonTitle && currentSeasonTitle !== mainTitle
      ? `${mainTitle} ‚Äî ${currentSeasonTitle} (–°–µ–∑–æ–Ω ${season})`
      : `${mainTitle} (–°–µ–∑–æ–Ω ${season})`;
  
  document.getElementById("seriesTitle").textContent = fullTitle;

  document.getElementById("seriesDesc").textContent   = seasonInfo.description || "–û–ø–∏—Å –≤—ñ–¥—Å—É—Ç–Ω—ñ–π";
  document.getElementById("seriesPoster").src         = seasonInfo.poster || "";
  document.getElementById("seriesYear").textContent   = seasonInfo.year || "";
  document.getElementById("seriesGenre").textContent  = seasonInfo.genre || "";
  document.getElementById("seriesImdb").textContent   = seasonInfo.imdb || "‚Äî";
  document.getElementById("seriesCountry").textContent  = seasonInfo.country || "";
  document.getElementById("seriesDirector").textContent = seasonInfo.director || "";
  document.getElementById("seriesCast").textContent     = seasonInfo.cast || "";
  document.getElementById("seriesSound").textContent    = seasonInfo.sound || "";
  document.getElementById("seriesDuration").textContent = seasonInfo.duration || "";
  document.getElementById("seriesAge").textContent      = seasonInfo.age || "";

  currentTrailerUrl = seasonInfo.trailer_url || "";
  currentEpisodeUrl = "";

  const list = document.createElement("div");
  list.className = `ep-list season-${season}`;
  const activeColor = seasonColors[season] || "#00fff2";

  // üîπ –ü–µ—Ä–µ—Å—Ç–≤–æ—Ä—é—î–º–æ –ø–ª–µ—î—Ä –ø–µ—Ä–µ–¥ –Ω–æ–≤–∏–º —Å–µ–∑–æ–Ω–æ–º
  ensureVideoPlayer();

  episodes.forEach((ep, idx) => {
    const WORKER_URL = "https://kino-stealth.lyuda14070702.workers.dev";

    const MY_DOMAINS = [
      "kino-video.pages.dev",
      "3bf2950b.kino-video.pages.dev"
    ];
    
    if (MY_DOMAINS.some(domain => (ep.stream_url || "").includes(domain))) {
      // —è–∫—â–æ –º–æ—î –≤—ñ–¥–µ–æ ‚Üí —á–µ—Ä–µ–∑ Worker
      ep.stream_url = WORKER_URL + "/proxy?src=" + encodeURIComponent(ep.stream_url);
    }


    const btn = document.createElement("button");
    btn.className = "ep-btn";
    const label = ep.episode_label?.trim() || `–°–µ—Ä—ñ—è ${ep.episode || idx + 1}`;
    btn.textContent = label;
    btn.addEventListener("click", () => {
      list.querySelectorAll(".ep-btn.active").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");

      currentSource = "episode";
      currentEpisodeUrl = ep.stream_url || "";

      document.getElementById("btnEpisode")?.classList.add("active");
      document.getElementById("btnSeasonTrailer")?.classList.remove("active");

      ensureVideoPlayer();
      useSource(currentEpisodeUrl);
    });
    list.appendChild(btn);

    if (idx === 0) currentEpisodeUrl = ep.stream_url || "";
  });

  const styleTag = document.getElementById("season-style") || document.createElement("style");
  styleTag.id = "season-style";
  styleTag.innerHTML = `
    .ep-list.season-${season} .ep-btn {
      border-color: ${activeColor};
      color: ${activeColor};
    }
    .ep-list.season-${season} .ep-btn.active {
      background: ${activeColor};
      color: #000;
      box-shadow: 0 0 15px ${activeColor};
    }
  `;
  document.head.appendChild(styleTag);

  listContainer.appendChild(list);

  // === üü¢ –ü—ñ—Å–ª—è –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è —Å–µ–∑–æ–Ω—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–º–∏–∫–∞—î–º–æ –ø–µ—Ä—à—É —Å–µ—Ä—ñ—é ===
  if (episodes.length > 0 && currentEpisodeUrl) {
    ensureVideoPlayer();
    useSource(currentEpisodeUrl);

    const firstBtn = list.querySelector(".ep-btn");
    if (firstBtn) firstBtn.classList.add("active");

    document.getElementById("btnEpisode")?.classList.add("active");
    document.getElementById("btnSeasonTrailer")?.classList.remove("active");
  } else {
    ensureVideoPlayer();
    useSource("");
  }
}

function showTrailer(url){
  const box = document.querySelector(".player-box");
  if (!url) { ensureVideoPlayer(); useSource(""); return; }

  if (isYouTube(url)) {
    const id = getYouTubeId(url);
    const src = id ? `https://www.youtube.com/embed/${id}` : url;
    box.innerHTML = `
      <iframe
        width="100%" height="480"
        src="${src}"
        frameborder="0"
        allow="autoplay; encrypted-media"
        allowfullscreen
        style="border-radius:12px;width:100%;aspect-ratio:16/9;">
      </iframe>`;
  } else {
    ensureVideoPlayer();
    useSource(url);
  }
}

function setSeasonButtonColor(btn, color) {
  btn.style.background = color;
  btn.style.color = "#000";
  btn.style.boxShadow = `0 0 18px ${color}`;
  btn.style.borderColor = color;
}

// –¥–æ–¥–∞—î–º–æ –∑–º—ñ–Ω—É –∫–æ–ª—å–æ—Ä—É –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ
groups.forEach(([season]) => {
  const color = seasonColors[season] || "#00fff2";
  const btn = seasonsRow.querySelector(`button[data-season="${season}"]`);
  btn?.addEventListener("click", () => setSeasonButtonColor(btn, color));
});

// –ø–æ–∫–∞–∑—É—î–º–æ –ø–µ—Ä—à–∏–π —Å–µ–∑–æ–Ω
renderEpisodes(currentSeason);
seasonsRow.querySelector(".season-btn")?.classList.add("active");
// === –ü–µ—Ä–µ–º–∏–∫–∞—á –Ω–∞–¥ –ø–ª–µ—î—Ä–æ–º
const btnEpisode = document.getElementById("btnEpisode");
const btnSeasonTrailer = document.getElementById("btnSeasonTrailer");

btnEpisode?.addEventListener("click", () => {
  if (currentSource === "episode") return;
  currentSource = "episode";
  btnEpisode.classList.add("active");
  btnSeasonTrailer.classList.remove("active");

  ensureVideoPlayer();
  if (currentEpisodeUrl) useSource(currentEpisodeUrl);
  else useSource("");
});

btnSeasonTrailer?.addEventListener("click", () => {
  if (!currentTrailerUrl) return;
  if (currentSource === "trailer") return;
  currentSource = "trailer";
  btnSeasonTrailer.classList.add("active");
  btnEpisode.classList.remove("active");
  showTrailer(currentTrailerUrl);
});


  }

  document.addEventListener("DOMContentLoaded", loadSeries);
  // === ‚≠ê –ó–ê–ö–õ–ê–î–ö–ò (–°–ï–†–Ü–ê–õ–ò) ===
function getBookmarks() {
  try { return JSON.parse(localStorage.getItem("bookmarks") || "[]"); }
  catch { return []; }
}
function setBookmarks(arr) {
  localStorage.setItem("bookmarks", JSON.stringify(arr));
}
function isSeriesBookmarked(title) {
  const list = getBookmarks();
  return list.some(x => x.title === title && x.type === "–°–µ—Ä—ñ–∞–ª");
}
function updateSeriesBookmarkBtn(title) {
  const btn = document.getElementById("bookmarkSeriesBtn");
  if (!btn) return;
  const active = isSeriesBookmarked(title);
  btn.textContent = active ? "‚≠ê –£ –∑–∞–∫–ª–∞–¥–∫–∞—Ö" : "‚≠ê –î–æ–¥–∞—Ç–∏ –≤ –∑–∞–∫–ª–∞–¥–∫–∏";
  btn.classList.toggle("active", active);
}

document.getElementById("bookmarkSeriesBtn")?.addEventListener("click", () => {
  const title = document.getElementById("seriesTitle")?.textContent.trim();
  const poster = document.getElementById("seriesPoster")?.src;
  const year = document.getElementById("seriesYear")?.textContent.trim();
  const genre = document.getElementById("seriesGenre")?.textContent.trim();
  const imdb = document.getElementById("seriesImdb")?.textContent.trim();

  let list = getBookmarks();
  const exists = isSeriesBookmarked(title);

  if (exists) {
    list = list.filter(x => !(x.title === title && x.type === "–°–µ—Ä—ñ–∞–ª"));
    setBookmarks(list);
    updateSeriesBookmarkBtn(title);
    alert("‚ùå –í–∏–¥–∞–ª–µ–Ω–æ —ñ–∑ –∑–∞–∫–ª–∞–¥–æ–∫");
  } else {
    list.push({
      id: "", // —Å–µ—Ä—ñ–∞–ª–∏ –≤—ñ–¥–∫—Ä–∏–≤–∞—é—Ç—å—Å—è –ø–æ title
      title,
      poster,
      year,
      genre,
      imdb,
      type: "–°–µ—Ä—ñ–∞–ª"
    });
    setBookmarks(list);
    updateSeriesBookmarkBtn(title);
    alert("‚úÖ –î–æ–¥–∞–Ω–æ —É –∑–∞–∫–ª–∞–¥–∫–∏");
  }
});

// –ü—ñ—Å–ª—è –ø–æ–≤–Ω–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö
document.addEventListener("DOMContentLoaded", async () => {
  await loadSeries(); // –¥–æ—á–µ–∫–∞—Ç–∏—Å—å –ø—ñ–¥–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–µ—Ä—ñ–∞–ª—É
  const title = document.getElementById("seriesTitle")?.textContent.trim();
  if (title) updateSeriesBookmarkBtn(title);
});


</script>
<!-- üßæ –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ -->
<div id="reportModal" class="modal">
  <div class="modal-content">
    <span class="close-modal">&times;</span>
    <h3>‚ö† –ü–æ–≤—ñ–¥–æ–º–∏—Ç–∏ –ø—Ä–æ –ø—Ä–æ–±–ª–µ–º—É</h3>
    <p>–û–ø–∏—à—ñ—Ç—å –∫–æ—Ä–æ—Ç–∫–æ, —â–æ –Ω–µ –ø—Ä–∞—Ü—é—î (–ø–æ—Å–∏–ª–∞–Ω–Ω—è, —Å–µ—Ä—ñ—è, –ø–ª–µ—î—Ä —Ç–æ—â–æ):</p>
    <textarea id="reportText" rows="4" placeholder="–ö–æ—Ä–æ—Ç–∫–æ –æ–ø–∏—à—ñ—Ç—å –ø—Ä–æ–±–ª–µ–º—É..."></textarea>
    <div class="modal-buttons">
      <button id="reportCancel" class="cancel">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
      <button id="reportSend" class="send">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏</button>
    </div>
  </div>
</div>

<script>
// === ‚ö† –ü–æ–≤—ñ–¥–æ–º–∏—Ç–∏ –ø—Ä–æ –ø—Ä–æ–±–ª–µ–º—É ===
(function(){
  const modal   = document.getElementById("reportModal");
  const txt     = document.getElementById("reportText");
  const btnOpen = document.getElementById("reportIssueBtn");
  const btnSend = document.getElementById("reportSend");
  const btnCancel = document.getElementById("reportCancel");

  if (!btnOpen || !modal) return;

  btnOpen.addEventListener("click", ()=>{ modal.style.display="block"; txt.focus(); });
  btnCancel.addEventListener("click", ()=>{ modal.style.display="none"; txt.value=""; });
  modal.addEventListener("click", (e)=>{ if (e.target===modal) modal.style.display="none"; });
  document.querySelector(".close-modal")?.addEventListener("click", ()=>{ modal.style.display="none"; });

  async function sendReport(item_type, titleElId){
    const message = (txt.value || "").trim();
    if (message.length < 5) return alert("–û–ø–∏—à—ñ—Ç—å –ø—Ä–æ–±–ª–µ–º—É –¥–µ—Ç–∞–ª—å–Ω—ñ—à–µ (–º—ñ–Ω—ñ–º—É–º 5 —Å–∏–º–≤–æ–ª—ñ–≤).");

    const title = (document.getElementById(titleElId)?.textContent || "").trim();
    let user = null;
    try { user = JSON.parse(localStorage.getItem("telegram_user") || "null"); } catch {}

    const payload = {
      user_id: user?.id ? String(user.id) : null,
      user_name: [user?.first_name, user?.last_name].filter(Boolean).join(" ") || user?.username || null,
      item_type,
      item_title: title,
      page_url: location.href,
      content: message,
      status: "new"
    };

    const { error } = await supabase.from("feedback_reports").insert(payload);
    if (error) { console.error(error); alert("–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥ —á–∞—Å –≤—ñ–¥–ø—Ä–∞–≤–∫–∏. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑."); return; }

    modal.style.display="none"; txt.value="";
    alert("‚úÖ –î—è–∫—É—î–º–æ! –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ. –í—ñ–¥–ø–æ–≤—ñ–¥—å –∑ º—è–≤–∏—Ç—å—Å—è —É —Ä–æ–∑–¥—ñ–ª—ñ ¬´–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è¬ª –≤–∞—à–æ–≥–æ –∫–∞–±—ñ–Ω–µ—Ç—É.");
  }

  btnSend.onclick = ()=>sendReport("–°–µ—Ä—ñ–∞–ª", "seriesTitle");
})();
</script>




<!-- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –ª–æ–≥—ñ–∫–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤ -->
<script src="comments.js"></script>
<script>
  window.APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzUl7EZMk9KlBUgirrZtCg6sK9POdlrqKVSuJt0NqQ1NHJWj2_-EX_gLLvN0DoykM0qsQ/exec";
</script>
<script src="auth.js"></script>
<div id="footer-placeholder"></div>
<script>
  fetch("footer.html")
    .then(res => res.text())
    .then(html => {
      document.getElementById("footer-placeholder").innerHTML = html;
      // –ø—ñ—Å–ª—è —Ç–æ–≥–æ —è–∫ —Ñ—É—Ç–µ—Ä –∑‚Äô—è–≤–∏–≤—Å—è —É DOM ‚Äî –ø—ñ–¥–∫–ª—é—á–∞—î–º–æ –ª–æ–≥—ñ–∫—É
      const s = document.createElement("script");
      s.src = "footer.js";
      document.body.appendChild(s);
    });
</script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const el = document.querySelector("#seriesTitle[data-enc]");
  if (el && el.dataset.enc && !el.textContent.trim()) {
    try {
      const decoded = decodeURIComponent(atob(el.dataset.enc)).split("||")[0];
      el.textContent = decoded;
    } catch (e) {
      console.warn("–ü–æ–º–∏–ª–∫–∞ —Ä–æ–∑—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –Ω–∞–∑–≤–∏ —Å–µ—Ä—ñ–∞–ª—É:", e);
    }
  }
});
// === üé¨ –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω—ñ —Å–µ—Ä—ñ–∞–ª–∏ ===
async function loadRecommendedSeries(title, genre) {
  const list = document.getElementById("recommendedSeriesList");
  if (!list) return;

  list.innerHTML = "<p style='color:#777'>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</p>";

  const keyword = (title || "").split(" ")[0] || "";
  const { data, error } = await supabase
    .from("films_site")
    .select("id, title, poster, genre")
    .ilike("type", "–°–µ—Ä—ñ–∞–ª")
    .or(`title.ilike.%${keyword}%,genre.ilike.%${genre}%`)
    .limit(20);

  if (error || !data || data.length === 0) {
    list.innerHTML = "<p style='color:#888'>–°—Ö–æ–∂–∏—Ö —Å–µ—Ä—ñ–∞–ª—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</p>";
    return;
  }

  // üßπ –ü—Ä–∏–±–∏—Ä–∞—î–º–æ –¥—É–±–ª—ñ–∫–∞—Ç–∏ –Ω–∞–∑–≤ —ñ —Å–∞–º –ø–æ—Ç–æ—á–Ω–∏–π —Å–µ—Ä—ñ–∞–ª
  const seen = new Set();
  const current = (title || "").trim().toLowerCase();
  const unique = data.filter(x => {
    const name = (x.title || "").trim().toLowerCase();
    if (!name || name === current || seen.has(name)) return false;
    seen.add(name);
    return true;
  }).slice(0, 6);

  list.innerHTML = "";
  unique.forEach(item => {
    const div = document.createElement("div");
    div.className = "recommended-item";
    div.innerHTML = `
      <img src="${item.poster}" alt="${item.title}">
      <p>${item.title}</p>
    `;
    div.addEventListener("click", () => {
      // —Å–µ—Ä—ñ–∞–ª–∏ –≤—ñ–¥–∫—Ä–∏–≤–∞—î—à –ø–æ title
      window.location.href = `series.html?title=${encodeURIComponent(item.title)}`;
    });
    list.appendChild(div);
  });
}

</script>
<!-- <script src="/sw-register.js"></script> -->
<script src="seo.js"></script>
<script>
// üß© –í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞–Ω—É –ø—ñ—Å–ª—è –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –∑ PWA
window.addEventListener("pageshow", (e) => {
  if (e.persisted) {
    const player = document.getElementById("seriesPlayer");
    if (!player) return;

    // üÜî –†–æ–±–∏–º–æ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π –∫–ª—é—á –¥–ª—è —Å–µ—Ä—ñ–∞–ª—ñ–≤ —Ç–∞ –º—É–ª—å—Ç—Å–µ—Ä—ñ–∞–ª—ñ–≤
    const isMult = location.pathname.includes("multseries");
    const title = (document.getElementById("seriesTitle")?.textContent || "").trim();
    const filmId = (isMult ? "mult_" : "series_") + title;

    const wasPlaying = localStorage.getItem(`playstate_${filmId}`) === "playing";
    if (wasPlaying) {
      player.play().catch(()=>{});
    }
  }
});
</script>
<script src="/pull-refresh.js"></script>
</body>
</html>
